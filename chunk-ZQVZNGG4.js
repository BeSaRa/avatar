import{a as T,b as P,c as w}from"./chunk-NLTJUQCG.js";import{la as k}from"./chunk-JML6SUSJ.js";import{b as v}from"./chunk-ZWR4GBNY.js";import{f as x}from"./chunk-QSVBHP5J.js";import{Ba as f,Db as l,Ja as g,Mb as p,N as m,Nb as S,Ob as d,Oc as b,Sb as y,e as D,g as s,hb as z,hc as C,jc as _,ka as c,oa as h,sb as a,vb as R,za as u}from"./chunk-NMJA3KYW.js";var e=D(P());var $=r=>({"bounce-animation":r}),M=class r extends T(class{}){lang=c(x);store=c(v);recognizingStatus=a(!1);recognizingText=a("");recognizedText=a("");recognizing$=g();recognized$=g();speechService=c(k);toggleRecording(){return s(this,null,function*(){this.store.isRecordingLoading()||(this.store.isRecordingStarted()&&this.recognizer?yield this.stopRecording():yield this.startRecording())})}stopRecording(){return s(this,null,function*(){this.recognizer.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped(),this.cleartext()})})}startRecording(){return s(this,null,function*(){this.recognizer||(yield this.prepareRecognizer()),this.store.recordingInProgress(),this.recognizer.startContinuousRecognitionAsync(()=>{this.recognizer.internalData.privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)})})}prepareRecognizer(){return s(this,null,function*(){let o=e.AudioConfig.fromDefaultMicrophoneInput(),n=e.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US"]);this.recognizer=e.SpeechRecognizer.FromConfig(e.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region()),n,o),this.recognizer.recognizing=(t,i)=>{i.result.reason===e.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+i.result.text),this.recognizing$.emit(this.recognizingText()),this.recognizingStatus.set(!0))},this.recognizer.recognized=(t,i)=>{i.result.reason===e.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(A=>A+" "+i.result.text),this.recognized$.emit(this.recognizedText()),this.recognizingStatus.set(!1))},this.recognizer.canceled=()=>{this.store.recordingInProgress(),this.speechService.generateSpeechToken().pipe(m(1)).subscribe(()=>{this.prepareRecognizer().then(()=>this.startRecording())})},this.store.recordingStopped()})}cleartext(){this.recognizedText.set(""),this.recognizingText.set("")}static \u0275fac=(()=>{let o;return function(t){return(o||(o=f(r)))(t||r)}})();static \u0275cmp=h({type:r,selectors:[["app-recorder"]],outputs:{recognizing$:"recognizing$",recognized$:"recognized$"},standalone:!0,features:[R,C],decls:4,vars:5,consts:[[1,"rounded-full","bg-white","relative","text-primary","hover:bg-gray-200","shadow","shadow-primary","overflow-hidden","border","flex-shrink-0","flex-grow-0","flex","items-center","justify-center","outline-none","ring-offset-1","focus:ring-2","ring-primary","size-12",3,"click","matTooltip","disabled"],[1,"absolute","bg-primary/60","top-0","left-0","size-full","z-10","rounded-full","scale-0",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 256 256",1,"size-8"],["d","M128,176a48.05,48.05,0,0,0,48-48V64a48,48,0,0,0-96,0v64A48.05,48.05,0,0,0,128,176ZM96,64a32,32,0,0,1,64,0v64a32,32,0,0,1-64,0Zm40,143.6V240a8,8,0,0,1-16,0V207.6A80.11,80.11,0,0,1,48,128a8,8,0,0,1,16,0,64,64,0,0,0,128,0,8,8,0,0,1,16,0A80.11,80.11,0,0,1,136,207.6Z"]],template:function(n,t){n&1&&(p(0,"button",0),y("click",function(){return t.toggleRecording()}),d(1,"div",1),u(),p(2,"svg",2),d(3,"path",3),S()()),n&2&&(l("matTooltip",t.lang.locals.click_to_speak)("disabled",t.store.isRecordingLoading()),z(),l("ngClass",_(3,$,t.store.isRecordingStarted())))},dependencies:[b,w],styles:["[_nghost-%COMP%]{display:contents}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:scale(1)}20%{transform:scale(.6)}40%{transform:scale(.75)}60%{transform:scale(.4)}80%{transform:scale(.25)}}.bounce-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce .8s linear infinite}"]})};export{M as a};
