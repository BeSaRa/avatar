import{a as re}from"./chunk-EHTR4VOC.js";import{a as ae}from"./chunk-FBS6Y7ZU.js";import{v as h}from"./chunk-KIZCJSGD.js";import"./chunk-OHIWOG7L.js";import"./chunk-KNZUA67I.js";import"./chunk-5BZPFUY4.js";import"./chunk-J2HB2Y4E.js";import"./chunk-ZX4VXR5W.js";import"./chunk-FWDT53KA.js";import{c as oe}from"./chunk-X5CIYX27.js";import"./chunk-6IGLDT6K.js";import"./chunk-2N4EDZNV.js";import{j as H}from"./chunk-ANBYP55K.js";import"./chunk-EARLHVX5.js";import{$ as q,ea as X,fa as Y,ja as J,ma as ee,pa as te,va as ne,xa as ie}from"./chunk-MFSWGIIO.js";import"./chunk-OK5S6IU3.js";import{b as Q}from"./chunk-DYBLNUKQ.js";import"./chunk-PXW4CVT7.js";import{Ac as m,B as k,Bc as A,Bd as j,Eb as N,Ha as Z,Hc as G,Ia as D,Ic as z,Ja as $,Jc as W,Lc as B,Mc as y,Ob as x,Qc as S,R as E,Rc as I,Sb as g,Ub as w,Xb as C,a as F,ac as d,b as M,bc as r,cc as u,ga as L,gc as V,ha as T,jc as P,ka as K,lc as _,sb as o,ta as b,wc as R,xa as U,xc as O,zc as l}from"./chunk-O6QGGAL6.js";var se=["indexedChart"],le=["keywordsChart"],ce=()=>["MEDIA_STATISTICS__INDEXED_URLS"],me=()=>["MEDIA_STATISTICS__USED_KEYWORDS"],pe=()=>["MEDIA_STATISTICS_NEWS_PERCENTAGE"],ue=()=>["MEDIA_STATISTICS_NEWS_CARDS"];function _e(i,t){if(i&1&&(d(0,"span",13),l(1),r()),i&2){let e=_(2);o(),m(e.lang.locals.date_range_error)}}function xe(i,t){if(i&1&&(d(0,"span",13),l(1),r()),i&2){let e=_(2);o(),m(e.lang.locals.date_range_error)}}function ge(i,t){if(i&1){let e=V();d(0,"div",16),u(1,"canvas",17,0),r(),d(3,"button",18),P("click",function(){Z(e);let c=_(2);return D(c.resetIndexedZoom())}),l(4),r()}if(i&2){let e=t,a=_(2);o(),g("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options),o(3),A(" ",a.lang.locals.reset_zoom," ")}}function Ce(i,t){i&1&&u(0,"div",19)(1,"div",20)}function fe(i,t){if(i&1&&(d(0,"div",6)(1,"h2",7),l(2),r(),d(3,"p",8),l(4),r(),d(5,"form",9)(6,"div",10)(7,"label",11),l(8),r(),u(9,"input",12),x(10,_e,2,1,"span",13),r(),d(11,"div",10)(12,"label",14),l(13),r(),u(14,"input",15),x(15,xe,2,1,"span",13),r()(),x(16,ge,5,5),S(17,"async"),x(18,Ce,2,0),r()),i&2){let e,a,c,n=_();o(2),m(n.lang.locals.most_indexed_urls),o(2),m(n.lang.locals.chart_zoom_tip),o(),g("formGroup",n.indexedForm),o(3),m(n.lang.locals.start_time),o(),w("border-red-500",(n.indexedForm.errors==null?null:n.indexedForm.errors.DateInvalidRangeIndexed)&&n.indexedForm.touched),o(),C(n.indexedForm.errors!=null&&n.indexedForm.errors.DateInvalidRangeIndexed&&((e=n.indexedForm.get("from_date"))!=null&&e.touched||(e=n.indexedForm.get("to_date"))!=null&&e.touched)?10:-1),o(3),m(n.lang.locals.end_time),o(),w("border-red-500",(n.indexedForm.errors==null?null:n.indexedForm.errors.DateInvalidRangeIndexed)&&n.indexedForm.touched),o(),C(n.indexedForm.errors!=null&&n.indexedForm.errors.DateInvalidRangeIndexed&&((a=n.indexedForm.get("from_date"))!=null&&a.touched||(a=n.indexedForm.get("to_date"))!=null&&a.touched)?15:-1),o(),C((c=I(17,12,n.mostIndexedUrl$))?16:18,c)}}function he(i,t){if(i&1&&(d(0,"span",13),l(1),r()),i&2){let e=_(2);o(),m(e.lang.locals.date_range_error)}}function ve(i,t){if(i&1&&(d(0,"span",13),l(1),r()),i&2){let e=_(2);o(),m(e.lang.locals.date_range_error)}}function be(i,t){if(i&1){let e=V();d(0,"div",16),u(1,"canvas",17,1),r(),d(3,"button",18),P("click",function(){Z(e);let c=_(2);return D(c.resetKeywordsZoom())}),l(4),r()}if(i&2){let e=t,a=_(2);o(),g("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options),o(3),A(" ",a.lang.locals.reset_zoom," ")}}function we(i,t){i&1&&u(0,"div",19)(1,"div",20)}function ye(i,t){if(i&1&&(d(0,"div",6)(1,"h2",7),l(2),r(),d(3,"p",8),l(4),r(),d(5,"form",9)(6,"div",10)(7,"label",11),l(8),r(),u(9,"input",12),x(10,he,2,1,"span",13),r(),d(11,"div",10)(12,"label",14),l(13),r(),u(14,"input",15),x(15,ve,2,1,"span",13),r()(),x(16,be,5,5),S(17,"async"),x(18,we,2,0),r()),i&2){let e,a,c,n=_();o(2),m(n.lang.locals.most_used_keywords),o(2),m(n.lang.locals.chart_zoom_tip),o(),g("formGroup",n.keywordsForm),o(3),m(n.lang.locals.start_time),o(),w("border-red-500",(n.keywordsForm.errors==null?null:n.keywordsForm.errors.DateInvalidRangeKeyword)&&n.keywordsForm.touched),o(),C(n.keywordsForm.errors!=null&&n.keywordsForm.errors.DateInvalidRangeKeyword&&((e=n.keywordsForm.get("from_date"))!=null&&e.touched||(e=n.keywordsForm.get("to_date"))!=null&&e.touched)?10:-1),o(3),m(n.lang.locals.end_time),o(),w("border-red-500",(n.keywordsForm.errors==null?null:n.keywordsForm.errors.DateInvalidRangeKeyword)&&n.keywordsForm.touched),o(),C(n.keywordsForm.errors!=null&&n.keywordsForm.errors.DateInvalidRangeKeyword&&((a=n.keywordsForm.get("from_date"))!=null&&a.touched||(a=n.keywordsForm.get("to_date"))!=null&&a.touched)?15:-1),o(),C((c=I(17,12,n.mostUsedKeywords$))?16:18,c)}}function Se(i,t){if(i&1&&(d(0,"div",16),u(1,"canvas",17,1),r()),i&2){let e=t;o(),g("type",e.chart.type)("datasets",e.chart.data.datasets)("labels",e.chart.data.labels)("options",e.chart.options)}}function Ie(i,t){i&1&&u(0,"div",19)(1,"div",20)}function ke(i,t){if(i&1&&(d(0,"div",6)(1,"h2",7),l(2),r(),x(3,Se,3,4,"div",16),S(4,"async"),x(5,Ie,2,0),r()),i&2){let e,a=_();o(2),m(a.lang.locals.indexed_sources_percentage),o(),C((e=I(4,2,a.newsPercentage$))?3:5,e)}}function Fe(i,t){i&1&&u(0,"div",23)}function Me(i,t){if(i&1&&(d(0,"p",24),l(1),r(),$(),d(2,"svg",25),u(3,"g",26)(4,"g",27),d(5,"g",28),u(6,"path",29)(7,"path",30)(8,"path",31)(9,"path",32),r()()),i&2){_();let e=W(3);o(),m(e)}}function Ee(i,t){if(i&1&&(d(0,"div",21)(1,"h2",22),l(2),r(),G(3),S(4,"async"),x(5,Fe,1,0,"div",23)(6,Me,10,1),r()),i&2){let e=_();o(2),m(e.lang.locals.total_indexed_news),o();let a=z(I(4,2,e.numberOfIndexedNews$));o(2),C(a==null?5:6)}}var de=class i{lang=b(Q);adminService=b(oe);crawlingService=b(re);fb=b(ne);reportCount$=this.adminService.getReportsCount();urlCount$=this.adminService.getUrlsCount();mostIndexedChart=N("indexedChart",{read:h});mostUsedKeywordsChart=N("keywordsChart",{read:h});indexedForm=this.fb.group({from_date:[""],to_date:[""]},{validators:H([["from_date","to_date"]],["DateInvalidRangeIndexed"])});keywordsForm=this.fb.group({from_date:[""],to_date:[""]},{validators:H([["from_date","to_date"]],["DateInvalidRangeKeyword"])});numberOfIndexedNews$=this.crawlingService.getTotalNumberOfIndexedNews().pipe(K(console.log));newsPercentage$=this.crawlingService.getIndexedNewsPercentage().pipe(k(t=>({title:this.lang.locals.indexed_sources_percentage,chart:this.getNewsPercentageChartConfig(t)})));mostIndexedUrl$=this.indexedForm.valueChanges.pipe(L(this.indexedForm.value),E(300),T(({from_date:t,to_date:e})=>this.crawlingService.getMostIndexedStatistics(t,e)),k(t=>({title:this.lang.locals.most_indexed_urls,chart:this.getChartConfig(t)})));mostUsedKeywords$=this.keywordsForm.valueChanges.pipe(L(this.keywordsForm.value),E(300),T(({from_date:t,to_date:e})=>this.crawlingService.getMostUsedKeywordStatistics(t,e)),k(t=>({title:this.lang.locals.most_used_keywords,chart:this.getKeywordChartConfig(t)})));getChartConfig(t){let e=new Map;t.forEach(s=>{let p=decodeURIComponent(s.Most_indexed_URL),v=s.IndexDate,f=e.get(p)||{count:0,dates:new Set};f.count+=s.Count,f.dates.add(v),e.set(p,f)});let a=Array.from(e.entries()).sort((s,p)=>s[1].count-p[1].count),c=a.map(([s,p])=>`${s} (${Array.from(p.dates).join(", ")})`),n=a.map(s=>s[1].count);return{type:"bar",data:{labels:c,datasets:[{label:this.lang.locals.links_count,data:n,backgroundColor:"rgba(138, 21, 56, 0.5)",borderColor:"rgba(138, 21, 56)",borderWidth:2}]},options:this.getChartOptions()}}getKeywordChartConfig(t){let e=new Map;t.forEach(s=>{let p=s["Most-used-keywords"].trim(),v=s.IndexDate,f=e.get(p)||{count:0,dates:new Set};f.count+=s.Count,f.dates.add(v),e.set(p,f)});let a=Array.from(e.entries()).sort((s,p)=>s[1].count-p[1].count),c=a.map(([s,p])=>`${s} (${Array.from(p.dates).join(", ")})`),n=a.map(s=>s[1].count);return{type:"bar",data:{labels:c,datasets:[{label:this.lang.locals.keywords_count,data:n,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235)",borderWidth:2}]},options:this.getChartOptions()}}getNewsPercentageChartConfig(t){let e=Object.values(t),a=Object.keys(t),c=e.reduce((p,v)=>p+v,0),n=c===0?[1]:e;return{type:"pie",data:{labels:c===0?[this.lang.locals.no_data_to_preview]:a,datasets:[{label:this.lang.locals.indexed_sources_percentage,data:n}]},options:this.getNewsPercentageChartOptions()}}getNewsPercentageChartOptions(){return M(F({},this.getChartOptions()),{plugins:{legend:{display:!0,position:"top"},tooltip:M(F({},this.getChartOptions().plugins.tooltip),{callbacks:{title:()=>this.lang.locals.keywords,label:t=>[`${t.label||""}:${this.lang.locals.no_data_to_preview?0:t.raw}%`]}}),datalabels:{textAlign:"center",color:"#ffffff",font:{size:14},backgroundColor:t=>t.dataset.backgroundColor[t.dataIndex],borderColor:"#ffffff",borderRadius:8,borderWidth:1,padding:{left:10,right:10},display:t=>{let e=t.dataset.data;return e[t.dataIndex]>0||e.length===1},formatter:(t,e)=>{let a=e.chart.data.labels[e.dataIndex];return[a,`${a===this.lang.locals.no_data_to_preview?0:t}%`]}}},scales:void 0})}getChartOptions(){return{responsive:!0,indexAxis:"y",plugins:{legend:{display:!0},tooltip:{rtl:this.lang.currentLanguage==="ar"},zoom:{zoom:{wheel:{enabled:!0},drag:{enabled:!0},pinch:{enabled:!0},mode:"xy"},pan:{enabled:!0,mode:"xy"},limits:{x:{min:0,max:100},y:{min:0,max:100}}}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:12}}}}}}resetIndexedZoom(){this.mostIndexedChart()?.chart?.resetZoom()}resetKeywordsZoom(){this.mostUsedKeywordsChart()?.chart?.resetZoom()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=U({type:i,selectors:[["app-statistics"]],viewQuery:function(e,a){e&1&&(R(a.mostIndexedChart,se,5,h),R(a.mostUsedKeywordsChart,le,5,h)),e&2&&O(2)},standalone:!0,features:[B],decls:6,vars:8,consts:[["indexedChart",""],["keywordsChart",""],[1,"w-full","mx-auto","p-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["class","col-span-1 p-8 bg-white rounded-2xl shadow-lg border border-gray-200",4,"appHasPermission"],["class","relative overflow-hidden h-28 p-6 bg-white border border-gray-200 rounded-2xl shadow-md hover:shadow-lg transition",4,"appHasPermission"],[1,"col-span-1","p-8","bg-white","rounded-2xl","shadow-lg","border","border-gray-200"],[1,"text-2xl","font-semibold","text-gray-700","mb-1"],[1,"text-xs","text-gray-500","mb-3"],[1,"flex","flex-col","md:flex-row","gap-4","mb-4","text-gray-700",3,"formGroup"],[1,"flex","flex-col","flex-auto"],["for","from_date",1,"text-sm","font-medium"],["type","date","formControlName","from_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],[1,"text-red-500","text-xs"],["for","to_date",1,"text-sm","font-medium"],["type","date","formControlName","to_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],[2,"display","block"],["baseChart","",1,"max-h-56",3,"type","datasets","labels","options"],[1,"mt-2","text-sm","text-blue-500","hover:underline",3,"click"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mb-4"],[1,"h-56","bg-gray-300","rounded","animate-pulse"],[1,"relative","overflow-hidden","h-28","p-6","bg-white","border","border-gray-200","rounded-2xl","shadow-md","hover:shadow-lg","transition"],[1,"text-gray-700","text-2xl","font-semibold"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mt-2"],[1,"text-gray-900","text-4xl","font-bold","mt-2"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"absolute","w-40","h-32","top-0","rtl:left-0","right-0","m-2","opacity-50","mr-auto"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M6 14.5H14","stroke","#bfbfbf","stroke-width","1.5","stroke-linecap","round"],["d","M6 18H11.5","stroke","#bfbfbf","stroke-width","1.5","stroke-linecap","round"],["d","M13 2.5V5C13 7.35702 13 8.53553 13.7322 9.26777C14.4645 10 15.643 10 18 10H22","stroke","#bfbfbf","stroke-width","1.5"],["d","M2.75 10C2.75 9.58579 2.41421 9.25 2 9.25C1.58579 9.25 1.25 9.58579 1.25 10H2.75ZM21.25 14C21.25 14.4142 21.5858 14.75 22 14.75C22.4142 14.75 22.75 14.4142 22.75 14H21.25ZM15.3929 4.05365L14.8912 4.61112L15.3929 4.05365ZM19.3517 7.61654L18.85 8.17402L19.3517 7.61654ZM21.654 10.1541L20.9689 10.4592V10.4592L21.654 10.1541ZM3.17157 20.8284L3.7019 20.2981H3.7019L3.17157 20.8284ZM20.8284 20.8284L20.2981 20.2981L20.2981 20.2981L20.8284 20.8284ZM1.35509 5.92658C1.31455 6.33881 1.61585 6.70585 2.02807 6.7464C2.4403 6.78695 2.80734 6.48564 2.84789 6.07342L1.35509 5.92658ZM22.6449 18.0734C22.6855 17.6612 22.3841 17.2941 21.9719 17.2536C21.5597 17.2131 21.1927 17.5144 21.1521 17.9266L22.6449 18.0734ZM14 21.25H10V22.75H14V21.25ZM2.75 14V10H1.25V14H2.75ZM21.25 13.5629V14H22.75V13.5629H21.25ZM14.8912 4.61112L18.85 8.17402L19.8534 7.05907L15.8947 3.49618L14.8912 4.61112ZM22.75 13.5629C22.75 11.8745 22.7651 10.8055 22.3391 9.84897L20.9689 10.4592C21.2349 11.0565 21.25 11.742 21.25 13.5629H22.75ZM18.85 8.17402C20.2034 9.3921 20.7029 9.86199 20.9689 10.4592L22.3391 9.84897C21.9131 8.89241 21.1084 8.18853 19.8534 7.05907L18.85 8.17402ZM10.0298 2.75C11.6116 2.75 12.2085 2.76158 12.7405 2.96573L13.2779 1.5653C12.4261 1.23842 11.498 1.25 10.0298 1.25V2.75ZM15.8947 3.49618C14.8087 2.51878 14.1297 1.89214 13.2779 1.5653L12.7405 2.96573C13.2727 3.16993 13.7215 3.55836 14.8912 4.61112L15.8947 3.49618ZM10 21.25C8.09318 21.25 6.73851 21.2484 5.71085 21.1102C4.70476 20.975 4.12511 20.7213 3.7019 20.2981L2.64124 21.3588C3.38961 22.1071 4.33855 22.4392 5.51098 22.5969C6.66182 22.7516 8.13558 22.75 10 22.75V21.25ZM1.25 14C1.25 15.8644 1.24841 17.3382 1.40313 18.489C1.56076 19.6614 1.89288 20.6104 2.64124 21.3588L3.7019 20.2981C3.27869 19.8749 3.02502 19.2952 2.88976 18.2892C2.75159 17.2615 2.75 15.9068 2.75 14H1.25ZM14 22.75C15.8644 22.75 17.3382 22.7516 18.489 22.5969C19.6614 22.4392 20.6104 22.1071 21.3588 21.3588L20.2981 20.2981C19.8749 20.7213 19.2952 20.975 18.2892 21.1102C17.2615 21.2484 15.9068 21.25 14 21.25V22.75ZM10.0298 1.25C8.15538 1.25 6.67442 1.24842 5.51887 1.40307C4.34232 1.56054 3.39019 1.8923 2.64124 2.64124L3.7019 3.7019C4.12453 3.27928 4.70596 3.02525 5.71785 2.88982C6.75075 2.75158 8.11311 2.75 10.0298 2.75V1.25ZM2.84789 6.07342C2.96931 4.83905 3.23045 4.17335 3.7019 3.7019L2.64124 2.64124C1.80633 3.47616 1.48944 4.56072 1.35509 5.92658L2.84789 6.07342ZM21.1521 17.9266C21.0307 19.1609 20.7695 19.8266 20.2981 20.2981L21.3588 21.3588C22.1937 20.5238 22.5106 19.4393 22.6449 18.0734L21.1521 17.9266Z","fill","#bfbfbf"]],template:function(e,a){e&1&&(d(0,"div",2)(1,"div",3),x(2,fe,19,14,"div",4)(3,ye,19,14,"div",4)(4,ke,6,4,"div",4)(5,Ee,7,5,"div",5),r()()),e&2&&(o(2),g("appHasPermission",y(4,ce)),o(),g("appHasPermission",y(5,me)),o(),g("appHasPermission",y(6,pe)),o(),g("appHasPermission",y(7,ue)))},dependencies:[j,h,ie,J,q,X,Y,ee,te,ae],encapsulation:2})};export{de as StatisticsComponent};
