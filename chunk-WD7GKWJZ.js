import{a as re}from"./chunk-62TOMJVD.js";import{v as b}from"./chunk-HDQCXW5U.js";import{c as ie}from"./chunk-PTPLWRP2.js";import"./chunk-WPFYNPVQ.js";import{j as $}from"./chunk-O7XBGNFH.js";import{A as ae,c as J,h as X,i as Y,m as ee,p as te,s as ne,y as oe}from"./chunk-ZZLVWEOU.js";import{b as q}from"./chunk-7YC6CIPS.js";import"./chunk-UUNGGFH6.js";import{Ac as m,Ad as Q,B as I,Bc as K,Eb as N,Ha as Z,Hc as z,Ia as V,Ic as B,Ja as A,Jc as j,Lc as W,Ob as u,Qc as y,R as M,Rc as S,Sb as x,Ub as w,Xb as h,a as k,ac as l,b as F,bc as i,cc as p,ga as L,gc as R,ha as E,jc as T,ka as H,lc as f,sb as o,ta as v,wc as D,xa as O,xc as G,zc as s}from"./chunk-FK5TGTUL.js";var de=["indexedChart"],se=["keywordsChart"];function me(a,n){if(a&1&&(l(0,"span",11),s(1),i()),a&2){let t=f();o(),m(t.lang.locals.date_range_error)}}function ce(a,n){if(a&1&&(l(0,"span",11),s(1),i()),a&2){let t=f();o(),m(t.lang.locals.date_range_error)}}function pe(a,n){if(a&1){let t=R();l(0,"div",14),p(1,"canvas",18,0),i(),l(3,"button",19),T("click",function(){Z(t);let c=f();return V(c.resetIndexedZoom())}),s(4),i()}if(a&2){let t=n,e=f();o(),x("type",t.chart.type)("datasets",t.chart.data.datasets)("labels",t.chart.data.labels)("options",t.chart.options),o(3),K(" ",e.lang.locals.reset_zoom," ")}}function ue(a,n){a&1&&p(0,"div",20)(1,"div",21)}function ge(a,n){if(a&1&&(l(0,"span",11),s(1),i()),a&2){let t=f();o(),m(t.lang.locals.date_range_error)}}function Ce(a,n){if(a&1&&(l(0,"span",11),s(1),i()),a&2){let t=f();o(),m(t.lang.locals.date_range_error)}}function _e(a,n){if(a&1){let t=R();l(0,"div",14),p(1,"canvas",18,1),i(),l(3,"button",19),T("click",function(){Z(t);let c=f();return V(c.resetKeywordsZoom())}),s(4),i()}if(a&2){let t=n,e=f();o(),x("type",t.chart.type)("datasets",t.chart.data.datasets)("labels",t.chart.data.labels)("options",t.chart.options),o(3),K(" ",e.lang.locals.reset_zoom," ")}}function fe(a,n){a&1&&p(0,"div",20)(1,"div",21)}function he(a,n){if(a&1&&(l(0,"div",14),p(1,"canvas",18,1),i()),a&2){let t=n;o(),x("type",t.chart.type)("datasets",t.chart.data.datasets)("labels",t.chart.data.labels)("options",t.chart.options)}}function xe(a,n){a&1&&p(0,"div",20)(1,"div",21)}function be(a,n){a&1&&p(0,"div",17)}function ve(a,n){if(a&1&&(l(0,"p",22),s(1),i(),A(),l(2,"svg",23),p(3,"g",24)(4,"g",25),l(5,"g",26),p(6,"path",27)(7,"path",28)(8,"path",29)(9,"path",30),i()()),a&2){f();let t=j(49);o(),m(t)}}var le=class a{lang=v(q);adminService=v(ie);crawlingService=v(re);fb=v(oe);reportCount$=this.adminService.getReportsCount();urlCount$=this.adminService.getUrlsCount();mostIndexedChart=N("indexedChart",{read:b});mostUsedKeywordsChart=N("keywordsChart",{read:b});indexedForm=this.fb.group({from_date:[""],to_date:[""]},{validators:$([["from_date","to_date"]],["DateInvalidRangeIndexed"])});keywordsForm=this.fb.group({from_date:[""],to_date:[""]},{validators:$([["from_date","to_date"]],["DateInvalidRangeKeyword"])});numberOfIndexedNews$=this.crawlingService.getTotalNumberOfIndexedNews().pipe(H(console.log));newsPercentage$=this.crawlingService.getIndexedNewsPercentage().pipe(I(n=>({title:this.lang.locals.indexed_sources_percentage,chart:this.getNewsPercentageChartConfig(n)})));mostIndexedUrl$=this.indexedForm.valueChanges.pipe(L(this.indexedForm.value),M(300),E(({from_date:n,to_date:t})=>this.crawlingService.getMostIndexedStatistics(n,t)),I(n=>({title:this.lang.locals.most_indexed_urls,chart:this.getChartConfig(n)})));mostUsedKeywords$=this.keywordsForm.valueChanges.pipe(L(this.keywordsForm.value),M(300),E(({from_date:n,to_date:t})=>this.crawlingService.getMostUsedKeywordStatistics(n,t)),I(n=>({title:this.lang.locals.most_used_keywords,chart:this.getKeywordChartConfig(n)})));getChartConfig(n){let t=new Map;n.forEach(r=>{let d=decodeURIComponent(r.Most_indexed_URL),C=r.IndexDate,_=t.get(d)||{count:0,dates:new Set};_.count+=r.Count,_.dates.add(C),t.set(d,_)});let e=Array.from(t.entries()).sort((r,d)=>r[1].count-d[1].count),c=e.map(([r,d])=>`${r} (${Array.from(d.dates).join(", ")})`),g=e.map(r=>r[1].count);return{type:"bar",data:{labels:c,datasets:[{label:this.lang.locals.links_count,data:g,backgroundColor:"rgba(138, 21, 56, 0.5)",borderColor:"rgba(138, 21, 56)",borderWidth:2}]},options:this.getChartOptions()}}getKeywordChartConfig(n){let t=new Map;n.forEach(r=>{let d=r["Most-used-keywords"].trim(),C=r.IndexDate,_=t.get(d)||{count:0,dates:new Set};_.count+=r.Count,_.dates.add(C),t.set(d,_)});let e=Array.from(t.entries()).sort((r,d)=>r[1].count-d[1].count),c=e.map(([r,d])=>`${r} (${Array.from(d.dates).join(", ")})`),g=e.map(r=>r[1].count);return{type:"bar",data:{labels:c,datasets:[{label:this.lang.locals.keywords_count,data:g,backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235)",borderWidth:2}]},options:this.getChartOptions()}}getNewsPercentageChartConfig(n){let t=Object.values(n),e=Object.keys(n),c=t.reduce((d,C)=>d+C,0),g=c===0?[1]:t;return{type:"pie",data:{labels:c===0?[this.lang.locals.no_data_to_preview]:e,datasets:[{label:this.lang.locals.indexed_sources_percentage,data:g}]},options:this.getNewsPercentageChartOptions()}}getNewsPercentageChartOptions(){return F(k({},this.getChartOptions()),{plugins:{legend:{display:!0,position:"top"},tooltip:F(k({},this.getChartOptions().plugins.tooltip),{callbacks:{title:()=>this.lang.locals.keywords,label:n=>[`${n.label||""}:${this.lang.locals.no_data_to_preview?0:n.raw}%`]}}),datalabels:{textAlign:"center",color:"#ffffff",font:{size:14},backgroundColor:n=>n.dataset.backgroundColor[n.dataIndex],borderColor:"#ffffff",borderRadius:8,borderWidth:1,padding:{left:10,right:10},display:n=>{let t=n.dataset.data;return t[n.dataIndex]>0||t.length===1},formatter:(n,t)=>{let e=t.chart.data.labels[t.dataIndex];return[e,`${e===this.lang.locals.no_data_to_preview?0:n}%`]}}},scales:void 0})}getChartOptions(){return{responsive:!0,indexAxis:"y",plugins:{legend:{display:!0},tooltip:{rtl:this.lang.currentLanguage==="ar"},zoom:{zoom:{wheel:{enabled:!0},drag:{enabled:!0},pinch:{enabled:!0},mode:"xy"},pan:{enabled:!0,mode:"xy"},limits:{x:{min:0,max:100},y:{min:0,max:100}}}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:12}}}}}}resetIndexedZoom(){this.mostIndexedChart()?.chart?.resetZoom()}resetKeywordsZoom(){this.mostUsedKeywordsChart()?.chart?.resetZoom()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=O({type:a,selectors:[["app-statistics"]],viewQuery:function(t,e){t&1&&(D(e.mostIndexedChart,de,5,b),D(e.mostUsedKeywordsChart,se,5,b)),t&2&&G(2)},standalone:!0,features:[W],decls:53,vars:37,consts:[["indexedChart",""],["keywordsChart",""],[1,"w-full","mx-auto","p-2"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"col-span-1","p-8","bg-white","rounded-2xl","shadow-lg","border","border-gray-200"],[1,"text-2xl","font-semibold","text-gray-700","mb-1"],[1,"text-xs","text-gray-500","mb-3"],[1,"flex","flex-col","md:flex-row","gap-4","mb-4","text-gray-700",3,"formGroup"],[1,"flex","flex-col","flex-auto"],["for","from_date",1,"text-sm","font-medium"],["type","date","formControlName","from_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],[1,"text-red-500","text-xs"],["for","to_date",1,"text-sm","font-medium"],["type","date","formControlName","to_date",1,"rounded-md","p-2","border-2","border-gray-300","outline-none","focus:border-primary"],[2,"display","block"],[1,"relative","overflow-hidden","h-28","p-6","bg-white","border","border-gray-200","rounded-2xl","shadow-md","hover:shadow-lg","transition"],[1,"text-gray-700","text-2xl","font-semibold"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mt-2"],["baseChart","",1,"max-h-56",3,"type","datasets","labels","options"],[1,"mt-2","text-sm","text-blue-500","hover:underline",3,"click"],[1,"h-10","bg-gray-300","rounded","animate-pulse","mb-4"],[1,"h-56","bg-gray-300","rounded","animate-pulse"],[1,"text-gray-900","text-4xl","font-bold","mt-2"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"absolute","w-40","h-32","top-0","rtl:left-0","right-0","m-2","opacity-50","mr-auto"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M6 14.5H14","stroke","#bfbfbf","stroke-width","1.5","stroke-linecap","round"],["d","M6 18H11.5","stroke","#bfbfbf","stroke-width","1.5","stroke-linecap","round"],["d","M13 2.5V5C13 7.35702 13 8.53553 13.7322 9.26777C14.4645 10 15.643 10 18 10H22","stroke","#bfbfbf","stroke-width","1.5"],["d","M2.75 10C2.75 9.58579 2.41421 9.25 2 9.25C1.58579 9.25 1.25 9.58579 1.25 10H2.75ZM21.25 14C21.25 14.4142 21.5858 14.75 22 14.75C22.4142 14.75 22.75 14.4142 22.75 14H21.25ZM15.3929 4.05365L14.8912 4.61112L15.3929 4.05365ZM19.3517 7.61654L18.85 8.17402L19.3517 7.61654ZM21.654 10.1541L20.9689 10.4592V10.4592L21.654 10.1541ZM3.17157 20.8284L3.7019 20.2981H3.7019L3.17157 20.8284ZM20.8284 20.8284L20.2981 20.2981L20.2981 20.2981L20.8284 20.8284ZM1.35509 5.92658C1.31455 6.33881 1.61585 6.70585 2.02807 6.7464C2.4403 6.78695 2.80734 6.48564 2.84789 6.07342L1.35509 5.92658ZM22.6449 18.0734C22.6855 17.6612 22.3841 17.2941 21.9719 17.2536C21.5597 17.2131 21.1927 17.5144 21.1521 17.9266L22.6449 18.0734ZM14 21.25H10V22.75H14V21.25ZM2.75 14V10H1.25V14H2.75ZM21.25 13.5629V14H22.75V13.5629H21.25ZM14.8912 4.61112L18.85 8.17402L19.8534 7.05907L15.8947 3.49618L14.8912 4.61112ZM22.75 13.5629C22.75 11.8745 22.7651 10.8055 22.3391 9.84897L20.9689 10.4592C21.2349 11.0565 21.25 11.742 21.25 13.5629H22.75ZM18.85 8.17402C20.2034 9.3921 20.7029 9.86199 20.9689 10.4592L22.3391 9.84897C21.9131 8.89241 21.1084 8.18853 19.8534 7.05907L18.85 8.17402ZM10.0298 2.75C11.6116 2.75 12.2085 2.76158 12.7405 2.96573L13.2779 1.5653C12.4261 1.23842 11.498 1.25 10.0298 1.25V2.75ZM15.8947 3.49618C14.8087 2.51878 14.1297 1.89214 13.2779 1.5653L12.7405 2.96573C13.2727 3.16993 13.7215 3.55836 14.8912 4.61112L15.8947 3.49618ZM10 21.25C8.09318 21.25 6.73851 21.2484 5.71085 21.1102C4.70476 20.975 4.12511 20.7213 3.7019 20.2981L2.64124 21.3588C3.38961 22.1071 4.33855 22.4392 5.51098 22.5969C6.66182 22.7516 8.13558 22.75 10 22.75V21.25ZM1.25 14C1.25 15.8644 1.24841 17.3382 1.40313 18.489C1.56076 19.6614 1.89288 20.6104 2.64124 21.3588L3.7019 20.2981C3.27869 19.8749 3.02502 19.2952 2.88976 18.2892C2.75159 17.2615 2.75 15.9068 2.75 14H1.25ZM14 22.75C15.8644 22.75 17.3382 22.7516 18.489 22.5969C19.6614 22.4392 20.6104 22.1071 21.3588 21.3588L20.2981 20.2981C19.8749 20.7213 19.2952 20.975 18.2892 21.1102C17.2615 21.2484 15.9068 21.25 14 21.25V22.75ZM10.0298 1.25C8.15538 1.25 6.67442 1.24842 5.51887 1.40307C4.34232 1.56054 3.39019 1.8923 2.64124 2.64124L3.7019 3.7019C4.12453 3.27928 4.70596 3.02525 5.71785 2.88982C6.75075 2.75158 8.11311 2.75 10.0298 2.75V1.25ZM2.84789 6.07342C2.96931 4.83905 3.23045 4.17335 3.7019 3.7019L2.64124 2.64124C1.80633 3.47616 1.48944 4.56072 1.35509 5.92658L2.84789 6.07342ZM21.1521 17.9266C21.0307 19.1609 20.7695 19.8266 20.2981 20.2981L21.3588 21.3588C22.1937 20.5238 22.5106 19.4393 22.6449 18.0734L21.1521 17.9266Z","fill","#bfbfbf"]],template:function(t,e){if(t&1&&(l(0,"div",2)(1,"div",3)(2,"div",4)(3,"h2",5),s(4),i(),l(5,"p",6),s(6),i(),l(7,"form",7)(8,"div",8)(9,"label",9),s(10),i(),p(11,"input",10),u(12,me,2,1,"span",11),i(),l(13,"div",8)(14,"label",12),s(15),i(),p(16,"input",13),u(17,ce,2,1,"span",11),i()(),u(18,pe,5,5),y(19,"async"),u(20,ue,2,0),i(),l(21,"div",4)(22,"h2",5),s(23),i(),l(24,"p",6),s(25),i(),l(26,"form",7)(27,"div",8)(28,"label",9),s(29),i(),p(30,"input",10),u(31,ge,2,1,"span",11),i(),l(32,"div",8)(33,"label",12),s(34),i(),p(35,"input",13),u(36,Ce,2,1,"span",11),i()(),u(37,_e,5,5),y(38,"async"),u(39,fe,2,0),i(),l(40,"div",4)(41,"h2",5),s(42),i(),u(43,he,3,4,"div",14),y(44,"async"),u(45,xe,2,0),i(),l(46,"div",15)(47,"h2",16),s(48),i(),z(49),y(50,"async"),u(51,be,1,0,"div",17)(52,ve,10,1),i()()()),t&2){let c,g,r,d,C,_,P;o(4),m(e.lang.locals.most_indexed_urls),o(2),m(e.lang.locals.chart_zoom_tip),o(),x("formGroup",e.indexedForm),o(3),m(e.lang.locals.start_time),o(),w("border-red-500",(e.indexedForm.errors==null?null:e.indexedForm.errors.DateInvalidRangeIndexed)&&e.indexedForm.touched),o(),h(e.indexedForm.errors!=null&&e.indexedForm.errors.DateInvalidRangeIndexed&&((c=e.indexedForm.get("from_date"))!=null&&c.touched||(c=e.indexedForm.get("to_date"))!=null&&c.touched)?12:-1),o(3),m(e.lang.locals.end_time),o(),w("border-red-500",(e.indexedForm.errors==null?null:e.indexedForm.errors.DateInvalidRangeIndexed)&&e.indexedForm.touched),o(),h(e.indexedForm.errors!=null&&e.indexedForm.errors.DateInvalidRangeIndexed&&((g=e.indexedForm.get("from_date"))!=null&&g.touched||(g=e.indexedForm.get("to_date"))!=null&&g.touched)?17:-1),o(),h((r=S(19,28,e.mostIndexedUrl$))?18:20,r),o(5),m(e.lang.locals.most_used_keywords),o(2),m(e.lang.locals.chart_zoom_tip),o(),x("formGroup",e.keywordsForm),o(3),m(e.lang.locals.start_time),o(),w("border-red-500",(e.keywordsForm.errors==null?null:e.keywordsForm.errors.DateInvalidRangeKeyword)&&e.keywordsForm.touched),o(),h(e.keywordsForm.errors!=null&&e.keywordsForm.errors.DateInvalidRangeKeyword&&((d=e.keywordsForm.get("from_date"))!=null&&d.touched||(d=e.keywordsForm.get("to_date"))!=null&&d.touched)?31:-1),o(3),m(e.lang.locals.end_time),o(),w("border-red-500",(e.keywordsForm.errors==null?null:e.keywordsForm.errors.DateInvalidRangeKeyword)&&e.keywordsForm.touched),o(),h(e.keywordsForm.errors!=null&&e.keywordsForm.errors.DateInvalidRangeKeyword&&((C=e.keywordsForm.get("from_date"))!=null&&C.touched||(C=e.keywordsForm.get("to_date"))!=null&&C.touched)?36:-1),o(),h((_=S(38,30,e.mostUsedKeywords$))?37:39,_),o(5),m(e.lang.locals.indexed_sources_percentage),o(),h((P=S(44,32,e.newsPercentage$))?43:45,P),o(5),m(e.lang.locals.total_indexed_news),o();let U=B(S(50,34,e.numberOfIndexedNews$));o(2),h(U==null?51:52)}},dependencies:[Q,b,ae,ee,J,X,Y,te,ne],encapsulation:2})};export{le as StatisticsComponent};
