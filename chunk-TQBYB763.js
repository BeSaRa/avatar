import{a as Be,b as He,c as Ue}from"./chunk-HHPITOA4.js";import{a as B}from"./chunk-QZPNBOA6.js";import{a as Ae}from"./chunk-KQIHERE2.js";import{a as S}from"./chunk-GPJGLLXF.js";import{a as Pe}from"./chunk-FTP5OKF7.js";import{a as ze,c as ke}from"./chunk-5BZPFUY4.js";import"./chunk-J2HB2Y4E.js";import{a as Ne}from"./chunk-GNG7ILZA.js";import{a as $e}from"./chunk-SIWWJH65.js";import"./chunk-2IE76L77.js";import{b as H}from"./chunk-B26V2M5L.js";import{a as Ye}from"./chunk-73NYINMC.js";import"./chunk-FWDT53KA.js";import{a as Ve}from"./chunk-XIYR6XWG.js";import"./chunk-QW4DZL5W.js";import"./chunk-2LKYGCHS.js";import"./chunk-X5CIYX27.js";import"./chunk-6IGLDT6K.js";import{a as je}from"./chunk-2N4EDZNV.js";import"./chunk-ANBYP55K.js";import{b as V}from"./chunk-EARLHVX5.js";import{a as N}from"./chunk-HC4WQR6A.js";import{b as De}from"./chunk-WLQKWWON.js";import{$ as Me,ba as Oe,ea as Ee,ia as Le,la as Fe,xa as $}from"./chunk-MFSWGIIO.js";import{c as Ie,d as Te,f as j,g as D,i as Re}from"./chunk-OK5S6IU3.js";import{b as P}from"./chunk-DYBLNUKQ.js";import"./chunk-PXW4CVT7.js";import{$b as X,Ac as f,B as ie,Bc as v,Db as C,Eb as ue,Ha as z,Hd as be,Ia as k,Ja as pe,Jb as A,K as ne,Ka as de,Kc as Ce,La as E,Lc as M,N as re,Na as L,Nc as x,Ob as _,Oc as _e,P as oe,Qc as xe,Sb as s,Sc as Se,T as Y,Ta as me,Ua as J,V as ae,Wb as ge,X as se,Xb as u,Yb as he,Z as le,_b as K,ac as o,bc as a,cc as p,f as Ge,gc as T,ha as ce,hd as ye,i as W,ia as Z,jc as g,ka as w,lb as F,lc as m,mb as I,q as Q,sb as r,ta as c,td as we,vd as O,wc as fe,x as G,xa as b,xc as ve,yc as R,zc as d}from"./chunk-O6QGGAL6.js";var Ze=["container"],Je=(t,i)=>i.id,Ke=(t,i)=>({"mdi-chevron-down":t,"mdi-chevron-up":i});function Xe(t,i){if(t&1){let e=T();o(0,"div",7),g("animating",function(l){z(e);let y=m(2);return k(y.animationStatus.set(l))}),a()}if(t&2){let e=m().$implicit;s("text",e.content)}}function et(t,i){if(t&1&&p(0,"div",6),t&2){let e=m().$implicit;s("innerHtml",e.content,F)}}function tt(t,i){if(t&1&&(o(0,"div",12)(1,"div",13)(2,"small",14),d(3),p(4,"i",15),a()(),o(5,"a",16),d(6),a()()),t&2){let e=i.$implicit,n=i.$index;r(3),v(" doc ",n+1," "),r(3),f(e.filepath)}}function it(t,i){if(t&1){let e=T();o(0,"div")(1,"div",8),g("click",function(){z(e);let l=R(6);return k(l.hidden=!l.hidden)}),p(2,"i",9),o(3,"span",10),d(4,"References"),a()(),o(5,"div",11,1),K(7,tt,7,2,"div",12,he),a()()}if(t&2){let e=R(6),n=m().$implicit;r(2),s("ngClass",_e(1,Ke,e.hidden,!e.hidden)),r(5),X(n.context.citations)}}function nt(t,i){if(t&1&&(o(0,"div"),_(1,Xe,1,1,"div",5)(2,et,1,1,"div",6)(3,it,9,4,"div"),a()),t&2){let e=i.$implicit;ge("message ",e.role,""),r(),u(e.role==="assistant"?1:2),r(2),u(e.context&&e.context.citations.length?3:-1)}}var U=class t{container=ue.required("container");injector=c(L);service=c(S);animationStatus=C(!1);static \u0275fac=function(e){return new(e||t)};static \u0275cmp=b({type:t,selectors:[["app-overlay-chat"]],viewQuery:function(e,n){e&1&&fe(n.container,Ze,5),e&2&&ve()},standalone:!0,features:[M],decls:5,vars:0,consts:[["container",""],["linkRef",""],[1,"flex","flex-col","w-full","max-h-full","overflow-y-auto","no-scrollbar","overflow-x-hidden"],[1,"flex-auto","flex","flex-col","gap-1","w-full","relative","px-2","[&>.message.user]:justify-start","[&>.message]:text-white"],[3,"class"],["appTextWriterAnimator","",1,"whitespace-pre-wrap","break-words",3,"text"],[1,"whitespace-pre-wrap","break-words",3,"innerHtml"],["appTextWriterAnimator","",1,"whitespace-pre-wrap","break-words",3,"animating","text"],[1,"icon-with-title",3,"click"],[1,"mdi",3,"ngClass"],[1,"title"],["hidden",""],["dir","auto"],[1,"d-inline"],[1,"px-1","text-primary"],[1,"mdi","mdi-link-variant"],[1,"d-inline","citation-link",2,"cursor","pointer"]],template:function(e,n){e&1&&(o(0,"div",2)(1,"div",3,0),K(3,nt,4,5,"div",4,Je),a()()),e&2&&(r(3),X(n.service.messages()))},dependencies:[O,$e],styles:['.message[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;font-size:.875rem;line-height:1.25rem}.message.user[_ngcontent-%COMP%]{align-items:flex-start}.message.user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-radius:.375rem;border-top-right-radius:0;background-color:#00000080;padding:.125rem}.message.user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{content:"";position:absolute;right:-8px;top:0;width:8px;height:8px;clip-path:polygon(0 0,100% 0,0 100%);background-color:inherit}.message.assistant[_ngcontent-%COMP%]{align-items:flex-end}.message.assistant[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-radius:.375rem;border-top-left-radius:0;background-color:#0003;padding:.125rem}.message.assistant[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{content:"";position:absolute;left:-8px;top:0;background-color:inherit;width:8px;height:8px;clip-path:polygon(0 0,100% 0,100% 100%)}']})};var h=Ge(Ye());var rt=t=>({"-start-10 opacity-100":t});function ot(t,i){if(t&1&&(p(0,"app-spinner-loader",11),o(1,"span"),d(2),a()),t&2){let e=m();s("color",e.appColors.PRIMARY)("borderWidth",2)("width",20),r(2),f(e.lang.locals.loading)}}function at(t,i){if(t&1&&(p(0,"img",10),o(1,"span"),d(2),a()),t&2){let e=m();s("src","assets/icons/speak.png",I),r(2),f(e.lang.locals.click_to_speak)}}function st(t,i){if(t&1&&(p(0,"img",10),o(1,"span"),d(2),a()),t&2){let e=m();s("src","assets/icons/speak.png",I),r(2),f(e.lang.locals.listening_ongoing)}}function lt(t,i){if(t&1&&(p(0,"div",12),xe(1,"sanitizer"),o(2,"span"),d(3),a()),t&2){let e=m();s("innerHTML",Se(1,2,e.svgIcons.SEND,"html"),F),r(3),f(e.lang.locals.click_to_send)}}var q=class t extends N(class{}){overlayChatComponent=J.required();waves=J.required();store=c(V);chatService=c(S);chatHistoryService=c(Ve);avatarService=c(H);injector=c(L);recognizedText=C("");recognizingText=C("");speechService=c(je);recognizing$=me();recognized$=new Q;accept$=new Q;recognizingStatus=C(!1);botNames$=this.chatHistoryService.getAllBotNames().pipe(w(i=>this.chatService.botNameCtrl.patchValue(i.at(0))));lang=c(P);appColors=Be;svgIcons=Ae;ngOnInit(){return W(this,null,function*(){this.listenToAccept(),this.listenToBotNameChange(),yield this.prepareRecorder()})}listenToBotNameChange(){this.chatService.onBotNameChange().pipe(Z(this.destroy$)).subscribe()}prepareRecorder(){return W(this,null,function*(){this.recordingStream=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.waveSurfer=new He({waveColor:"white",progressColor:"white",container:this.waves(),height:"auto"}),this.recorder=this.waveSurfer.registerPlugin(Ue.create({scrollingWaveform:!1})),this.recorder.renderMicStream(this.recordingStream);let i=h.AudioConfig.fromDefaultMicrophoneInput(),e=h.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US"]);this.recognizer=h.SpeechRecognizer.FromConfig(h.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region()),e,i),this.recognizer.recognizing=(n,l)=>{l.result.reason===h.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+l.result.text),this.recognizing$.emit(this.recognizingText()),this.recognizingStatus.set(!0))},this.recognizer.recognized=(n,l)=>{l.result.reason===h.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(y=>y+" "+l.result.text),this.recognized$.next(),this.recognizingStatus.set(!1))},this.recognizer.canceled=()=>{this.store.recordingInProgress(),this.speechService.generateSpeechToken().pipe(Y(1)).subscribe(()=>{this.prepareRecorder().then(()=>this.startRecording())})}})}startRecording(){this.store.recordingInProgress(),this.recognizer.startContinuousRecognitionAsync(()=>{this.recognizer.internalData.privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)})}stopRecording(){this.recognizer.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped()})}toggleRecording(){this.store.isRecordingLoading()||(this.store.isRecordingStarted()?this.acceptText():this.startRecording())}acceptText(){this.accept$.next()}rejectText(){this.recognizingText.set(""),this.recognizedText.set(""),this.recognizing$.emit(""),this.recognizingStatus.set(!1),this.stopRecording()}goToEndOfChat(){setTimeout(()=>{let i=this.overlayChatComponent().container().nativeElement.querySelectorAll(".user");i[i.length-1].scrollIntoView(!0)},100)}listenToAccept(){this.accept$.pipe(ie(()=>this.recognizedText())).pipe(re(i=>!!i)).pipe(Z(this.destroy$)).pipe(w(()=>{this.recognizedText.set(""),this.recognizingText.set(""),this.recognizingStatus.set(!1),this.recognizing$.emit(""),this.stopRecording()})).pipe(w(()=>this.goToEndOfChat())).pipe(se(i=>this.chatService.sendMessage(i,this.chatService.botNameCtrl.value))).pipe(ae(200)).subscribe(()=>{let i=this.overlayChatComponent().container().nativeElement.querySelectorAll(".assistant"),e=setInterval(()=>i[i.length-1].scrollIntoView(!1),200),n=ye(()=>{this.overlayChatComponent().animationStatus()||(clearInterval(e),n.destroy())},{injector:this.injector})})}clearChat(){this.chatService.messages.set([])}interruptAvatar(){this.avatarService.interruptAvatar().pipe(Y(1)).subscribe()}static \u0275fac=(()=>{let i;return function(n){return(i||(i=E(t)))(n||t)}})();static \u0275cmp=b({type:t,selectors:[["app-screen-control"]],inputs:{overlayChatComponent:[1,"overlayChatComponent"],waves:[1,"waves"]},outputs:{recognizing$:"recognizing$"},standalone:!0,features:[Ce([S]),A,M],decls:18,vars:16,consts:[[1,"relative","h-16","flex","justify-center","items-center","gap-2"],[1,"relative","h-full","w-16"],["matTooltipPosition","before","appButton","","shape","pill",1,"!p-1","!absolute","top-1/2","-translate-y-1/2","opacity-0","transition-all","duration-300",3,"click","matTooltip","ngClass"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"w-5","h-5"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],[1,"relative","h-full","!w-16","flex","flex-col","items-center","justify-center","bg-secondary-100","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"!w-16","h-full","flex","flex-col","items-center","justify-center","bg-secondary-100","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"relative","size-6"],["alt","start",1,"w-full","h-full",3,"src"],["alt","start",1,"absolute","top-0","left-0","w-full","h-full","opacity-60",3,"src"],["alt","start",1,"size-6",3,"src"],[3,"color","borderWidth","width"],[1,"size-6",3,"innerHTML"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return n.rejectText()}),pe(),o(3,"svg",3),p(4,"path",4),a()(),de(),o(5,"button",5),g("click",function(){return n.toggleRecording()}),_(6,ot,3,4)(7,at,3,2)(8,st,3,2)(9,lt,4,5),a()(),o(10,"button",6),g("click",function(){return n.interruptAvatar()}),o(11,"span",7),p(12,"img",8)(13,"img",9),a(),d(14),a(),o(15,"button",6),g("click",function(){return n.clearChat()}),p(16,"img",10),d(17),a()()),e&2&&(r(2),s("matTooltip",n.lang.locals.cancel_recording)("ngClass",x(14,rt,n.store.isRecordingStarted())),r(3),s("disabled",n.store.isRecordingLoading()||n.recognizingStatus()),r(),u(n.store.isRecordingLoading()?6:-1),r(),u(n.store.isRecordingStopped()?7:-1),r(),u(n.store.isRecordingStarted()&&n.recognizingStatus()?8:-1),r(),u(n.store.isRecordingStarted()&&!n.recognizingStatus()?9:-1),r(),s("disabled",!n.store.isStreamStarted()),r(2),s("src","assets/icons/speak.png",I),r(),s("src","assets/icons/stop.png",I),r(),v(" ",n.lang.locals.stop_talking," "),r(),s("disabled",!n.chatService.messages().length),r(),s("src","assets/icons/clear-chat.png",I),r(),v(" ",n.lang.locals.clear_chat_history," "))},dependencies:[O,De,$,Ne,Pe,B]})};var ee=t=>({hidden:t}),ct=t=>({"!justify-end":t});function pt(t,i){if(t&1&&(o(0,"span",14),d(1),a()),t&2){let e=m();r(),f(e.text())}}function dt(t,i){t&1&&(o(0,"div",16)(1,"div",18),p(2,"div")(3,"div")(4,"div")(5,"div"),a()())}function mt(t,i){if(t&1){let e=T();o(0,"div",17)(1,"div",19)(2,"span",20),d(3),a(),p(4,"input",21),o(5,"button",22),g("click",function(){z(e);let l=m();return k(l.saveStreamId())}),d(6),a()()()}if(t&2){let e=m();r(3),v("",e.lang.locals.scan_qr,":"),r(),s("formControl",e.streamId),r(),s("disabled",e.streamId.invalid),r(),v(" ",e.lang.locals.save," ")}}var te=class t extends N(class{}){_route=c(ze);_router=c(ke);_location=c(we);_avatarService=c(H);store=c(V);lang=c(P);chatService=c(S);streamId=new Le("",[Oe.required]);isLoading=!1;text=C("");ngAfterViewInit(){this.streamId.setValue(this._route.snapshot.queryParamMap.get("streamId")),this.store.updateStreamId(this.streamId.value??""),this._checkStreamId().subscribe(),this._checkStreamRecursivley().subscribe()}_checkStreamId(i=!0){return this.store.hasStream()?(i&&(this.isLoading=!0),this._avatarService.checkStreamStatus().pipe(le(()=>this.isLoading=!1),oe(()=>(this._clearStreamId(),G(null))))):G(null)}_checkStreamRecursivley(){return this._checkStreamId(!1).pipe(ce(()=>ne(6e4).pipe(w(()=>this._checkStreamRecursivley().subscribe()))))}_clearStreamId(){this.store.updateStreamId("");let i=this._router.parseUrl(this._router.url);i.queryParams={},this._location.replaceState(i.toString())}saveStreamId(){this.store.updateStreamId(this.streamId.value??"");let i=this._router.parseUrl(this._router.url);i.queryParams=this.streamId.value?{streamId:this.streamId.value}:{},this._location.replaceState(i.toString()),this._checkStreamId().subscribe()}recognizing(i){this.text.set(i)}static \u0275fac=(()=>{let i;return function(n){return(i||(i=E(t)))(n||t)}})();static \u0275cmp=b({type:t,selectors:[["app-control"]],standalone:!0,features:[A,M],decls:19,vars:17,consts:[["waves",""],["overlayChatComponent",""],[1,"w-full","h-full","px-4","bg-secondary-100/80","rounded-xl","flex","justify-center","items-center","gap-12"],[1,"w-full","md:w-[500px]","h-full","flex","flex-col","justify-between","items-center"],[1,"py-4","relative","max-w-[250px]","text-2xl","text-accent","font-light","flex","justify-center","items-center","gap-4"],["src","assets/icons/login-sparkles.svg","alt","login-sparkles",1,"w-12","h-16"],[1,"h-full","w-full","py-2","flex","flex-col","justify-between","items-center","gap-1","bg-accent/90","rounded-t-3xl"],[1,"w-36","h-6"],[1,"w-full","h-full","overflow-hidden","transition-all","rounded-full","border","border-white","border-white/30",3,"ngClass"],[1,"w-full","pointer-events-none","h-full","opacity-90"],[1,"h-full","max-h-[300px]","w-full","flex","flex-col","items-center","justify-center",3,"ngClass"],[1,"w-full","max-h-full",3,"ngClass"],["src","assets/images/messages.png","alt","messages",1,"w-full","md:w-[300px]",3,"ngClass"],[1,"h-4","w-full","flex","items-center","justify-center"],[1,"flex","items-center","justify-center","bg-black/70","text-white","text-xs","rounded","px-2"],[3,"recognizing$","overlayChatComponent","waves"],[1,"absolute","left-0","top-0","w-full","h-full","z-50","flex","items-center","justify-center","bg-black/60","overflow-hidden","ltr:rounded-tl-xl","rtl:rounded-tr-xl"],[1,"absolute","left-0","top-0","w-full","h-full","z-50","flex","items-center","justify-center","bg-black/80","overflow-hidden","ltr:rounded-tl-xl","rtl:rounded-tr-xl"],[1,"lds-ellipsis"],[1,"flex","flex-col","items-center","justify-center","gap-4"],[1,"max-w-[700px]","font-bold","text-white","text-3xl"],["placeholder","Stream ID*","dir","ltr",1,"rounded-md","p-3","w-full","text-xl","border-2","border-accent-300","placeholder-accent-300","text-accent","outline-none","focus:border-accent","transition-colors",3,"formControl"],["appButton","","color","accent","size","2xl",1,"w-full",3,"click","disabled"]],template:function(e,n){if(e&1){let l=T();o(0,"div",2)(1,"div",3)(2,"div",4),p(3,"img",5),d(4),a(),o(5,"div",6)(6,"div",7)(7,"div",8),p(8,"div",9,0),a()(),o(10,"div",10),p(11,"app-overlay-chat",11,1)(13,"img",12),a(),o(14,"div",13),_(15,pt,2,1,"span",14),a(),o(16,"app-screen-control",15),g("recognizing$",function(Qe){return z(l),k(n.recognizing(Qe))}),a()()()(),_(17,dt,6,0,"div",16)(18,mt,7,4,"div",17)}if(e&2){let l=R(9),y=R(12);r(4),v(" ",n.lang.locals.login_greeting_message," "),r(3),s("ngClass",x(9,ee,!n.store.isRecordingStarted())),r(3),s("ngClass",x(11,ct,n.chatService.messages().length)),r(),s("ngClass",x(13,ee,!n.chatService.messages().length)),r(2),s("ngClass",x(15,ee,n.chatService.messages().length)),r(2),u(n.text()?15:-1),r(),s("overlayChatComponent",y)("waves",l),r(),u(n.isLoading?17:n.store.hasStream()?-1:18)}},dependencies:[be,O,U,q,$,Me,Ee,Fe,B],data:{animation:[Ie("recordButton",[D("InProgress",j({transform:"scale(1)",backgroundColor:"gray"})),D("Started",j({transform:"scale(1)"})),D("Stopped",j({transform:"scale(0)"})),Re("* <=> *",[Te("150ms ease-in-out")])])]}})};export{te as default};
