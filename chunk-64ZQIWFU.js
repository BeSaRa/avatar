import{a as We}from"./chunk-FBS6Y7ZU.js";import{v as je}from"./chunk-KIZCJSGD.js";import{c as Ee}from"./chunk-OHIWOG7L.js";import"./chunk-KNZUA67I.js";import"./chunk-5BZPFUY4.js";import{a as $e}from"./chunk-6MUGNO6H.js";import{a as Be,b as Pe,c as Ne,d as Ae,e as ze,f as Re}from"./chunk-TS34SMTU.js";import"./chunk-J2HB2Y4E.js";import"./chunk-ZX4VXR5W.js";import{a as De}from"./chunk-FAMFBZKA.js";import"./chunk-FWDT53KA.js";import{a as Me}from"./chunk-XIYR6XWG.js";import"./chunk-QW4DZL5W.js";import"./chunk-2LKYGCHS.js";import"./chunk-X5CIYX27.js";import"./chunk-6IGLDT6K.js";import"./chunk-2N4EDZNV.js";import"./chunk-ANBYP55K.js";import"./chunk-EARLHVX5.js";import{a as Fe}from"./chunk-IHOFWBF3.js";import{a as Ie}from"./chunk-HC4WQR6A.js";import{b as Y}from"./chunk-WLQKWWON.js";import{$ as Le,Pa as Z,Qa as q,Ra as Q,ea as Oe,ia as He,la as Ve,xa as G}from"./chunk-MFSWGIIO.js";import"./chunk-OK5S6IU3.js";import{b as B}from"./chunk-DYBLNUKQ.js";import"./chunk-PXW4CVT7.js";import{$b as T,Ac as x,B as ae,Bc as h,Bd as we,C as se,Db as b,Dd as Se,Eb as ge,Ed as Te,Ha as m,Hc as z,Ia as u,Ja as _,Jb as ve,Ka as H,La as de,Lc as $,Mc as R,Nc as _e,Ob as C,Pc as be,Qc as L,Rc as E,Sb as f,Sc as ye,Ta as pe,Ua as D,Va as me,Xb as k,Yb as W,Z as ne,Zb as V,_b as S,a as I,ac as a,b as ie,bc as l,cc as v,fd as U,ga as re,gc as w,gd as xe,ha as le,hd as K,ia as N,jc as g,ka as F,lb as ue,lc as c,q as P,r as j,sb as s,ta as y,vd as ke,wc as Ce,xa as M,xc as he,yc as A,za as ce,zb as fe,zc as p}from"./chunk-O6QGGAL6.js";function Ze(n,e){if(n&1&&(a(0,"div",1)(1,"h2",2),p(2),l(),z(3),v(4,"canvas",3),l()),n&2){let t=e.$implicit;s(2),x(t.value.title);let i=t.value.chart;s(2),f("data",i.data)("labels",i.data.labels)("type",i.type)("options",i.options)}}var d={sentiment:{negative:{fill:"rgba(244, 67, 54, 0.8)",border:"rgb(244, 67, 54)"},mixed:{fill:"rgba(255, 193, 7, 0.8)",border:"rgb(255, 193, 7)"},positive:{fill:"rgba(76, 175, 80, 0.8)",border:"rgb(76, 175, 80)"},neutral:{fill:"rgba(158, 158, 158, 0.8)",border:"rgb(158, 158, 158)"},undefined:{fill:"rgba(96, 125, 139, 0.8)",border:"rgb(96, 125, 139)"}},feedback:{like:{fill:"rgba(76, 175, 80, 0.8)",border:"rgb(76, 175, 80)"},dislike:{fill:"rgba(244, 67, 54, 0.8)",border:"rgb(244, 67, 54)"},unspecified:{fill:"rgba(158, 158, 158, 0.8)",border:"rgb(158, 158, 158)"}}},X=class n{conversations=D.required();lang=y(B);charts=U(()=>this.conversations()?this.getCharts():this.getCharts());getCharts(){return{feedback_chart:{title:this.lang.locals.feedback_chart,chart:this.getFeedbackChartConfig()},sentiment_chart:{title:this.lang.locals.sentiment_chart,chart:this.getSentimentChartConfig()},performance_chart:{title:this.lang.locals.user_feedback_by_chatbot,chart:this.getBotPerformanceChartConfig()}}}getChartOptions(e=!1){return{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{rtl:this.lang.currentLanguage==="ar"}},scales:e?{x:{stacked:!0},y:{beginAtZero:!0,stacked:!0}}:void 0}}calculateSetimentDistribution(){let e={negative:0,mixed:0,positive:0,neutral:0,undefined:0};return this.conversations().forEach(t=>{this.isValidSentiment(t.sentiment)?e[t.sentiment]++:e.undefined++}),{labels:[`\u{1F61F}${this.lang.locals.negative}`,`\u{1F615}${this.lang.locals.mixed}`,`\u{1F60A}${this.lang.locals.positive}`,`\u{1F610}${this.lang.locals.neutral}`,`\u2753${this.lang.locals.unspecified}`],datasets:[{label:this.lang.locals.sentiment,data:Object.values(e),backgroundColor:[d.sentiment.negative.fill,d.sentiment.mixed.fill,d.sentiment.positive.fill,d.sentiment.neutral.fill,d.sentiment.undefined.fill],borderColor:[d.sentiment.negative.border,d.sentiment.mixed.border,d.sentiment.positive.border,d.sentiment.neutral.border,d.sentiment.undefined.border],borderWidth:2}]}}getSentimentChartConfig(){return{data:this.calculateSetimentDistribution(),type:"pie",options:this.getSentimentChartOptions()}}getSentimentChartOptions(){return ie(I({},this.getChartOptions()),{plugins:{legend:{display:!0,labels:{boxWidth:20,padding:10,font:{size:14,family:"Lusail"}},position:"top"},tooltip:ie(I({},this.getChartOptions().plugins.tooltip),{callbacks:{title:()=>this.lang.locals.sentiment,label:e=>{let t=e.label||"",r=e.dataset.data.reduce((O,te)=>O+te,0),o=(e.raw/r*100).toFixed(1);return[`${t}:${o}%`,`${this.lang.locals.total}:${e.raw}`]}}}),datalabels:{textAlign:"center",color:"#ffffff",font:{size:14},backgroundColor:e=>e.dataset.backgroundColor[e.dataIndex],borderColor:"#ffffff",borderRadius:8,borderWidth:1,padding:{left:10,right:10},display:e=>{let t=e.dataset.data,i=t[e.dataIndex],r=t.reduce((o,O)=>o+O,0);return i>r*.1},formatter:(e,t)=>{let r=t.dataset.data.reduce((te,Ge)=>te+Ge,0),o=(e/r*100).toFixed(1);return[t.chart.data.labels[t.dataIndex],`${o}%`,`${this.lang.locals.total}:${e}`]}}}})}calculateFeedbackDistribution(){let e=0,t=0,i=0;return this.conversations().forEach(r=>{this.isValidFeedback(r.feedback)?r.feedback>0?e++:r.feedback<0?t++:i++:i++}),{labels:[this.lang.locals.feedback],datasets:[{label:this.lang.locals.like,data:[e],backgroundColor:d.feedback.like.fill,borderColor:d.feedback.like.border,borderWidth:2},{label:this.lang.locals.dislike,data:[t],backgroundColor:d.feedback.dislike.fill,borderColor:d.feedback.dislike.border,borderWidth:2},{label:this.lang.locals.unspecified,data:[i],backgroundColor:d.feedback.unspecified.fill,borderColor:d.feedback.unspecified.border,borderWidth:2}]}}getFeedbackChartConfig(){return{data:this.calculateFeedbackDistribution(),type:"bar",options:this.getChartOptions()}}calculateBotPerformance(){let e={};return this.conversations().forEach(t=>{let i=t.bot_name;e[i]||(e[i]={likes:0,dislikes:0,unspecified:0}),this.isValidFeedback(t.feedback)?t.feedback>0?e[i].likes++:t.feedback<0?e[i].dislikes++:e[i].unspecified++:e[i].unspecified++}),{labels:Object.keys(e),datasets:[I({label:this.lang.locals.like,data:Object.values(e).map(t=>t.likes)},this.generateBotColor(0)),I({label:this.lang.locals.dislike,data:Object.values(e).map(t=>t.dislikes)},this.generateBotColor(1)),I({label:this.lang.locals.unspecified,data:Object.values(e).map(t=>t.unspecified)},this.generateBotColor(2))]}}getBotPerformanceChartConfig(){return{data:this.calculateBotPerformance(),type:"bar",options:this.getChartOptions(!0)}}generateBotColor(e){let t=[{background:d.feedback.like.fill,border:d.feedback.like.border},{background:d.feedback.dislike.fill,border:d.feedback.dislike.border},{background:d.feedback.unspecified.fill,border:d.feedback.unspecified.border}];if(e<t.length)return{backgroundColor:t[e].background,borderColor:t[e].border,borderWidth:2};let i=[d.feedback.like.fill,d.feedback.like.border,d.feedback.dislike.fill,d.feedback.dislike.border],r=i[e%i.length],o=r.replace("rgb","rgba").replace(")",", 0.6)"),O=r.replace("rgb","rgba").replace(")",", 1)");return{backgroundColor:o,borderColor:O,borderWidth:2}}isValidFeedback(e){return e!=null&&e!==""}isValidSentiment(e){return["negative","mixed","positive","neutral"].includes(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-chat-history-charts"]],inputs:{conversations:[1,"conversations"]},standalone:!0,features:[$],decls:4,vars:2,consts:[[1,"flex","flex-col","gap-4","mb-4","md:flex-row"],[1,"card","bg-white","shadow-md","p-4","rounded-lg","w-full","md:w-1/3","hover:shadow-lg"],[1,"text-lg","font-bold","text-center","mb-4","text-gray-700"],["baseChart","","role","img",1,"max-h-80","w-full",3,"data","labels","type","options"]],template:function(t,i){t&1&&(a(0,"div",0),S(1,Ze,5,5,"div",1,V),L(3,"keyvalue"),l()),t&2&&(s(),T(E(3,0,i.charts())))},dependencies:[je,Te]})};var J=class n{appicationUser=y(Ee).$applicationUser();el=y(me);renderer=y(fe);appDisableIfNoPermission=D.required();hasPermission=!0;showEffect=K(()=>{this.hasPermission=this.appicationUser.hasAllPermission(this.appDisableIfNoPermission()),this.renderer.setProperty(this.el.nativeElement,"disabled",!this.hasPermission),this.renderer.setAttribute(this.el.nativeElement,"aria-disabled",String(!this.hasPermission)),this.renderer.setStyle(this.el.nativeElement,"pointer-events",this.hasPermission?"auto":"none"),this.renderer.setStyle(this.el.nativeElement,"opacity",this.hasPermission?"1":"0.5")});preventIfUnauthorized(e){this.hasPermission||(e.stopImmediatePropagation(),e.preventDefault())}onMouseEvents(e){this.preventIfUnauthorized(e)}onKeyboardEvents(e){this.preventIfUnauthorized(e)}static \u0275fac=function(t){return new(t||n)};static \u0275dir=ce({type:n,selectors:[["","appDisableIfNoPermission",""]],hostBindings:function(t,i){t&1&&g("click",function(o){return i.onMouseEvents(o)})("mousedown",function(o){return i.onMouseEvents(o)})("dblclick",function(o){return i.onMouseEvents(o)})("keydown",function(o){return i.onKeyboardEvents(o)})("keyup",function(o){return i.onKeyboardEvents(o)})("keypress",function(o){return i.onKeyboardEvents(o)})},inputs:{appDisableIfNoPermission:[1,"appDisableIfNoPermission"]},standalone:!0})};var Qe=["conversationsContainer"],Ye=()=>["CHAT_HISTORY_CHAT"],Xe=n=>({"!bg-gray-400/40 !rounded-md !text-gray-700":n}),Je=(n,e,t)=>({"bg-green-100 text-green-800 border-green-400":n,"bg-red-100 text-red-800 border-red-400":e,"!bg-gray-100 !text-gray-800 !border-gray-400":t});function et(n,e){if(n&1){let t=w();a(0,"li",22),g("keyup.enter",function(){let r=m(t).$implicit,o=c(2);return u(o.onFilterTypeSelect(r))})("click",function(){let r=m(t).$implicit,o=c(2);return u(o.onFilterTypeSelect(r))}),p(1),l()}if(n&2){let t=e.$implicit;s(),h(" ",t.label," ")}}function tt(n,e){if(n&1&&(a(0,"div",19)(1,"ul",20),S(2,et,2,1,"li",21,V),l()()),n&2){let t=c();s(2),T(t.filterOptions)}}function it(n,e){if(n&1){let t=w();a(0,"button",23),g("click",function(){m(t);let r=c();return u(r.resetContorl())}),_(),a(1,"svg",24),v(2,"path",25),l()()}}function nt(n,e){if(n&1){let t=w();a(0,"p",28),g("keyup",function(){let r=m(t).$implicit,o=c(2);return u(o.onSuggestionSelect(r))})("click",function(){let r=m(t).$implicit,o=c(2);return u(o.onSuggestionSelect(r))}),p(1),l()}if(n&2){let t=e.$implicit;s(),h(" ",t.label," ")}}function rt(n,e){if(n&1&&(a(0,"div",26),S(1,nt,2,1,"p",27,V),l()),n&2){let t=c();s(),T(t.suggestions())}}function ot(n,e){if(n&1&&p(0),n&2){let t=c(2);h(" ",t.lang.locals.like," ")}}function at(n,e){if(n&1&&p(0),n&2){let t=c(2);h(" ",t.lang.locals.dislike," ")}}function st(n,e){if(n&1&&p(0),n&2){let t=c(2);h(" ",t.lang.locals.unspecified," ")}}function lt(n,e){if(n&1){let t=w();a(0,"li",29),g("keyup.enter",function(){let r=m(t).$implicit,o=c();return u(o.OnSelectConversation(r.conversation_id))})("click",function(){let r=m(t).$implicit,o=c();return u(o.OnSelectConversation(r.conversation_id))}),a(1,"p",30),p(2),L(3,"date"),l(),a(4,"div",31)(5,"div",32)(6,"p",33),p(7),l(),a(8,"p",34),C(9,ot,1,1)(10,at,1,1)(11,st,1,1),l()(),a(12,"div",35)(13,"div",36)(14,"span",37),p(15),l()()()()()}if(n&2){let t,i=e.$implicit,r=c();f("appDisableIfNoPermission",R(13,Ye))("ngClass",_e(14,Xe,r.selectedConversation()===i.conversation_id)),s(2),x(ye(3,10,i.timestamp,"short")),s(4),f("matTooltip",r.lang.locals.conversation_title),s(),h(" ",i.title," "),s(),f("matTooltip",r.lang.locals.feedback)("ngClass",be(16,Je,i.feedback===r.feedbackOptions.LIKE,i.feedback===r.feedbackOptions.DISLIKE,i.feedback===r.feedbackOptions.UNSPECIFIED)),s(),k((t=i.feedback)===r.feedbackOptions.LIKE?9:t===r.feedbackOptions.DISLIKE?10:11),s(3),f("matTooltip",r.lang.locals[i.sentiment]),s(3),x(i.getEmojiPerSetiment())}}function ct(n,e){if(n&1&&(a(0,"div",18),_(),a(1,"svg",38),v(2,"path",39),l(),H(),a(3,"span",40),p(4),l()()),n&2){let t=c();s(4),x(t.lang.locals.no_data_to_preview)}}var ee=class n{conversationsContainer=ge.required("conversationsContainer");conversations=D.required();onConversationSelect=pe();lang=y(B);searchControl=new He("",{nonNullable:!0});filterOptions=[{label:this.lang.locals.sentiment,value:"sentiment"},{label:this.lang.locals.feedback,value:"feedback"}];showSuggestions=b(!1);selectedConversation=b(null);selectedFilter=b(this.filterOptions[0]);filterType$=new P;filterValue$=new P;filteredConversations=b([]);dropdownOpen=b(!1);feedbackOptions=De;currentSort="asc";suggestions=U(()=>this.selectedFilter().value==="feedback"?[{label:this.lang.locals.like,value:1},{label:this.lang.locals.dislike,value:-1},{label:this.lang.locals.unspecified,value:0}]:this.selectedFilter().value==="sentiment"?[{label:this.lang.locals.negative,value:"negative"},{label:this.lang.locals.positive,value:"positive"},{label:this.lang.locals.mixed,value:"mixed"},{label:this.lang.locals.neutral,value:"neutral"},{label:this.lang.locals.unspecified,value:"undefined"}]:[]);ngOnInit(){this.listenToFilter()}constructor(){K(()=>{new Fe(this.conversationsContainer().nativeElement,{suppressScrollX:!0}),this.conversationsContainer().nativeElement.addEventListener("wheel",e=>{e.stopPropagation()}),this.conversations()&&xe(()=>{this.filterType$.next("bot_name")})})}loadSuggestions(){["sentiment","feedback"].includes(this.selectedFilter().value)&&this.showSuggestions.set(!0)}onFilterTypeSelect(e){this.resetContorl(),this.selectedFilter.set(e),this.dropdownOpen.set(!1),this.filterValue$.next(""),this.filterType$.next(e.value)}onSuggestionSelect(e){this.filterValue$.next(e.value),this.searchControl.setValue(e.label,{emitEvent:!1}),this.showSuggestions.set(!1)}listenToFilter(){se([this.filterType$.pipe(re(this.selectedFilter().value)),this.filterValue$.pipe(re(""))]).pipe(ae(([e,t])=>e!=="bot_name"&&t===""?this.conversations():this.conversations().filter(i=>e==="sentiment"&&typeof t=="string"?i.sentiment?.toLowerCase()===t.toLowerCase():e==="feedback"?i.feedback===t:!0)),F(e=>{this.filteredConversations.set(e),this.resetScrollToTop()})).subscribe()}resetScrollToTop(){let e=this.conversationsContainer().nativeElement;e&&(e.scrollTop=0)}OnSelectConversation(e){this.selectedConversation.set(e),this.onConversationSelect.emit(e)}resetContorl(){this.searchControl.reset(""),this.filterValue$.next(""),this.filterType$.next(this.selectedFilter().value)}sort(){this.currentSort=this.currentSort==="asc"?"desc":"asc";let e=this.filteredConversations().sort((t,i)=>{let r=new Date(t.timestamp).getTime(),o=new Date(i.timestamp).getTime();return this.currentSort==="asc"?r-o:o-r});this.filteredConversations.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=M({type:n,selectors:[["app-conversation-list"]],viewQuery:function(t,i){t&1&&Ce(i.conversationsContainer,Qe,5),t&2&&he()},inputs:{conversations:[1,"conversations"]},outputs:{onConversationSelect:"onConversationSelect"},standalone:!0,features:[$],decls:22,vars:12,consts:[["conversationsContainer",""],["trigger","cdkOverlayOrigin"],["suggestionTrigger","cdkOverlayOrigin"],[1,"w-full","h-full","border-l","border-gray-400","bg-gray-200","text-gray-700","rounded-md","overflow-hidden","relative"],[1,"flex","max-w-lg","mx-auto","items-center","bg-gray-200","sticky","rounded-t-md","top-0","z-10","p-3","rtl:flex-row-reverse","border-b","border-b-gray-300"],["cdkOverlayOrigin","",1,"relative","flex-shrink-0","z-10","inline-flex","items-center","py-2.5","px-8","text-sm","font-medium","text-center","text-white","bg-primary","border","border-gray-300","rtl:rounded-e-lg","ltr:rounded-s-lg","focus:ring-4","focus:outline-none","focus:ring-gray-400",3,"click"],[1,"absolute","left-0","m-1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-current"],["d","M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen"],[1,"relative","w-full"],["cdkOverlayOrigin","","type","text",1,"w-full","block","p-2.5","z-20","text-sm","text-gray-900","bg-gray-50","rtl:rounded-s-lg","ltr:rounded-e-lg","rtl:border-e-gray-50","ltr:border-s-gray-50","rtl:border-e-2","ltr:border-s-2","border","border-gray-300","focus:ring-primary","focus:border-primary","outline-0",3,"focus","readOnly","placeholder","formControl"],[1,"absolute","left-0","top-0","m-3","bg-transparent","outline-none"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayWidth"],["tabindex","2","type","button",1,"bg-transparent","mx-2","outline-none",3,"click","keyup.enter","matTooltip"],["d","M18 21L14 17H17V7H14L18 3L22 7H19V17H22M2 19V17H12V19M2 13V11H9V13M2 7V5H6V7H2Z"],[1,"max-w-md"],["tabindex","1",1,"pb-3","pt-2","sm:pb-4","sm:pt-4","px-4","m-1","cursor-pointer","hover:bg-gray-400/20","hover:rounded-md","hover:text-gray-700",3,"appDisableIfNoPermission","ngClass"],[1,"flex","flex-col","justify-center","items-center","gap-4","mt-4"],[1,"absolute","ltr:left-0","rtl:right-0","z-10","w-40","mt-2","bg-white","border","border-gray-300","rounded-md","shadow-lg"],[1,"py-1"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer",3,"keyup.enter","click"],[1,"absolute","left-0","top-0","m-3","bg-transparent","outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-4","fill-current"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],[1,"w-full","ltr:left-0","rtl:right-0","z-10","mt-2","bg-white","border","border-gray-300","rounded-md","shadow-lg"],["tabindex","1",1,"cursor-pointer","p-2","hover:bg-gray-200","hover:rounded-sm"],["tabindex","1",1,"cursor-pointer","p-2","hover:bg-gray-200","hover:rounded-sm",3,"keyup","click"],["tabindex","1",1,"pb-3","pt-2","sm:pb-4","sm:pt-4","px-4","m-1","cursor-pointer","hover:bg-gray-400/20","hover:rounded-md","hover:text-gray-700",3,"keyup.enter","click","appDisableIfNoPermission","ngClass"],[1,"text-gray-700/60","text-xs"],[1,"flex","items-center","space-x-4","rtl:space-x-reverse"],[1,"flex-1","min-w-0"],[1,"text-base","font-medium","text-gray-700","truncate","uppercase",3,"matTooltip"],[1,"w-fit","text-xs","font-medium","me-2","px-1","py-[0.0625rem]","rounded","border",3,"matTooltip","ngClass"],[1,"flex-shrink-0",3,"matTooltip"],[1,"flex","justify-center","items-center","border-dashed","border-gray-700","border","size-8","rounded-full","bg-gray-100","p-2","m-1"],[1,"text-xl","leading-[normal]"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-12","fill-current"],["d","M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8M10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5M12,14C13.75,14 15.29,14.72 16.19,15.81L14.77,17.23C14.32,16.5 13.25,16 12,16C10.75,16 9.68,16.5 9.23,17.23L7.81,15.81C8.71,14.72 10.25,14 12,14Z"],[1,"text-center","text-gray-700","text-lg"]],template:function(t,i){if(t&1){let r=w();a(0,"div",3,0)(2,"div",4)(3,"button",5,1),g("click",function(){return m(r),u(i.dropdownOpen.set(!i.dropdownOpen()))}),p(5),a(6,"span",6),_(),a(7,"svg",7),v(8,"path",8),l()()(),C(9,tt,4,0,"ng-template",9),g("overlayOutsideClick",function(){return m(r),u(i.dropdownOpen.set(!1))}),H(),a(10,"div",10)(11,"input",11,2),g("focus",function(){return m(r),u(i.loadSuggestions())}),l(),C(13,it,3,0,"button",12)(14,rt,3,0,"ng-template",13),g("overlayOutsideClick",function(){return m(r),u(i.showSuggestions.set(!1))}),l(),a(15,"button",14),g("click",function(){return m(r),u(i.sort())})("keyup.enter",function(){return m(r),u(i.sort())}),_(),a(16,"svg",7),v(17,"path",15),l()()(),H(),a(18,"ul",16),S(19,lt,16,20,"li",17,W,!1,ct,5,1,"div",18),l()()}if(t&2){let r=A(4),o=A(12);s(5),h(" ",i.selectedFilter().label||i.lang.locals.select_filter," "),s(4),f("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",i.dropdownOpen()),s(2),f("readOnly",i.selectedFilter().value!=="bot_name")("placeholder",i.lang.locals.search_about+" "+(i.selectedFilter().label||i.lang.locals.bot_name+","+i.lang.locals.feedback+","+i.lang.locals.sentiment)+"...")("formControl",i.searchControl),s(2),k(i.searchControl.value?13:-1),s(),f("cdkConnectedOverlayOrigin",o)("cdkConnectedOverlayOpen",i.showSuggestions())("cdkConnectedOverlayWidth",o.elementRef.nativeElement.offsetWidth),s(),f("matTooltip",i.lang.locals.sort_conversation),s(4),T(i.filteredConversations())}},dependencies:[ke,G,Le,Oe,Ve,Q,q,Z,Y,Se,J]})};var dt=()=>["CHAT_HISTORY_SENTIMENT"],pt=()=>["CHAT_HISTORY_CHAT"];function mt(n,e){if(n&1){let t=w();a(0,"li",24),g("click",function(){let r=m(t).$implicit,o=c(2);return u(o.onBotSelect(r))})("keyup.enter",function(){let r=m(t).$implicit,o=c(2);return u(o.onBotSelect(r))}),p(1),l()}if(n&2){let t=e.$implicit;s(),h(" ",t," ")}}function ut(n,e){if(n&1&&(a(0,"div",21)(1,"ul",22),S(2,mt,2,1,"li",23,V),l()()),n&2){let t=c();s(2),T(t.botNames())}}function ft(n,e){n&1&&(a(0,"div",9)(1,"div",25),_(),a(2,"svg",26),v(3,"path",27)(4,"path",28),l(),H(),a(5,"span",29),p(6,"Loading..."),l()()())}function gt(n,e){n&1&&(_(),a(0,"svg",30),v(1,"path",31),l())}function vt(n,e){n&1&&(_(),a(0,"svg",16),v(1,"path",32),l())}function Ct(n,e){if(n&1){let t=w();a(0,"button",14),g("click",function(){m(t);let r=c();return u(r.sentimentAnalyis())})("keyup.enter",function(){m(t);let r=c();return u(r.sentimentAnalyis())}),z(1),L(2,"async"),C(3,gt,2,0,":svg:svg",30)(4,vt,2,0,":svg:svg",16),p(5),l()}if(n&2){let t=c();f("matTooltip",t.lang.locals.sentiment_analysis_description);let i=E(2,3,t.loaderSentiment$);s(3),k(i?3:4),s(2),h(" ",t.lang.locals.sentiment_chart," ")}}function ht(n,e){n&1&&(_(),a(0,"svg",15),v(1,"path",27)(2,"path",28),l())}function _t(n,e){n&1&&(_(),a(0,"svg",16),v(1,"path",33),l())}function bt(n,e){n&1&&(a(0,"div",35)(1,"div",9)(2,"div",25),_(),a(3,"svg",26),v(4,"path",27)(5,"path",28),l(),H(),a(6,"span",29),p(7,"Loading..."),l()()()())}function yt(n,e){if(n&1&&(a(0,"div",38)(1,"p"),p(2),l()()),n&2){let t=c().$implicit;s(2),x(t.content)}}function xt(n,e){if(n&1&&(a(0,"div",39),v(1,"span",41),l()),n&2){let t=c().$implicit;s(),f("innerHTML",t.content,ue)}}function kt(n,e){if(n&1&&(a(0,"div",40)(1,"p"),p(2),l()()),n&2){let t=c().$implicit;s(2),x(t.content)}}function wt(n,e){if(n&1&&C(0,yt,3,1,"div",38)(1,xt,2,1,"div",39)(2,kt,3,1,"div",40),n&2){let t=e.$implicit;k(t.isUser()?0:t.isAssistant()?1:2)}}function St(n,e){if(n&1&&(a(0,"div",37)(1,"p",42),p(2),l(),v(3,"img",43),l()),n&2){let t=c(2);s(2),x(t.lang.locals.choose_conversation)}}function Tt(n,e){if(n&1&&(a(0,"div",34),C(1,bt,8,0,"div",35),L(2,"async"),a(3,"div",36),S(4,wt,3,1,null,null,W),C(6,St,4,1,"div",37),l()()),n&2){let t=c();s(),k(E(2,2,t.loaderChat$)?1:-1),s(3),T(t.chats()),s(2),k(t.chats().length?-1:6)}}var Ke=class n extends Ie(class{}){chatHistoryService=y(Me);lang=y(B);conversations=b([]);chats=b([]);loaderChat$=new j(!1);loaderSentiment$=new j(!1);conversationLoader$=new j(!1);loadConversation$=new P;botNames=b([this.lang.locals.all_bots]);showBotDp=b(!1);selectedBot=b(this.botNames()[0]);ngOnInit(){this.loadConversations(),this.loadConversation$.next(void 0),this.getBotNames()}loadChat(e){this.loaderChat$.next(!0),this.chatHistoryService.getChatByConversationId(e).pipe(N(this.destroy$),ne(()=>this.loaderChat$.next(!1))).subscribe(t=>{this.chats.set(t)})}loadConversations(){this.loadConversation$.pipe(F(()=>{this.conversationLoader$.next(!0)}),le(e=>this.chatHistoryService.getAllConversations(e)),F(()=>{this.conversationLoader$.next(!1)}),N(this.destroy$)).subscribe(e=>{this.conversations.set(e)})}sentimentAnalyis(){this.loaderSentiment$.next(!0),this.chatHistoryService.applyAnalysis().pipe(N(this.destroy$),F(()=>this.loadConversation$.next(this.selectedBot()===this.lang.locals.all_bots?void 0:this.selectedBot())),ne(()=>this.loaderSentiment$.next(!1))).subscribe()}getBotNames(){return this.chatHistoryService.getAllBotNames().pipe(N(this.destroy$)).subscribe(e=>this.botNames.set([...this.botNames(),...e]))}onBotSelect(e){this.selectedBot.set(e),this.showBotDp.set(!1),this.loadConversation$.next(e===this.lang.locals.all_bots?void 0:e)}reloadConversations(){this.loadConversation$.next(this.selectedBot()===this.lang.locals.all_bots?void 0:this.selectedBot())}static \u0275fac=(()=>{let e;return function(i){return(e||(e=de(n)))(i||n)}})();static \u0275cmp=M({type:n,selectors:[["app-chat-history"]],standalone:!0,features:[ve,$],decls:32,vars:20,consts:[["botNameTrigger","cdkOverlayOrigin"],[1,"flex","items-center","gap-4"],[1,"relative","flex","flex-col","w-1/4"],[1,"text-gray-50","text-lg"],["type","button","cdkOverlayOrigin","",1,"relative","bg-gray-50","w-full","text-lg","text-gray-700","rounded-md","p-2.5","mb-4",3,"click"],[1,"absolute","left-0","m-1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-current"],["d","M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayWidth"],[1,"loader","flex","items-center","justify-center"],[3,"conversations"],["multi",""],[1,"text-gray-400"],["type","button","tabindex","1","class","inline-flex gap-4 items-center text-white bg-primary focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2",3,"matTooltip","click","keyup.enter",4,"appHasPermission"],["type","button","tabindex","1",1,"inline-flex","gap-4","items-center","text-white","bg-primary","focus:ring-4","focus:ring-gray-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","me-2","mb-2",3,"click","keyup.enter","matTooltip"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"size-6","text-gray-200","animate-spin","fill-primary"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-white"],[1,"flex","flex-col","lg:flex-row","bg-gray-100","rounded-md","shadow-md","h-[calc(100vh_-_18rem)]"],[1,"w-full","lg:w-4/12","p-4","lg:p-0","flex-shrink-0","overflow-auto","h-1/2","lg:h-full"],[3,"onConversationSelect","conversations"],["class","w-full lg:w-8/12 overflow-auto relative flex-auto h-1/2 lg:h-full",4,"appHasPermission"],[1,"absolute","w-full","ltr:left-0","rtl:right-0","z-10","mt-2","text-lg","bg-white","border","border-gray-300","rounded-md","shadow-lg"],[1,"py-1"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer",3,"click","keyup.enter"],["role","status"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"inline","w-8","h-8","text-gray-200","animate-spin","fill-primary"],["d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z","fill","currentColor"],["d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z","fill","currentFill"],[1,"sr-only"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 50",1,"w-16","h-6"],["fill","none","stroke","currentColor","stroke-width","2","d","M0 25 L20 25 L30 10 L40 40 L50 25 L70 25 L80 5 L90 45 L100 25 L200 25",1,"animate-heartbeat"],["d","M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"],["d","M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16H19.1L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z"],[1,"w-full","lg:w-8/12","overflow-auto","relative","flex-auto","h-1/2","lg:h-full"],[1,"absolute","inset-0","flex","items-center","justify-center","backdrop-blur-sm","bg-white","bg-opacity-50","z-10","h-100vh"],[1,"flex-auto","overflow-hidden","flex","flex-col","relative","min-h-0","p-4"],[1,"flex","justify-center","items-center"],[1,"user-message","chat-message","ltr:self-end","min-w-[min(400px,100%)]","rtl:self-start","rtl:!rounded-tr-none","ltr:!rounded-tr-none"],[1,"assistant-message","chat-message","whitespace-break-spaces","ltr:self-start","min-w-[min(400px,100%)]","rtl:self-end","rtl:!rounded-tl-none","ltr:!rounded-tr-none"],[1,"system-message","chat-message"],["appSecureUrl","",3,"innerHTML"],[1,"text-gray-700","text-xl","mt-10"],["src","assets/images/select.svg","alt","select",1,"w-1/4","h-1/4"]],template:function(t,i){if(t&1){let r=w();a(0,"div",1)(1,"div",2)(2,"span",3),p(3),l(),a(4,"button",4,0),g("click",function(){return m(r),u(i.showBotDp.set(!0))}),p(6),a(7,"span",5),_(),a(8,"svg",6),v(9,"path",7),l()()(),C(10,ut,4,0,"ng-template",8),g("overlayOutsideClick",function(){return m(r),u(i.showBotDp.set(!1))}),l(),C(11,ft,7,0,"div",9),L(12,"async"),l(),H(),v(13,"app-chat-history-charts",10),a(14,"mat-accordion",11)(15,"mat-expansion-panel")(16,"mat-expansion-panel-header")(17,"mat-panel-title"),p(18),l(),a(19,"mat-panel-description")(20,"p",12),p(21),l()()(),C(22,Ct,6,5,"button",13),a(23,"button",14),g("click",function(){return m(r),u(i.reloadConversations())})("keyup.enter",function(){return m(r),u(i.reloadConversations())}),z(24),L(25,"async"),C(26,ht,3,0,":svg:svg",15)(27,_t,2,0,":svg:svg",16),l(),a(28,"div",17)(29,"div",18)(30,"app-conversation-list",19),g("onConversationSelect",function(O){return m(r),u(i.loadChat(O))}),l()(),C(31,Tt,7,4,"div",20),l()()()}if(t&2){let r=A(5);s(3),h("",i.lang.locals.choose_bot,":"),s(3),h(" ",i.selectedBot()," "),s(4),f("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",i.showBotDp())("cdkConnectedOverlayWidth",r.elementRef.nativeElement.offsetWidth),s(),k(E(12,14,i.conversationLoader$)?11:-1),s(2),f("conversations",i.conversations()),s(5),x(i.lang.locals.conversations_and_chats),s(3),h(" ",i.lang.locals.conversation_description," "),s(),f("appHasPermission",R(18,dt)),s(),f("matTooltip",i.lang.locals.reload_conversation);let o=E(25,16,i.conversationLoader$);s(3),k(o?26:27),s(4),f("conversations",i.conversations()),s(),f("appHasPermission",R(19,pt))}},dependencies:[Re,ze,Be,Pe,Ae,Ne,we,G,Q,q,Z,X,ee,Y,$e,We],styles:["@keyframes _ngcontent-%COMP%_heartbeat{0%{stroke-dasharray:200;stroke-dashoffset:200}50%{stroke-dasharray:200;stroke-dashoffset:0}to{stroke-dasharray:200;stroke-dashoffset:200}}.animate-heartbeat[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_heartbeat 2s infinite ease-in-out;stroke-linecap:round}"]})};export{Ke as ChatHistoryComponent};
