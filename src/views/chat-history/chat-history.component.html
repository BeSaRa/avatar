<mat-accordion multi>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title> Personal data </mat-panel-title>
      <mat-panel-description> Type your name and age </mat-panel-description>
    </mat-expansion-panel-header>
  </mat-expansion-panel>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title> Day of the trip </mat-panel-title>
      <mat-panel-description> Inform the date you wish to travel </mat-panel-description>
    </mat-expansion-panel-header>
    <div class="flex bg-gray-100 rounded-md shadow-md max-h-[calc(100vh_-_18rem)]">
      <!-- Left Panel -->
      <div
        #conversationsContainer
        class="w-4/12 border-l border-gray-400 bg-gray-200 text-gray-700 rounded-md overflow-hidden relative">
        <div
          class="flex max-w-lg mx-auto items-center bg-gray-200 sticky rounded-t-md top-0 z-10 p-3 rtl:flex-row-reverse border-b border-b-gray-300">
          <button
            cdkOverlayOrigin
            #trigger="cdkOverlayOrigin"
            class="flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-white bg-primary border border-gray-300 rtl:rounded-e-lg ltr:rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-400"
            (click)="toggleDropdown()">
            {{ selectedFilter() || lang.locals.select_filter }}
          </button>
          <ng-template
            cdkConnectedOverlay
            [cdkConnectedOverlayOrigin]="trigger"
            [cdkConnectedOverlayOpen]="dropdownOpen"
            (overlayOutsideClick)="closeDropdown()">
            <div
              class="absolute ltr:left-0 rtl:right-0 z-10 w-40 mt-2 bg-white border border-gray-300 rounded-md shadow-lg">
              <ul class="py-1">
                @for (option of filterOptions(); track option) {
                  <li
                    class="px-4 py-2 text-base text-gray-700 hover:bg-gray-200 cursor-pointer"
                    tabindex="1"
                    (keyup.enter)="selectOption(option)"
                    (click)="selectOption(option)">
                    {{ option.label }}
                  </li>
                }
              </ul>
            </div>
          </ng-template>
          <div class="relative w-full">
            <input
              type="text"
              class="w-full block p-2.5 z-20 text-sm text-gray-900 bg-gray-50 rtl:rounded-s-lg ltr:rounded-e-lg rtl:border-e-gray-50 ltr:border-s-gray-50 rtl:border-e-2 ltr:border-s-2 border border-gray-300 focus:ring-primary focus:border-primary outline-0"
              [placeholder]="
                lang.locals.search_about +
                ' ' +
                (selectedFilter() || lang.locals.bot_name + ',' + lang.locals.feedback + ',' + lang.locals.sentiment) +
                '...'
              "
              [formControl]="searchControl" />
          </div>
          <!-- Dropdown for filter selection -->
          <!-- <div class="relative"> -->
          <!-- <button
              cdkOverlayOrigin
              #trigger="cdkOverlayOrigin"
              class="flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-white bg-primary border border-gray-300 rtl:rounded-e-lg ltr:rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-400"
              (click)="toggleDropdown()">
              {{ selectedFilter() || lang.locals.select_filter }}
            </button> -->

          <!-- Dropdown Menu -->
          <!-- <ng-template
              cdkConnectedOverlay
              [cdkConnectedOverlayOrigin]="trigger"
              [cdkConnectedOverlayOpen]="dropdownOpen"
              (overlayOutsideClick)="closeDropdown()">
              <div
                class="absolute ltr:left-0 rtl:right-0 z-10 w-40 mt-2 bg-white border border-gray-300 rounded-md shadow-lg">
                <ul class="py-1">
                  @for (option of filterOptions(); track option) {
                    <li
                      class="px-4 py-2 text-base text-gray-700 hover:bg-gray-200 cursor-pointer"
                      tabindex="1"
                      (keyup.enter)="selectOption(option)"
                      (click)="selectOption(option)">
                      {{ option.label }}
                    </li>
                  }
                </ul>
              </div>
            </ng-template> -->
          <!-- </div> -->

          <!-- Search Input -->
          <!-- <input
            type="text"
            class="flex-1 block p-2.5 z-20 text-sm text-gray-900 bg-gray-50 rtl:rounded-s-lg ltr:rounded-e-lg rtl:border-e-gray-50 ltr:border-s-gray-50 rtl:border-e-2 ltr:border-s-2 border border-gray-300 focus:ring-primary focus:border-primary outline-0"
            [placeholder]="
              lang.locals.search_about +
              ' ' +
              (selectedFilter() || lang.locals.bot_name + ',' + lang.locals.feedback + ',' + lang.locals.sentiment) +
              '...'
            "
            [formControl]="searchControl" /> -->
        </div>

        <ul class="max-w-md">
          @for (conversation of conversations$ | async; track conversation.conversation_id; let i = $index) {
            <li
              tabindex="1"
              (keyup.enter)="selectedConversation.set(conversation.conversation_id)"
              (click)="loadChat(conversation.conversation_id)"
              [ngClass]="{
                '!bg-gray-400/80 !rounded-md !text-gray-700': selectedConversation() === conversation.conversation_id,
              }"
              class="pb-3 pt-2 sm:pb-4 sm:pt-4 px-4 m-1 cursor-pointer hover:bg-gray-400/20 hover:rounded-md hover:text-gray-700">
              <div class="flex items-center space-x-4 rtl:space-x-reverse">
                <div class="flex-1 min-w-0">
                  <p class="text-base font-medium text-gray-700 truncate uppercase">{{ conversation.bot_name }}</p>
                  <p
                    [ngClass]="{
                      'bg-green-100 text-green-800 border-green-400': conversation.feedback > 0,
                      '!bg-red-100 !text-red-800 !border-red-400': conversation.feedback <= 0,
                    }"
                    class="w-fit text-xs font-medium me-2 px-1 py-[0.0625rem] rounded border">
                    {{ conversation.feedback > 0 ? lang.locals.like : lang.locals.dislike }}
                  </p>
                </div>
                <div class="flex-shrink-0">
                  <div
                    class="flex justify-center items-center border-dashed border-gray-700 border size-8 rounded-full bg-gray-100 p-2 m-1">
                    @switch (conversation.sentiment) {
                      @case ('negative') {
                        <span class="text-xl leading-[normal]">üòü</span>
                      }
                      @case ('mixed') {
                        <span class="text-xl leading-[normal]">üòï</span>
                      }
                      @case ('positive') {
                        <span class="text-xl leading-[normal]">üòä</span>
                      }
                      @case ('neutral') {
                        <span class="text-xl leading-[normal]">üòê</span>
                      }
                    }
                  </div>
                </div>
                <!-- <div class="inline-flex items-center text-lg text-gray-200 opacity-50">#{{ i + 1 }}</div> -->
              </div>
            </li>
          }
        </ul>
      </div>
      <!-- Right Panel -->
      <div class="w-8/12 overflow-auto">
        <!-- Add content here -->
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>
