import{b as y}from"./chunk-GQC7IUVF.js";import{a as w}from"./chunk-6PBMPUOM.js";import{a as S}from"./chunk-YCCWDGDG.js";import{d as T,e as M}from"./chunk-5G2AR32B.js";import{l as v}from"./chunk-CRQDGZSN.js";import{a as h}from"./chunk-3MTGQOJI.js";import{f}from"./chunk-FOMXK6XF.js";import{B as l,H as C,P as u,W as d,a as m,ka as g,na as b,ta as i,x as c}from"./chunk-FIRE7P7C.js";function x(n){return class extends n{clone(r){let s=this.constructor;return Object.assign(new s,this,r)}}}var a=class extends x(S){constructor(r="",s="user"){super();this.content=r;this.role=s}end_turn;function_call;tool_calls};var I=class n{http=i(f);urlService=i(h);adminService=i(w);store=i(y);botNameCtrl=new v("",{nonNullable:!0});sendMessage(t,r){let s=`${this.urlService.URLS.CHAT}/${r}`;return this.messages.update(e=>[...e,new a(t,"user")]),this.http.post(s,m(m({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null),this.conversationId()?{conversation_id:this.conversationId()}:null)).pipe(u(e=>{throw new a().clone({content:e.message,role:"error"}),new Error(e)}),l(e=>(e.message.content=T(M(e.message.content,e.message)),e.message=new a().clone(e.message),this.conversationId.set(e.message.conversation_id),this.messages.update(o=>[...o,e.message]),e)))}processFormattedText(t){let r=[...t.matchAll(/href="(.*?)"/g)];if(r.length===0)return console.log("No matches found in formatted text."),c(t);let s=r.map(e=>{let o=e[1];return o.includes("blob.core.windows.net")?this.adminService.secureUrl(o).pipe(l(p=>({match:e[0],replacement:e[0].replace(o,p)})),u(()=>c({match:e[0],replacement:e[0]}))):c({match:e[0],replacement:e[0]})});return C(s).pipe(l(e=>(e.forEach(({match:o,replacement:p})=>{t=t.replace(o,p)}),t)))}onBotNameChange(){return this.botNameCtrl.valueChanges.pipe(d(),g(()=>{this.conversationId.set(""),this.messages.set([])}))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"})};export{a,I as b};
