import{Cb as w,Db as A,Oa as R,a as o,b as S,fd as i,gd as m,hd as j,j as b,na as v,ta as T}from"./chunk-FK5TGTUL.js";var H=new WeakMap,s=Symbol("STATE_SOURCE");function d(t,...e){t[s].update(n=>e.reduce((r,c)=>o(o({},r),typeof c=="function"?c(r):c),n)),L(t)}function f(t){return t[s]()}function x(t){return H.get(t[s][b])||[]}function L(t){let e=x(t);for(let n of e){let r=m(()=>f(t));n(r)}}function C(t){let e=m(()=>t());return _(e)?new Proxy(t,{get(n,r){return r in e?(w(n[r])||Object.defineProperty(n,r,{value:i(()=>n()[r]),configurable:!0}),C(n[r])):n[r]}}):t}function _(t){return t?.constructor===Object}function D(...t){let e=[...t],n=typeof e[0]=="function"?{}:e.shift(),r=e;return(()=>{class a{constructor(){let g=r.reduce((p,W)=>W(p),J()),{stateSignals:l,computedSignals:M,methods:N,hooks:O}=g,k=o(o(o({},l),M),N);this[s]=n.protectedState===!1?g[s]:g[s].asReadonly();for(let p in k)this[p]=k[p];let{onInit:y,onDestroy:I}=O;y&&y(),I&&T(R).onDestroy(I)}static \u0275fac=function(l){return new(l||a)};static \u0275prov=v({token:a,factory:a.\u0275fac,providedIn:n.providedIn||null})}return a})()}function J(){return{[s]:A({}),stateSignals:{},computedSignals:{},methods:{},hooks:{}}}function E(t){return e=>{let n=t(o(o({},e.stateSignals),e.computedSignals));return Object.keys(n),S(o({},e),{computedSignals:o(o({},e.computedSignals),n)})}}function P(t){return e=>{let n=o(o(o({[s]:e[s]},e.stateSignals),e.computedSignals),e.methods),r=typeof t=="function"?t(n):t,c=a=>{let u=r[a],g=e.hooks[a];return u?()=>{g&&g(),u(n)}:g};return S(o({},e),{hooks:{onInit:c("onInit"),onDestroy:c("onDestroy")}})}}function h(t){return e=>{let n=t(o(o(o({[s]:e[s]},e.stateSignals),e.computedSignals),e.methods));return Object.keys(n),S(o({},e),{methods:o(o({},e.methods),n)})}}function U(t){return e=>{let n=typeof t=="function"?t():t,r=Object.keys(n);e[s].update(a=>o(o({},a),n));let c=r.reduce((a,u)=>{let g=i(()=>e[s]()[u]);return S(o({},a),{[u]:C(g)})},{});return S(o({},e),{stateSignals:o(o({},e.stateSignals),c)})}}var q={speechToken:{token:"",region:""},streamId:"",recording:"Stopped",streamingStatus:"Stopped",streamReady:!1,backgroundColor:"#8A1538",backgroundUrl:"assets/images/background.svg",logoUrl:"assets/images/qrep-newlogo-colored.png",isVideo:!1,preview:!1,videoToken:"",idleAvatar:""},F=D({providedIn:"root",protectedState:!0},U(q),E(({streamId:t,speechToken:e,recording:n,streamingStatus:r,idleAvatar:c})=>({hasToken:i(()=>!!e().token),hasRegion:i(()=>!!e().region),isRecordingStarted:i(()=>n()==="Started"),isRecordingStopped:i(()=>n()==="Stopped"),isRecordingLoading:i(()=>n()==="InProgress"),hasStream:i(()=>!!t()),isStreamStarted:i(()=>r()==="Started"),isStreamStopped:i(()=>r()==="Stopped"),isStreamLoading:i(()=>r()==="InProgress"||r()==="Disconnecting"),idleAvatar:i(()=>c()),idleAvatarUrl:i(()=>`assets/videos/${c()}-idle.webm`)})),h(t=>({updateSpeechToken:(e={token:"",region:""})=>{d(t,{speechToken:e})},updateStreamId:e=>{d(t,{streamId:e})},recordingStarted:()=>{d(t,{recording:"Started"})},recordingStopped:()=>{d(t,{recording:"Stopped"})},recordingInProgress:()=>{d(t,{recording:"InProgress"})},updateStreamStatus:(e="Stopped")=>{d(t,{streamingStatus:e})},updateIdleAvatar(e){d(t,{idleAvatar:e})}})),h(t=>({updateState(e){d(t,e)}})),P(t=>{let e=sessionStorage.getItem("CURRENT_STATE");if(e)d(t,JSON.parse(e));else{let n=f(t);sessionStorage.setItem("CURRENT_STATE",JSON.stringify(n))}return{onInit(){t.isRecordingLoading()&&d(t,{recording:"Stopped"}),j(()=>{let n=f(t);sessionStorage.setItem("CURRENT_STATE",JSON.stringify(n))})}}}));export{f as a,F as b};
