import{b as f}from"./chunk-5KQW4C4Q.js";import{a as T}from"./chunk-M7YBBKNA.js";import{a as y}from"./chunk-MU5HYU3N.js";import{d as h,e as v}from"./chunk-4C6HXC6K.js";import{a as b}from"./chunk-ZYMHUHVW.js";import{e as g}from"./chunk-ICCDNIU7.js";import{B as l,H as C,P as u,a as m,ka as d,qa as i,x as c}from"./chunk-IX5YYMIG.js";function M(n){return class extends n{clone(r){let s=this.constructor;return Object.assign(new s,this,r)}}}var a=class extends M(y){constructor(r="",s="user"){super();this.content=r;this.role=s}end_turn;function_call;tool_calls};var S=class n{http=i(g);urlService=i(b);adminService=i(T);store=i(f);sendMessage(t,r){let s=`${this.urlService.URLS.CHAT}/${r}`;return this.messages.update(e=>[...e,new a(t,"user")]),this.http.post(s,m(m({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null),this.conversationId()?{conversation_id:this.conversationId()}:null)).pipe(u(e=>{throw new a().clone({content:e.message,role:"error"}),new Error(e)}),l(e=>(e.message.content=h(v(e.message.content,e.message)),e.message=new a().clone(e.message),this.conversationId.set(e.message.conversation_id),this.messages.update(o=>[...o,e.message]),e)))}processFormattedText(t){let r=[...t.matchAll(/href="(.*?)"/g)];if(r.length===0)return console.log("No matches found in formatted text."),c(t);let s=r.map(e=>{let o=e[1];return o.includes("blob.core.windows.net")?this.adminService.secureUrl(o).pipe(l(p=>({match:e[0],replacement:e[0].replace(o,p)})),u(()=>c({match:e[0],replacement:e[0]}))):c({match:e[0],replacement:e[0]})});return C(s).pipe(l(e=>(e.forEach(({match:o,replacement:p})=>{t=t.replace(o,p)}),t)))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};export{a,S as b};
