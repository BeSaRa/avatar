import{c as a}from"./chunk-SKM237GV.js";import{a as C}from"./chunk-ZYMHUHVW.js";import{e as O}from"./chunk-ICCDNIU7.js";import{Ab as I,P as o,ha as A,ka as M,qa as n,x as S}from"./chunk-IX5YYMIG.js";var R={CHATBOT:"CHATBOT",MEDIA:"MEDIA",INTERACTIVE_CHAT:"INTERACTIVE_CHAT",SEARCH:"SEARCH",AVATAR:"AVATAR",SPEECH:"SPEECH",DOCUMENT_INTELLIGENCE:"DOCUMENT_INTELLIGENCE",ADMIN:"ADMIN",CHAT_HISTORY:"CHAT_HISTORY",ADMIN_CRAWLER:"ADMIN_CRAWLER",ADMIN_UPLOAD_BLOB:"ADMIN_UPLOAD_BLOB",ADMIN_GET_BLOB:"ADMIN_GET_BLOB",ADMIN_GET_ALL_CONTAINERS:"ADMIN_GET_ALL_CONTAINERS",ADMIN_GET_SUBFOLDER:"ADMIN_GET_SUBFOLDER",ADMIN_DELETE_SUBFOLDER:"ADMIN_DELETE_SUBFOLDER",ADMIN_DELETE_BLOB_BY_METADATA:"ADMIN_DELETE_BLOB_BY_METADATA",ADMIN_DELETE_BLOB_BY_TITLE:"ADMIN_DELETE_BLOB_BY_TITLE",ADMIN_RESET_INDEX:"ADMIN_RESET_INDEX",ADMIN_RUN_INDEXER:"ADMIN_RUN_INDEXER",ADMIN_INDEX_INFO:"ADMIN_INDEX_INFO",ADMIN_INDEXES_NAMES:"ADMIN_INDEXES_NAMES",MEDIA_GENERATE_REPORT:"MEDIA_GENERATE_REPORT",MEDIA_CRAWL:"MEDIA_CRAWL",MEDIA_SENTIMENT:"MEDIA_SENTIMENT",MEDIA_DETECT_LANGUAGE:"MEDIA_DETECT_LANGUAGE",MEDIA_KEY_PHRASES:"MEDIA_KEY_PHRASES",MEDIA_ENTITY_RECOGNITION:"MEDIA_ENTITY_RECOGNITION",MEDIA_IMAGE_ANALYSIS:"MEDIA_IMAGE_ANALYSIS",MEDIA_IMAGE_EMBEDDING:"MEDIA_IMAGE_EMBEDDING",CHATBOT_WEBSITE:"CHATBOT_WEBSITE",CHATBOT_UPLOAD_DOCUMENT:"CHATBOT_UPLOAD_DOCUMENT",INTERACTIVE_DEPARTMENT_TYPES:"INTERACTIVE_DEPARTMENT_TYPES",INTERACTIVE_VACATION_TYPES:"INTERACTIVE_VACATION_TYPES",INTERACTIVE_SUBMIT_FORM:"INTERACTIVE_SUBMIT_FORM",INTERACTIVE_APPROVE:"INTERACTIVE_APPROVE",INTERACTIVE_REJECT:"INTERACTIVE_REJECT",INTERACTIVE_PENDING:"INTERACTIVE_PENDING",INTERACTIVE_FILTER_FORMS:"INTERACTIVE_FILTER_FORMS",INTERACTIVE_ALL_FORMS:"INTERACTIVE_ALL_FORMS",AVATAR_START_STREAM:"AVATAR_START_STREAM",AVATAR_SEND_CANDIDATE:"AVATAR_SEND_CANDIDATE",AVATAR_SEND_ANSWER:"AVATAR_SEND_ANSWER",AVATAR_RENDER_TEXT:"AVATAR_RENDER_TEXT",AVATAR_STOP_RENDER:"AVATAR_STOP_RENDER",AVATAR_CLOSE_STREAM:"AVATAR_CLOSE_STREAM",SPEECH_TOKEN:"SPEECH_TOKEN",SPEECH_TRANSCRIPT:"SPEECH_TRANSCRIPT",CHAT_HISTORY_CONVERSATION:"CHAT_HISTORY_CONVERSATION",CHAT_HISTORY_ALL_CONVERSATION:"CHAT_HISTORY_ALL_CONVERSATION",CHAT_HISTORY_CHAT:"CHAT_HISTORY_CHAT",CHAT_HISTORY_SENTIMENT:"CHAT_HISTORY_SENTIMENT",CHAT_HISTORY_ADD_FEEDBACK:"CHAT_HISTORY_ADD_FEEDBACK",CHAT_HISTORY_BOT_NAMES:"CHAT_HISTORY_BOT_NAMES",CHAT_HISTORY_ADD_MSG:"CHAT_HISTORY_ADD_MSG",DOCUMENT_INTELLIGENCE_ANALYZE_PDF:"DOCUMENT_INTELLIGENCE_ANALYZE_PDF",SEARCH_BOT_NAME:"SEARCH_BOT_NAME",ADMIN_ADD_PERMISSION_TO_USER:"ADMIN_ADD_PERMISSION_TO_USER",ADMIN_ADD_PERMISSION_TO_TABLE:"ADMIN_ADD_PERMISSION_TO_TABLE",CHATBOT_LEGAL:"CHATBOT_LEGAL",CHATBOT_MEDIA:"CHATBOT_MEDIA",CHATBOT_INTERACTIVE:"CHATBOT_INTERACTIVE",CHATBOT_QREP:"CHATBOT_QREP",CHATBOT_DOC_INTELLIGENCE:"CHATBOT_DOC_INTELLIGENCE",ADMIN_ADD_USER:"ADMIN_ADD_USER",ADMIN_DELETE_USER:"ADMIN_DELETE_USER",ADMIN_UPDATE_USER:"ADMIN_UPDATE_USER",ADMIN_GET_ALL_USER:"ADMIN_GET_ALL_USER",ADMIN_GET_USER:"ADMIN_GET_USER",ADMIN_GET_PERMISSION:"ADMIN_GET_PERMISSION",ADMIN_GET_ALL_PERMISSION:"ADMIN_GET_ALL_PERMISSION",ADMIN_REMOVE_PERMISSION:"ADMIN_REMOVE_PERMISSION",ADMIN_ASSIGN_PERMISSION:"ADMIN_ASSIGN_PERMISSION",ADMIN_GET_ALL_SETTINGS:"ADMIN_GET_ALL_SETTINGS",ADMIN_ADD_SETTING:"ADMIN_ADD_SETTING",ADMIN_UPDATE_SETTING:"ADMIN_UPDATE_SETTING",ADMIN_DELETE_SETTING:"ADMIN_DELETE_SETTING",ADMIN_GET_SETTING:"ADMIN_GET_SETTING"};var r=class{_permissions=[];_permissionsKeys=[];_refresh_token=I("");_access_token=I("");isRefreshing=I(!1);set permissions(_){this._permissions=_,this._permissionsKeys=_.map(E=>E._Permission__key)}get permissions(){return this._permissions}get permissionsKeys(){return this._permissionsKeys}get access_token(){return this._access_token()}set access_token(_){this._access_token.set(_)}set refresh_token(_){this._refresh_token.set(_)}get refresh_token(){return this._refresh_token()}hasPermission(_){return this._permissionsKeys.includes(R[_])}hasAnyPermission(_){return _.some(E=>this._permissionsKeys.includes(R[E]))}hasAllPermission(_){return _.every(E=>this._permissionsKeys.includes(R[E]))}hasToken(){return!!this.access_token&&!this.isRefreshing()}};var i={USER:"user",PERMISSIONS_KEYS:"permissionsKeys"};var D={TOKEN_HEADER_KEY:"Authorization"};var p=class N{_http=n(O);_urlService=n(C);_router=n(a);$applicationUser=I(new r);$isAuthenticated=I(!1);login(_,E){let e=`${this._urlService.URLS.USER}/login`,T=new URLSearchParams({username:_,password:E}).toString(),L={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return this._http.post(e,T,L).pipe(A(s=>this.$applicationUser.update(t=>(t.access_token=s.access_token,t.refresh_token=s.refresh_token,t.permissions=s.permissions,t))),A(s=>localStorage.setItem(i.USER,JSON.stringify(s))),A(s=>localStorage.setItem(i.PERMISSIONS_KEYS,JSON.stringify(s.permissions.map(t=>t._Permission__key)))),A(()=>this.$isAuthenticated.set(!0)),A(()=>this._router.navigate(["/home"])),o(()=>(this.$isAuthenticated.set(!1),S(new r))))}generateRefreshToken(){let _=`${this._urlService.URLS.USER}/refresh-token`;this.$applicationUser().isRefreshing.set(!0);let E={headers:{[D.TOKEN_HEADER_KEY]:this.$applicationUser().refresh_token}};return this._http.get(_,E).pipe(A(e=>this.$applicationUser.update(T=>(T.refresh_token=e.refresh_token,T))),A(()=>this.$applicationUser().isRefreshing.set(!1)),o(()=>(this.$applicationUser().isRefreshing.set(!1),S({refresh_token:""}))))}generateAccessToken(){let _=`${this._urlService.URLS.USER}/access-token`,E={headers:{[D.TOKEN_HEADER_KEY]:this.$applicationUser().access_token}};return this._http.get(_,E).pipe(A(e=>this.$applicationUser.update(T=>(T.access_token=e.access_token,T)),o(()=>(this._router.navigate(["/auth/login"]),S({access_token:""})))))}tryAuthenticate(){let _=localStorage.getItem(i.USER);_&&this.$applicationUser.update(E=>{let e=JSON.parse(_);return E.access_token=e.access_token,E.refresh_token=e.refresh_token,E.permissions=e.permissions,E}),this.$isAuthenticated.set(!!_),!this.$isAuthenticated()&&this._router.navigate(["/auth/login"])}logout(){this.$isAuthenticated.set(!1),this.$applicationUser.set(new r),localStorage.removeItem(i.USER),this._router.navigate(["/auth/login"])}static \u0275fac=function(E){return new(E||N)};static \u0275prov=M({token:N,factory:N.\u0275fac,providedIn:"root"})};export{D as a,p as b};
