import{a as Ee,b as Ae,c as Me}from"./chunk-EI2WS5I3.js";import{a as be}from"./chunk-E3E2MV6E.js";import{a as Te}from"./chunk-LA5CESJK.js";import{b as Ve,c as Le}from"./chunk-TXXQCJFS.js";import"./chunk-PCRSGRUG.js";import{a as ke}from"./chunk-BP77LVID.js";import{b as we}from"./chunk-PMUIQYPP.js";import{a as Ie}from"./chunk-K6I6Q3ED.js";import{a as ye}from"./chunk-BBST3SGX.js";import{b as E}from"./chunk-ZPRGCDHT.js";import"./chunk-DNPOOQKF.js";import{a as Re}from"./chunk-TVYR2B24.js";import"./chunk-5PTZG25G.js";import"./chunk-L4GXIFO4.js";import"./chunk-Q4Y5B4TC.js";import"./chunk-IHOFWBF3.js";import{a as xe}from"./chunk-HDLOXU5R.js";import{b as ze}from"./chunk-B3LQ2IDW.js";import{O as me}from"./chunk-WK44F4QQ.js";import{c as de,d as ge,f as R,g as k,i as ue}from"./chunk-OK5S6IU3.js";import{A as _e,h as Ce,o as fe,t as he,u as ve,v as Se}from"./chunk-SLIRYUJ2.js";import{b as pe}from"./chunk-UR3XF2OI.js";import"./chunk-7UCX2ERW.js";import{Ac as B,Ad as ce,B as j,Bc as c,Cc as h,Db as w,Dc as oe,Eb as J,Ha as d,Ia as g,Ja as _,Jb as K,Ka as x,La as Z,N as P,Na as U,Nc as V,Ob as b,Pc as L,Qc as N,Sc as re,T as q,Ta as F,Tb as X,Tc as ae,Ua as $,Ub as l,V as G,Va as W,X as Q,Zb as v,_b as Y,ac as ee,bc as te,cc as r,dc as a,ec as u,f as He,i as H,ia as D,ic as y,jd as se,ka as z,lc as f,nc as S,q as I,sb as o,ta as m,vd as le,xa as T,yc as ne,zc as ie}from"./chunk-OUJ2UPQI.js";var C=He(Ie());var $e=["waves"],Be=t=>({"!-right-14":t}),Ne=(t,n)=>({"bg-red-500":t,"bg-green-500":n}),Oe=t=>({hidden:t}),je=t=>({"-translate-x-full":t}),Pe=(t,n)=>({"bg-green-700":t,"bg-red-600":n});function qe(t,n){if(t&1&&(r(0,"span",12),c(1),a()),t&2){let i=S();o(),h(i.lang.locals.loading)}}function Ge(t,n){if(t&1&&(r(0,"span",13),c(1),a()),t&2){let i=S();o(),h(i.lang.locals.click_to_speak)}}function Qe(t,n){if(t&1&&(r(0,"span",12),c(1),a()),t&2){let i=S();o(),h(i.lang.locals.listening_ongoing)}}function Ze(t,n){if(t&1&&(r(0,"span",12),c(1),a()),t&2){let i=S();o(),h(i.lang.locals.click_to_send)}}function Ue(t,n){if(t&1&&(r(0,"option",20),c(1),a()),t&2){let i=n.$implicit;l("value",i),o(),h(i)}}function We(t,n){if(t&1&&(r(0,"button",26)(1,"div",31)(2,"span"),c(3),a()()()),t&2){let i=S();o(3),h(i.avatarVideoComponent().onlineStatus())}}function Je(t,n){if(t&1){let i=y();r(0,"button",32),f("click",function(){d(i);let s=S();return g(s.toggleStream())}),c(1),a()}if(t&2){let i=S();l("ngClass",N(2,Pe,i.store.isStreamStarted(),i.store.isStreamStopped())),o(),oe(" ",i.avatarVideoComponent().onlineStatus()," ")}}var A=class t extends xe(class{}){avatarVideoComponent=$.required();overlayChatComponent=$.required();waves=J.required("waves");store=m(E);chatService=m(be);chatHistoryService=m(Re);avatarService=m(we);injector=m(U);fullscreen=F();recognizedText=w("");recognizingText=w("");speechService=m(ye);recognizing$=F();recognized$=new I;accept$=new I;recognizingStatus=w(!1);botNames$=this.chatHistoryService.getAllBotNames().pipe(z(n=>this.chatService.botNameCtrl.patchValue(n.at(0))));settingsOpened=!1;lang=m(pe);ngOnInit(){return H(this,null,function*(){this.listenToAccept(),this.listenToBotNameChange(),yield this.prepareRecorder()})}listenToBotNameChange(){this.chatService.onBotNameChange().pipe(D(this.destroy$)).subscribe()}prepareRecorder(){return H(this,null,function*(){this.recordingStream=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.waveSurfer=new Ae({waveColor:"white",progressColor:"white",container:this.waves().nativeElement,height:"auto"}),this.recorder=this.waveSurfer.registerPlugin(Me.create({scrollingWaveform:!1})),this.recorder.renderMicStream(this.recordingStream);let n=C.AudioConfig.fromDefaultMicrophoneInput(),i=C.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US"]);this.recognizer=C.SpeechRecognizer.FromConfig(C.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region()),i,n),this.recognizer.recognizing=(e,s)=>{s.result.reason===C.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+s.result.text),this.recognizing$.emit(this.recognizingText()),this.recognizingStatus.set(!0))},this.recognizer.recognized=(e,s)=>{s.result.reason===C.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(p=>p+" "+s.result.text),this.recognized$.next(),this.recognizingStatus.set(!1))},this.recognizer.canceled=()=>{this.store.recordingInProgress(),this.speechService.generateSpeechToken().pipe(q(1)).subscribe(()=>{this.prepareRecorder().then(()=>this.startRecording())})}})}startRecording(){this.store.recordingInProgress(),this.recognizer.startContinuousRecognitionAsync(()=>{this.recognizer.internalData.privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)})}stopRecording(){this.recognizer.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped()})}toggleRecording(){this.store.isRecordingLoading()||(this.store.isRecordingStarted()?this.acceptText():this.startRecording())}acceptText(){this.accept$.next()}rejectText(){this.recognizingText.set(""),this.recognizedText.set(""),this.recognizing$.emit(""),this.recognizingStatus.set(!1),this.stopRecording()}goToEndOfChat(){setTimeout(()=>{let n=this.overlayChatComponent().container().nativeElement.querySelectorAll(".user");n[n.length-1].scrollIntoView(!0)},100)}listenToAccept(){this.accept$.pipe(j(()=>this.recognizedText())).pipe(P(n=>!!n)).pipe(D(this.destroy$)).pipe(z(()=>{this.recognizedText.set(""),this.recognizingText.set(""),this.recognizingStatus.set(!1),this.recognizing$.emit(""),this.stopRecording()})).pipe(z(()=>this.goToEndOfChat())).pipe(Q(n=>this.chatService.sendMessage(n,this.chatService.botNameCtrl.value))).pipe(G(200)).subscribe(()=>{let n=this.overlayChatComponent().container().nativeElement.querySelectorAll(".assistant"),i=setInterval(()=>n[n.length-1].scrollIntoView(!1),200),e=se(()=>{this.overlayChatComponent().animationStatus()||(clearInterval(i),e.destroy())},{injector:this.injector})})}clearChat(){this.chatService.messages.set([])}toggleStream(){this.store.isStreamLoading()||(this.store.isStreamStopped()?this.avatarVideoComponent().start$.next():this.avatarVideoComponent().stop$.next())}toggleSettings(){this.settingsOpened=!this.settingsOpened}static \u0275fac=(()=>{let n;return function(e){return(n||(n=Z(t)))(e||t)}})();static \u0275cmp=T({type:t,selectors:[["app-screen-control"]],viewQuery:function(i,e){i&1&&ne(e.waves,$e,5),i&2&&ie()},inputs:{avatarVideoComponent:[1,"avatarVideoComponent"],overlayChatComponent:[1,"overlayChatComponent"]},outputs:{fullscreen:"fullscreen",recognizing$:"recognizing$"},standalone:!0,features:[K,V],decls:44,vars:28,consts:[["waves",""],["id","toolbar","cdkDrag","",1,"w-24","relative","flex","justify-center","items-start","text-white","flex-col","rounded-md","p-2","pt-36","bg-black/50"],["cdkDragHandle",""],["width","24px","fill","currentColor","viewBox","0 0 24 24",1,"absolute","cursor-move","top-1","right-1"],["d","M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"],["d","M0 0h24v24H0z","fill","none"],[1,"absolute","w-1/2","right-0","top-16","transition-all","duration-300",3,"ngClass"],[1,"w-full","bg-red-500","rounded-full",3,"click","matTooltip"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],["aria-label","record",1,"absolute","top-8","left-1/2","disabled:bg-gray-400","-translate-x-1/2","flex","flex-col","p-2","bg-white","size-28","overflow-hidden","rounded-full",3,"pointerdown","contextmenu","disabled"],[1,"relative","flex","items-center","justify-center"],[1,"absolute","z-20","font-semibold","text-white"],[1,"absolute","z-20","font-semibold","text-black"],[1,"size-24","overflow-hidden","transition-all","rounded-full","relative",3,"ngClass"],[1,"w-full","mt-5","pointer-events-none","h-full","opacity-90",3,"ngClass"],["matRipple","",1,"text-white",3,"click","matTooltip"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"w-full"],["d","M15.46 15.88L16.88 14.46L19 16.59L21.12 14.47L22.54 15.88L20.41 18L22.54 20.12L21.12 21.54L19 19.41L16.88 21.54L15.46 20.12L17.59 18L15.47 15.88M12 3C17.5 3 22 6.58 22 11C22 11.58 21.92 12.14 21.78 12.68C20.95 12.25 20 12 19 12C15.69 12 13 14.69 13 18L13.08 18.95L12 19C10.76 19 9.57 18.82 8.47 18.5C5.55 21 2 21 2 21C4.33 18.67 4.7 17.1 4.75 16.5C3.05 15.07 2 13.14 2 11C2 6.58 6.5 3 12 3Z"],[1,"block","p-1","w-full","truncate","text-gray-200","text-sm","border-b-2","border-gray-300","bg-transparent","focus:ring-primary","focus:border-primary","outline-none",3,"matTooltip","matTooltipClass","formControl"],[1,"text-gray-800","truncate",3,"value"],["id","settings",1,"bg-black/50","fixed","left-0","rounded","p-4","transition-transform",3,"ngClass"],[1,"relative","flex","flex-col"],["aria-label","Settings",1,"absolute","-top-2","-right-14","z-20","bg-black/50","rounded-r","text-white",3,"click","matTooltip"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-10"],["d","M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"],["aria-label","close stream",1,"text-white","cursor-progress","size-20","bg-orange-500","rounded-full"],["matRipple","","aria-label","close stream",1,"text-white","size-20","rounded-full",3,"ngClass"],["matRipple","",1,"text-white",3,"click"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-20"],["d","M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"],[1,"pulse","rounded-full","w-full","h-full","bg-primary","flex","justify-center","items-center"],["matRipple","","aria-label","close stream",1,"text-white","size-20","rounded-full",3,"click","ngClass"]],template:function(i,e){if(i&1){let s=y();r(0,"div",1)(1,"button",2),_(),r(2,"svg",3),u(3,"path",4)(4,"path",5),a()(),x(),r(5,"div",6)(6,"button",7),f("click",function(){return d(s),g(e.rejectText())}),_(),r(7,"svg",8)(8,"title"),c(9,"close"),a(),u(10,"path",9),a()()(),x(),r(11,"button",10),f("pointerdown",function(){return d(s),g(e.toggleRecording())})("contextmenu",function(M){return d(s),g(M.preventDefault())}),r(12,"div",11),b(13,qe,2,1,"span",12)(14,Ge,2,1,"span",13)(15,Qe,2,1,"span",12)(16,Ze,2,1,"span",12),r(17,"div",14),u(18,"div",15,0),a()()(),r(20,"button",16),f("click",function(){return d(s),g(e.clearChat())}),_(),r(21,"svg",17)(22,"title"),c(23,"remove chat"),a(),u(24,"path",18),a()(),x(),u(25,"app-avatar-interrupter-btn"),r(26,"select",19),ee(27,Ue,2,2,"option",20,Y),re(29,"async"),a()(),r(30,"div",21)(31,"div",22)(32,"button",23),f("click",function(){return d(s),g(e.toggleSettings())}),_(),r(33,"svg",24)(34,"title"),c(35,"cog"),a(),u(36,"path",25),a()(),b(37,We,4,1,"button",26)(38,Je,2,5,"button",27),x(),r(39,"button",28),f("click",function(){return d(s),g(e.fullscreen.emit())}),_(),r(40,"svg",29)(41,"title"),c(42,"fullscreen"),a(),u(43,"path",30),a()()()()}i&2&&(o(5),l("ngClass",L(19,Be,e.store.isRecordingStarted())),o(),l("matTooltip",e.lang.locals.cancel_recording),o(5),l("disabled",e.store.isRecordingLoading()||e.recognizingStatus()),o(2),v(e.store.isRecordingLoading()?13:-1),o(),v(e.store.isRecordingStopped()?14:-1),o(),v(e.store.isRecordingStarted()&&e.recognizingStatus()?15:-1),o(),v(e.store.isRecordingStarted()&&!e.recognizingStatus()?16:-1),o(),l("@recordButton",e.store.recording())("ngClass",N(21,Ne,e.recognizingStatus(),!e.recognizingStatus())),o(),l("ngClass",L(24,Oe,!e.store.isRecordingStarted())),o(2),l("matTooltip",e.lang.locals.clear_chat_history),o(6),l("matTooltip",e.lang.locals.change_bot+`
`+e.lang.locals.change_bot_note)("matTooltipClass","whitespace-pre-line")("formControl",e.chatService.botNameCtrl),o(),te(ae(29,17,e.botNames$)),o(3),l("ngClass",L(26,je,!e.settingsOpened)),o(2),l("matTooltip",e.lang.locals.settings),o(5),v(e.store.isStreamLoading()?37:38))},dependencies:[Le,Ve,le,me,ze,ke,_e,ve,Se,he,Ce,fe,ce],data:{animation:[de("recordButton",[k("InProgress",R({transform:"scale(1)",backgroundColor:"gray"})),k("Started",R({transform:"scale(1)"})),k("Stopped",R({transform:"scale(0)"})),ue("* <=> *",[ge("150ms ease-in-out")])])]}})};function Ke(t,n){t&1&&(r(0,"div",5)(1,"div",6),u(2,"div")(3,"div")(4,"div")(5,"div"),a()())}var O=class t{fullScreen="h-screen w-screen flex items-center justify-center";text=w("");element=m(W);store=m(E);recognizing(n){this.text.set(n)}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen().then():this.element.nativeElement.requestFullscreen().then()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=T({type:t,selectors:[["app-avatar"]],hostVars:1,hostBindings:function(i,e){i&2&&X("class",e.fullScreen)},standalone:!0,features:[V],decls:8,vars:5,consts:[["avatarVideoComponent",""],["overlayChatComponent",""],[3,"size"],[1,"absolute","top-10","right-10","size-28",3,"recognizing$","fullscreen","overlayChatComponent","avatarVideoComponent"],[1,"bg-black/40","absolute","top-1/2","text-white","font-sans","left-1/2","-translate-x-1/2"],[1,"z-50","flex","items-center","justify-center","w-full","bg-black/50","h-full","fixed"],[1,"lds-ellipsis"]],template:function(i,e){if(i&1){let s=y();u(0,"app-avatar-video",2,0)(2,"app-overlay-chat",null,1),r(4,"app-screen-control",3),f("recognizing$",function(M){return d(s),g(e.recognizing(M))})("fullscreen",function(){return d(s),g(e.toggleFullScreen())}),a(),r(5,"div",4),c(6),a(),b(7,Ke,6,0,"div",5)}if(i&2){let s=B(1),p=B(3);l("size","life-size"),o(4),l("overlayChatComponent",p)("avatarVideoComponent",s),o(2),h(e.text()),o(),v(e.store.isStreamLoading()?7:-1)}},dependencies:[Te,Ee,A]})};export{O as default};
