import{a as et}from"./chunk-S6IYD3DS.js";import{a as Je}from"./chunk-EQS6CYUE.js";import"./chunk-KTUQHV2C.js";import{a as Ze,b as Qe,c as Xe}from"./chunk-X4ZBG67H.js";import{a as te,b as G}from"./chunk-YSDUMFFL.js";import{a as ke,c as Ae,d as Be,e as De,f as Fe,g as Oe}from"./chunk-7X2DHCOJ.js";import"./chunk-WHDRZIJ5.js";import{a as qe}from"./chunk-ECJV426K.js";import"./chunk-6C372AG6.js";import"./chunk-N7Y26M7H.js";import{b as ze}from"./chunk-ATB2QM7G.js";import{a as Ke}from"./chunk-FAMFBZKA.js";import{a as $e}from"./chunk-IHOFWBF3.js";import"./chunk-2VS4TF6N.js";import{a as We}from"./chunk-BKBHW4WW.js";import"./chunk-JPHNJSB7.js";import"./chunk-WINWA72V.js";import{c as Ye}from"./chunk-INJDVHFI.js";import{b as Pe,d as Ne,e as Re,i as je}from"./chunk-5EYSXZY2.js";import{a as Z}from"./chunk-BYPM5Z5O.js";import{na as Ge,oa as Ue}from"./chunk-QQRSHZKF.js";import{c as Se,h as Me,l as Te,n as Ee,s as Le,t as Ie,u as He,z as ee}from"./chunk-3POO7YO6.js";import"./chunk-OK5S6IU3.js";import{a as we,b as be,f as Ve,g as $}from"./chunk-CXLFYQYW.js";import{Ab as L,B as H,Da as _,Ea as x,Eb as O,Ec as he,Fa as C,Fc as N,Ga as T,Gc as se,Ha as E,Hc as A,Ic as ve,Ja as pe,Jb as v,Kc as Ce,Lc as _e,M as Y,Nb as c,O as k,Qa as V,Rb as fe,Sb as p,Tb as X,Vb as z,W as de,Wb as P,X as le,Xb as r,Yb as l,Zb as d,a as re,bc as b,bd as R,ca as me,ea as W,ec as h,fa as M,gc as s,ha as w,hd as xe,i as Q,ib as F,ka as K,kc as ge,lb as ue,nd as j,ob as a,q as ce,qa as g,qd as ye,rc as I,sc as J,u as ae,ua as D,uc as f,vc as y,wc as S,zb as u}from"./chunk-5242NRUX.js";var U=class t{http=g(be);urlService=g(Ve);getListOfVideos(){let i=`${this.urlService.URLS.VIDEO_ANALYZER}/get_all_videos`;return this.http.get(i).pipe(H(e=>e.data.videos))}uploadVideo(i){let e=`${this.urlService.URLS.VIDEO_ANALYZER}/upload_video`,n=new FormData;return n.append("file",i),this.http.post(e,n)}getVideo(i){let e=`${this.urlService.URLS.VIDEO_ANALYZER}/get_vi`,n=new we().append("vid",i);return this.http.get(e,{params:n})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=K({token:t,factory:t.\u0275fac,providedIn:"root"})};var it=(t,i)=>i.id,ot=()=>({suppressScrollX:!0}),rt=()=>[1,2,3,4,5,6],at=t=>({"border-2 bg-gray-100 p-2 shadow-md rounded-md !border-primary/50 [&_span]:font-bold":t});function lt(t,i){t&1&&(r(0,"div",8),d(1,"div",9)(2,"div",10),l())}function st(t,i){t&1&&z(0,lt,3,0,"div",8,X),t&2&&P(se(0,rt))}function ct(t,i){if(t&1){let e=b();r(0,"button",12),h("click",function(){let o=_(e).$implicit,m=s(2);return x(m.selectedVideo.set(o))}),d(1,"img",13),r(2,"span",14),f(3),l()()}if(t&2){let e,n=i.$implicit,o=s(2);c("ngClass",A(5,at,((e=o.selectedVideo())==null?null:e.id)===n.id)),a(),c("src",n.thumbnail_url,F)("alt","video_thumb"+n.name),a(),c("title",n.name),a(),y(n.name)}}function dt(t,i){if(t&1&&z(0,ct,4,7,"button",11,it),t&2){let e=s();P(e.videos())}}var ie=class t extends Z(class{}){lang=g($);videoAnalyzerService=g(U);ref=g(ke);videos=u([]);selectedVideo=u(void 0);isLoading=u(!0);ngOnInit(){this.getAllVideos()}onVideoSelect(){this.ref.close(this.selectedVideo())}getAllVideos(){this.videoAnalyzerService.getListOfVideos().pipe(M(this.destroy$),w(i=>{this.videos.set(i),this.isLoading.set(!1)})).subscribe()}static \u0275fac=(()=>{let i;return function(n){return(i||(i=E(t)))(n||t)}})();static \u0275cmp=D({type:t,selectors:[["app-list-videos-popup"]],standalone:!0,features:[O,N],decls:14,vars:7,consts:[[1,"flex","flex-col","w-[min(500,80vw)]"],[1,"p-4","bg-primary","text-white"],["appPerfectScroll","",3,"perfectScrollOptions"],[1,"p-4","min-h-0","flex","flex-auto","flex-col"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-4"],[1,"flex","w-full","justify-between","mt-6","space-x-2","gap-4","p-4"],["type","button","mat-dialog-close","",1,"bg-gray-300","w-1/2","text-gray-800","font-medium","py-2","px-4","rounded-lg","hover:bg-gray-400","focus:ring-2","focus:ring-gray-200","focus:outline-none"],["type","button",1,"bg-primary/90","w-1/2","text-white","font-medium","py-2","px-4","rounded-lg","hover:bg-primary","focus:ring-4","focus:ring-gray-300","focus:outline-none","disabled:opacity-50",3,"click","disabled"],[1,"flex","flex-col","space-y-4","p-4","size-60","animate-pulse"],[1,"bg-gray-200","rounded-md","h-36","w-full"],[1,"bg-gray-200","rounded","h-4","w-3/4","mx-auto"],["type","button",1,"flex","flex-col","group","justify-center","items-center","space-y-4","size-60","hover:border-2","hover:bg-gray-100","hover:p-2","hover:shadow-md","hover:rounded-md","hover:border-primary/20","cursor-pointer","transition-all","focus:outline-none",3,"ngClass"],["type","button",1,"flex","flex-col","group","justify-center","items-center","space-y-4","size-60","hover:border-2","hover:bg-gray-100","hover:p-2","hover:shadow-md","hover:rounded-md","hover:border-primary/20","cursor-pointer","transition-all","focus:outline-none",3,"click","ngClass"],["loading","lazy",1,"border","border-transparent","rounded-md",3,"src","alt"],[1,"group-hover:font-bold","text-pretty","text-center","truncate",3,"title"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1),f(2),l(),r(3,"mat-dialog-content",2)(4,"div",3)(5,"div",4),v(6,st,2,1)(7,dt,2,0),l()()()(),r(8,"mat-dialog-actions")(9,"div",5)(10,"button",6),f(11),l(),r(12,"button",7),h("click",function(){return n.onVideoSelect()}),f(13),l()()()),e&2&&(a(2),y(n.lang.locals.videos_list),a(),c("perfectScrollOptions",se(6,ot)),a(3),p(n.isLoading()?6:7),a(5),S(" ",n.lang.locals.cancel," "),a(),c("disabled",!n.selectedVideo()),a(),S(" ",n.lang.locals.confirm," "))},dependencies:[Oe,Be,Fe,De,et,j]})};var q=class t extends G{messages=u([]);status=u(!1);conversationId=u("");sendMessage(i,e){let n=`${this.urlService.URLS.CHAT}/${e}`;return this.messages.update(o=>[...o,new te(i,"user")]),this.http.post(n,re(re({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null),this.conversationId()?{conversation_id:this.conversationId()}:null)).pipe(k(o=>{throw new te().clone({content:o.message,role:"error"}),new Error(o)}),H(o=>(o.message.content=Re(o.message.content,o.message),o)),W(o=>this.processFormattedText(o.message.content).pipe(H(m=>(o.message.content=Ne(m),o.message=new te().clone(o.message),this.messages.update(B=>[...B,o.message]),o)))))}static \u0275fac=(()=>{let i;return function(n){return(i||(i=E(t)))(n||t)}})();static \u0275prov=K({token:t,factory:t.\u0275fac,providedIn:"root"})};var mt=["chatContainer"],pt=["chatBody"],ut=["textArea"],ft=["recorder"],gt=(t,i)=>i.id,ht=t=>({hidden:t}),vt=(t,i)=>({"w-full h-full inset-0":t,"ltr:left-5 rtl:right-5":i});function Ct(t,i){if(t&1&&(r(0,"option",21),f(1),l()),t&2){let e=i.$implicit;c("value",e),a(),y(e)}}function _t(t,i){if(t&1&&(r(0,"select",7),z(1,Ct,2,2,"option",21,X),Ce(3,"async"),l()),t&2){let e=s();c("matTooltip",e.lang.locals.change_bot+`
`+e.lang.locals.change_bot_note)("matTooltipClass","whitespace-pre-line")("formControl",e.chatService.botNameCtrl),a(),P(_e(3,3,e.botNames$))}}function xt(t,i){t&1&&(C(),r(0,"svg",23),d(1,"path",24),l())}function yt(t,i){t&1&&(C(),r(0,"svg",23),d(1,"path",25),l())}function wt(t,i){if(t&1){let e=b();r(0,"button",22),h("click",function(){_(e);let o=s();return x(o.fullScreenToggle())}),v(1,xt,2,0,":svg:svg",23)(2,yt,2,0,":svg:svg",23),l()}if(t&2){let e=s();a(),p(e.fullscreenStatus()?1:2)}}function bt(t,i){if(t&1){let e=b();r(0,"button",22),h("click",function(){_(e);let o=s();return x(o.toggleChat())}),C(),r(1,"svg",23),d(2,"path",26),l()()}}function Vt(t,i){if(t&1&&(r(0,"div",27)(1,"p"),f(2),l()()),t&2){let e=s().$implicit;a(2),y(e.content)}}function St(t,i){if(t&1){let e=b();r(0,"div",28)(1,"span",30),h("animating",function(o){_(e);let m=s(2);return x(m.animating.set(o))}),l()()}if(t&2){let e=s().$implicit,n=s();a(),c("stop",n.stopAnimate())("text",e.content)}}function Mt(t,i){if(t&1&&(r(0,"div",29)(1,"p"),f(2),l()()),t&2){let e=s().$implicit;a(2),y(e.content)}}function Tt(t,i){if(t&1&&v(0,Vt,3,1,"div",27)(1,St,2,2,"div",28)(2,Mt,3,1,"div",29),t&2){let e=i.$implicit;p(e.isUser()?0:e.isAssistant()?1:2)}}function Et(t,i){t&1&&(r(0,"div",10),d(1,"div",31)(2,"div",32)(3,"div",33)(4,"div",34)(5,"div",35),l())}function Lt(t,i){if(t&1){let e=b();r(0,"div",11)(1,"span"),f(2),l(),r(3,"button",36),h("click",function(){_(e);let o=s();return x(o.rateConversation(o.feedbackOptions.LIKE))}),C(),r(4,"svg",37),d(5,"path",38),l(),f(6),l(),T(),r(7,"button",39),h("click",function(){_(e);let o=s();return x(o.rateConversation(o.feedbackOptions.DISLIKE))}),C(),r(8,"svg",37),d(9,"path",40),l(),f(10),l()()}if(t&2){let e=s();c("@slideFromBottom",void 0),a(2),y(e.lang.locals.rate_conversation),a(4),S(" ",e.lang.locals.i_like," "),a(4),S(" ",e.lang.locals.i_dislike," ")}}function It(t,i){if(t&1){let e=b();r(0,"button",41),h("click",function(){_(e);let o=s();return x(o.clearChatHistory())}),C(),r(1,"svg",15),d(2,"path",42),l()()}if(t&2){let e=s();c("matTooltip",e.lang.locals.clear_chat_history)}}function Ht(t,i){if(t&1){let e=b();r(0,"button",43),h("click",function(){_(e);let o=s();return x(o.stopAnimate.set(!0))}),C(),r(1,"svg",44),d(2,"path",45),l()()}if(t&2){let e=s();c("matTooltip",e.lang.locals.send)}}function kt(t,i){if(t&1){let e=b();r(0,"app-recorder",46,3),h("recognized$",function(o){_(e);let m=s();return x(m.messageCtrl.setValue(o))})("recognizing$",function(o){_(e);let m=s();return x(m.messageCtrl.setValue(o))}),l()}}function At(t,i){if(t&1){let e=b();r(0,"button",41),h("click",function(){_(e);let o=s();return x(o.toggleAvatar())}),C(),r(1,"svg",44),d(2,"path",47),l()()}if(t&2){let e=s();c("matTooltip",e.lang.locals.open_avatar)}}function Bt(t,i){if(t&1&&(r(0,"div",20)(1,"div",48)(2,"span",49),C(),r(3,"svg",50),d(4,"path",51),l(),f(5),l()(),T(),d(6,"app-avatar-video",52)(7,"app-avatar-interrupter-btn",53),l()),t&2){let e=s();a(5),S(" ",e.lang.locals.avatar_chat," "),a(),c("size",void 0)}}var oe=class t extends Z(class{}){lang=g($);chatService=g(G,{skipSelf:!0});injector=g(pe);document=g(xe);chatHistoryService=g(We);status=u(!0);showAvatarBtn=V(!0);showClearMsgBtn=V(!0);showFullScreenBtn=V(!0);showHideBtn=V(!0);showRatingBox=V(!0);showRecorderBtn=V(!0);title=V(this.lang.locals.chat);containerClass=V("");botNameOptions=V.required();clearMessageOnly=V(!1);chatContainer=L.required("chatContainer");chatBodyContainer=L("chatBody");messageInput=L.required("textArea");recorder=L("recorder");avatarOn=!1;fullscreenStatus=u(!1);answerInProgress=u(!1);animating=u(!1);stopAnimate=u(!1);ratingDone=u(!1);botNames$=this.chatHistoryService.getAllBotNames();feedbackOptions=Ke;chatBodyContainerEffect=R(()=>{this.chatBodyContainer()?this.scrollbarRef=new $e(this.chatBodyContainer().nativeElement):this.scrollbarRef&&this.scrollbarRef.destroy()});answerInProgressEffect=R(()=>{this.answerInProgress()?this.messageCtrl.disable():this.messageCtrl.enable()});animatingEffect=R(()=>{if(!this.animating()){let i=this.chatBodyContainer()?.nativeElement?.querySelectorAll(".chat-message"),e=i&&i[i.length-1];e&&e.scrollIntoView(!0)}});statusEffect=R(()=>{if(this.status()){let i=setTimeout(()=>{this.messageInput().nativeElement.focus(),clearTimeout(i)})}});messageCtrl=new Te("",{nonNullable:!0});sendMessage$=new ce;ngOnInit(){this.listenToSendMessage(),this.listenToBotNameChange()}listenToBotNameChange(){this.chatService.onBotNameChange().pipe(M(this.destroy$),me(()=>!this.botNameOptions().showBotSelection)).subscribe()}toggleChat(){this.status.update(i=>!i)}fullScreenToggle(){console.log(this.chatContainer().nativeElement),this.document.fullscreenElement?this.document.exitFullscreen().then(()=>this.fullscreenStatus.set(!1)):this.chatContainer().nativeElement.requestFullscreen().then(()=>this.fullscreenStatus.set(!0))}listenToSendMessage(){return this.sendMessage$.pipe(M(this.destroy$)).pipe(Y(()=>!!this.messageCtrl.value.trim())).pipe(H(()=>this.messageCtrl.value.trim())).pipe(w(()=>this.stopAnimate.set(!1))).pipe(w(()=>this.messageCtrl.setValue(""))).pipe(w(()=>this.recorder()?.cleartext())).pipe(w(()=>this.answerInProgress.set(!0))).pipe(w(()=>this.goToEndOfChat())).pipe(de(i=>this.chatService.sendMessage(i,this.botNameOptions().showBotSelection?this.chatService.botNameCtrl.value:this.botNameOptions().botName).pipe(k(e=>{throw this.answerInProgress.set(!1),new Error(e)})).pipe(Pe()))).subscribe(()=>{this.answerInProgress.set(!1),Promise.resolve().then(()=>{this.messageInput()?.nativeElement?.focus();let i=setTimeout(()=>{this.scrollToTop(),clearInterval(i)},50)})})}scrollToTop(){let i=this.chatBodyContainer()?.nativeElement?.querySelectorAll(".chat-message"),e=i&&i[i.length-1],n=setInterval(()=>{e&&e.scrollIntoView(!0)},50);R(o=>{!this.animating()&&n&&clearInterval(n),o(()=>{n&&clearInterval(n)})},{injector:this.injector})}goToEndOfChat(){let i=setTimeout(()=>{let e=this.chatBodyContainer()?.nativeElement?.querySelectorAll(".user-message");e&&e[e.length-1]?.scrollIntoView(!0),clearTimeout(i)})}clearChatHistory(){if(this.clearMessageOnly()){this.chatService.messages.set([]);return}this.chatService.messages.set([]),this.chatService.conversationId.set(""),this.ratingDone.set(!1)}toggleAvatar(){this.avatarOn=!this.avatarOn}detectFullScreenMode(){let i=!!this.document.fullscreenElement;i||this.fullscreenStatus.set(i)}rateConversation(i){let e=this.chatService.conversationId();this.chatHistoryService.addFeedback(e,i).pipe(M(this.destroy$)).subscribe(()=>{this.ratingDone.set(!0)})}static \u0275fac=(()=>{let i;return function(n){return(i||(i=E(t)))(n||t)}})();static \u0275cmp=D({type:t,selectors:[["app-chat-container"]],viewQuery:function(e,n){e&1&&(I(n.chatContainer,mt,5),I(n.chatBodyContainer,pt,5),I(n.messageInput,ut,5),I(n.recorder,ft,5)),e&2&&J(4)},hostBindings:function(e,n){e&1&&h("fullscreenchange",function(){return n.detectFullScreenMode()},!1,ue)},inputs:{showAvatarBtn:[1,"showAvatarBtn"],showClearMsgBtn:[1,"showClearMsgBtn"],showFullScreenBtn:[1,"showFullScreenBtn"],showHideBtn:[1,"showHideBtn"],showRatingBox:[1,"showRatingBox"],showRecorderBtn:[1,"showRecorderBtn"],title:[1,"title"],containerClass:[1,"containerClass"],botNameOptions:[1,"botNameOptions"],clearMessageOnly:[1,"clearMessageOnly"]},standalone:!0,features:[O,N],decls:29,vars:24,consts:[["chatContainer",""],["chatBody",""],["textArea",""],["recorder",""],[3,"ngClass"],[1,"bg-gray-200","border-b","border-primary/40","flex","justify-between","items-center","px-4","py-2"],[1,"flex","justify-center","items-center","gap-2"],[1,"block","p-1","w-24","text-sm","border-b-2","bg-transparent","border-gray-400","focus:ring-primary","focus:border-primary","outline-none",3,"matTooltip","matTooltipClass","formControl"],["matRipple","",1,"bg-gray-400","hover:bg-primary","border","rounded-full","p-1","text-white"],[1,"flex-auto","overflow-hidden","flex","flex-col","relative","min-h-0","p-4"],[1,"spinner","justify-center","flex","gap-1"],[1,"sticky","bottom-0","left-0","w-56","self-end","scale-90","hover:scale-95","hover:duration-300","hover:transition-transform","bg-gray-300/30","p-1","rounded-tl-md","rounded-tr-md","border","border-gray-300","border-b-0","shadow-sm","text-gray-700","flex","items-center","justify-evenly","gap-4","mt-auto","[&_button]:flex","[&_button]:flex-col","[&_button]:justify-center","[&_button]:items-center","[&_button]:text-sm","[&_button]:leading-none"],[1,"p-4","gap-2","flex","justify-center","items-stretch"],[1,"rounded-full","bg-white","relative","text-primary","hover:bg-gray-200","shadow","shadow-primary","overflow-hidden","border","flex-shrink-0","flex-grow-0","flex","items-center","justify-center","outline-none","ring-offset-1","focus:ring-2","ring-primary","size-12",3,"matTooltip"],[1,"bg-primary","rounded","outline-none","ring-offset-1","focus:ring-2","ring-primary","text-white","px-2",3,"click","matTooltip","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 256 256",1,"size-8"],["d","M227.32,28.68a16,16,0,0,0-15.66-4.08l-.15,0L19.57,82.84a16,16,0,0,0-2.49,29.8L102,154l41.3,84.87A15.86,15.86,0,0,0,157.74,248q.69,0,1.38-.06a15.88,15.88,0,0,0,14-11.51l58.2-191.94c0-.05,0-.1,0-.15A16,16,0,0,0,227.32,28.68ZM157.83,231.85l-.05.14,0-.07-40.06-82.3,48-48a8,8,0,0,0-11.31-11.31l-48,48L24.08,98.25l-.07,0,.14,0L216,40Z"],[1,"relative","w-full"],[1,"border","w-full","outline-none","rounded","focus:ring-2","ring-offset-1","ring-primary","resize-none","p-2",3,"keydown.enter","formControl"],[1,"absolute","top-2","right-0","mr-1","rounded-full","bg-white","text-primary","hover:bg-gray-200","overflow-hidden","border-primary","border-2","flex-shrink-0","flex-grow-0","flex","items-center","justify-center","outline-none","ring-offset-1","focus:ring-2","ring-primary","size-7",3,"matTooltip"],["cdkDrag","",1,"bg-black","border","rounded-md","border-gray-200","size-80","z-30","rtl:right-[500px]","ltr:left-[500px]","rtl:mr-5","ltr:ml-m","absolute","bottom-10","overflow-hidden"],[3,"value"],["matRipple","",1,"bg-gray-400","hover:bg-primary","border","rounded-full","p-1","text-white",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 256 256",1,"size-6"],["d","M144,104V64a8,8,0,0,1,16,0V84.69l42.34-42.35a8,8,0,0,1,11.32,11.32L171.31,96H192a8,8,0,0,1,0,16H152A8,8,0,0,1,144,104Zm-40,40H64a8,8,0,0,0,0,16H84.69L42.34,202.34a8,8,0,0,0,11.32,11.32L96,171.31V192a8,8,0,0,0,16,0V152A8,8,0,0,0,104,144Zm67.31,16H192a8,8,0,0,0,0-16H152a8,8,0,0,0-8,8v40a8,8,0,0,0,16,0V171.31l42.34,42.35a8,8,0,0,0,11.32-11.32ZM104,56a8,8,0,0,0-8,8V84.69L53.66,42.34A8,8,0,0,0,42.34,53.66L84.69,96H64a8,8,0,0,0,0,16h40a8,8,0,0,0,8-8V64A8,8,0,0,0,104,56Z"],["d","M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"],["d","M176,128a8,8,0,0,1-8,8H88a8,8,0,0,1,0-16h80A8,8,0,0,1,176,128Zm56,0A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"],[1,"user-message","chat-message","ltr:self-end","min-w-[min(400px,100%)]","rtl:self-start","rtl:!rounded-tr-none","ltr:!rounded-tr-none"],[1,"assistant-message","chat-message","whitespace-break-spaces","ltr:self-start","min-w-[min(400px,100%)]","rtl:self-end","rtl:!rounded-tl-none","ltr:!rounded-tr-none"],[1,"system-message","chat-message"],["appTextWriterAnimator","",3,"animating","stop","text"],[1,"rect1"],[1,"rect2"],[1,"rect3"],[1,"rect4"],[1,"rect5"],[1,"bg-transparent","text-primary/80","hover:text-primary",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-current"],["d","M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z"],[1,"bg-transparent","text-gray-600","hover:text-gray-700",3,"click"],["d","M19,15V3H23V15H19M15,3A2,2 0 0,1 17,5V15C17,15.55 16.78,16.05 16.41,16.41L9.83,23L8.77,21.94C8.5,21.67 8.33,21.3 8.33,20.88L8.36,20.57L9.31,16H3C1.89,16 1,15.1 1,14V12C1,11.74 1.05,11.5 1.14,11.27L4.16,4.22C4.46,3.5 5.17,3 6,3H15M15,5H5.97L3,12V14H11.78L10.65,19.32L15,14.97V5Z"],[1,"rounded-full","bg-white","relative","text-primary","hover:bg-gray-200","shadow","shadow-primary","overflow-hidden","border","flex-shrink-0","flex-grow-0","flex","items-center","justify-center","outline-none","ring-offset-1","focus:ring-2","ring-primary","size-12",3,"click","matTooltip"],["d","M216,48H176V40a24,24,0,0,0-24-24H104A24,24,0,0,0,80,40v8H40a8,8,0,0,0,0,16h8V208a16,16,0,0,0,16,16H192a16,16,0,0,0,16-16V64h8a8,8,0,0,0,0-16ZM96,40a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96Zm96,168H64V64H192ZM112,104v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Zm48,0v64a8,8,0,0,1-16,0V104a8,8,0,0,1,16,0Z"],[1,"absolute","top-2","right-0","mr-1","rounded-full","bg-white","text-primary","hover:bg-gray-200","overflow-hidden","border-primary","border-2","flex-shrink-0","flex-grow-0","flex","items-center","justify-center","outline-none","ring-offset-1","focus:ring-2","ring-primary","size-7",3,"click","matTooltip"],["xmlns","http://www.w3.org/2000/svg","fill","currentColor","viewBox","0 0 24 24",1,"size-8"],["d","M18,18H6V6H18V18Z"],[3,"recognized$","recognizing$"],["d","M18.72,14.76C19.07,13.91 19.26,13 19.26,12C19.26,11.28 19.15,10.59 18.96,9.95C18.31,10.1 17.63,10.18 16.92,10.18C13.86,10.18 11.15,8.67 9.5,6.34C8.61,8.5 6.91,10.26 4.77,11.22C4.73,11.47 4.73,11.74 4.73,12A7.27,7.27 0 0,0 12,19.27C13.05,19.27 14.06,19.04 14.97,18.63C15.54,19.72 15.8,20.26 15.78,20.26C14.14,20.81 12.87,21.08 12,21.08C9.58,21.08 7.27,20.13 5.57,18.42C4.53,17.38 3.76,16.11 3.33,14.73H2V10.18H3.09C3.93,6.04 7.6,2.92 12,2.92C14.4,2.92 16.71,3.87 18.42,5.58C19.69,6.84 20.54,8.45 20.89,10.18H22V14.67H22V14.69L22,14.73H21.94L18.38,18L13.08,17.4V15.73H17.91L18.72,14.76M9.27,11.77C9.57,11.77 9.86,11.89 10.07,12.11C10.28,12.32 10.4,12.61 10.4,12.91C10.4,13.21 10.28,13.5 10.07,13.71C9.86,13.92 9.57,14.04 9.27,14.04C8.64,14.04 8.13,13.54 8.13,12.91C8.13,12.28 8.64,11.77 9.27,11.77M14.72,11.77C15.35,11.77 15.85,12.28 15.85,12.91C15.85,13.54 15.35,14.04 14.72,14.04C14.09,14.04 13.58,13.54 13.58,12.91A1.14,1.14 0 0,1 14.72,11.77Z"],[1,"w-full","flex"],[1,"w-full","bg-gray-200","p-2","text-center","relative"],["cdkDragHandle","","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","absolute","top-0","right-0","cursor-move","fill-gray-500","m-2"],["d","M13,6V11H18V7.75L22.25,12L18,16.25V13H13V18H16.25L12,22.25L7.75,18H11V13H6V16.25L1.75,12L6,7.75V11H11V6H7.75L12,1.75L16.25,6H13Z"],[1,"w-full",3,"size"],[1,"absolute","z-10","top-12","w-12","mx-4"]],template:function(e,n){if(e&1){let o=b();r(0,"div",4,0)(2,"div",4)(3,"div",5)(4,"div",6)(5,"span"),f(6),l(),v(7,_t,4,5,"select",7),l(),r(8,"div"),v(9,wt,3,1,"button",8)(10,bt,3,0,"button",8),l()(),r(11,"div",9,1),z(13,Tt,3,1,null,null,gt),v(15,Et,6,0,"div",10)(16,Lt,11,4,"div",11),l(),r(17,"div",12),v(18,It,3,1,"button",13),r(19,"button",14),h("click",function(){return _(o),x(n.sendMessage$.next())}),C(),r(20,"svg",15),d(21,"path",16),l()(),T(),r(22,"div",17)(23,"input",18,2),h("keydown.enter",function(){return _(o),x(n.sendMessage$.next())}),l(),v(25,Ht,3,1,"button",19),l(),v(26,kt,2,0,"app-recorder")(27,At,3,1,"button",13),l()(),v(28,Bt,8,2,"div",20),l()}e&2&&(c("ngClass",A(19,ht,!n.status())),a(2),fe("z-20 bg-white w-[500px] ",n.containerClass()," h-[600px] relative shadow-2xl rounded-md overflow-hidden bottom-5 max-h-full max-w-full flex flex-col"),c("ngClass",ve(21,vt,n.fullscreenStatus(),!n.fullscreenStatus())),a(4),y(n.title()),a(),p(n.botNameOptions().showBotSelection?7:-1),a(2),p(n.showFullScreenBtn()?9:-1),a(),p(n.showHideBtn()?10:-1),a(3),P(n.chatService.messages()),a(2),p(n.answerInProgress()?15:-1),a(),p(n.chatService.messages().length>1&&!n.ratingDone()&&n.showRatingBox()?16:-1),a(2),p(n.showClearMsgBtn()?18:-1),a(),c("matTooltip",n.lang.locals.send)("disabled",n.answerInProgress()),a(4),c("formControl",n.messageCtrl),a(2),p(n.animating()?25:-1),a(),p(n.showRecorderBtn()?26:-1),a(),p(n.showAvatarBtn()?27:-1),a(),p(n.avatarOn?28:-1))},dependencies:[ee,Ie,He,Se,Le,Me,Ee,Ue,Ge,j,Ze,qe,Qe,Xe,ye]})};var Dt=["selectedVideo"],Ft=["chatBox"],Ot=t=>({"!w-full":t}),zt=t=>({showBotSelection:!1,botName:t});function Pt(t,i){if(t&1&&(r(0,"div",3),d(1,"app-chat-container",13,0),l()),t&2){let e=s();c("@slideIn",void 0),a(),c("botNameOptions",A(7,zt,e.botName()))("title",e.lang.locals.video_analyzer)("showAvatarBtn",!1)("showFullScreenBtn",!1)("showHideBtn",!1)("clearMessageOnly",!0)}}function Nt(t,i){if(t&1&&(r(0,"div",9)(1,"div",14)(2,"span",15),f(3),l()(),r(4,"video",16,1),d(6,"source",17),l()()),t&2){let e,n,o,m=s();a(2),c("title",(e=m.video())==null||e.file==null?null:e.file.name),a(),y((n=m.video())==null||n.file==null?null:n.file.name),a(),c("poster",m.poster(),F),a(2),c("src",(o=m.video())==null?null:o.base64,F)}}function Rt(t,i){if(t&1&&(r(0,"div",9)(1,"div",14)(2,"span",15),f(3),l()(),d(4,"img",18),l()),t&2){let e,n,o,m,B=s();a(2),c("title",(e=B.videoData())==null?null:e.name),a(),y((n=B.videoData())==null?null:n.name),a(),ge("alt","thumbnails_",(o=B.videoData())==null?null:o.name,""),c("src",(m=B.videoData())==null?null:m.thumbnail_url,F)}}function jt(t,i){if(t&1&&(C(),r(0,"svg",21)(1,"g",22),d(2,"path",23),l(),r(3,"g",24),d(4,"path",25)(5,"path",26),l()(),T(),r(6,"p",27),f(7),l()),t&2){let e=s(2);a(7),y(e.lang.locals.uploading_file_msg)}}function $t(t,i){if(t&1&&(C(),r(0,"svg",28),d(1,"g",29)(2,"g",30),r(3,"g",31),d(4,"path",32)(5,"path",33),l()(),T(),r(6,"p",27),f(7),l()),t&2){let e=s(2);a(7),y(e.lang.locals.file_info_msg)}}function Zt(t,i){if(t&1&&(d(0,"div",19),r(1,"div",20),v(2,jt,8,1)(3,$t,8,1),l()),t&2){let e=s();a(2),p(e.isLoading()==="UPLOAD"?2:-1),a(),p(e.isLoading()==="GET_INFO"?3:-1)}}var nt=class t extends Z(class{}){lang=g($);fileUploaderService=g(Je);videoAnalyzerService=g(U);videoIndexerChatService=g(q);video=u(void 0);videoData=u(void 0);dialog=g(Ae);store=g(ze);selectedVideo=L("selectedVideo");chatContainer=L("chatBox");poster=u("");isLoading=u(void 0);botName=u("");uploadVideo(i){return Q(this,null,function*(){let e=i.target;if(!e?.files||e.files.length===0){console.warn("No files selected for upload.");return}try{let n=Array.from(e.files);this.isLoading.set("UPLOAD");let o=yield this.fileUploaderService.uploadFiles(n);if(o.length===0)throw new Error("File upload failed. No files returned from the server.");this.videoAnalyzerService.uploadVideo(o[0].file).pipe(M(this.destroy$),w(({data:m})=>{this.chatContainer()?.clearChatHistory(),this.botName.set(m.bot_name),this.videoIndexerChatService.conversationId.set(m.conversation_id),this.video.set(o[0]),this.videoData.set(void 0)}),k(m=>(console.error("Error during video processing:",m),ae)),le(()=>{this.isLoading.set(void 0),this.generateVideoThumbnail()})).subscribe()}catch(n){console.error("Error during file upload:",n),this.isLoading.set(void 0)}})}generateVideoThumbnail(){return Q(this,null,function*(){try{let i=this.selectedVideo()?.nativeElement;if(!i){console.warn("Video element not found for thumbnail capture.");return}setTimeout(()=>Q(this,null,function*(){try{let e=yield je(i);this.poster.set(e)}catch(e){console.error("Error capturing video thumbnail:",e)}}),1e3)}catch(i){console.error("Error generating video thumbnail:",i)}})}openVideosList(){this.dialog.open(ie).afterClosed().pipe(w(()=>this.isLoading.set("GET_INFO")),Y(i=>!!i),W(i=>this.videoAnalyzerService.getVideo(i.id).pipe(M(this.destroy$),w(({data:e})=>{this.chatContainer()?.clearChatHistory(),this.video.set(void 0),this.botName.set(e.bot_name),this.videoIndexerChatService.conversationId.update(()=>e.conversation_id),this.videoData.set(i)}),le(()=>this.isLoading.set(void 0)),k(e=>(console.error("Error fetching video data:",e),ae))))).subscribe()}static \u0275fac=(()=>{let i;return function(n){return(i||(i=E(t)))(n||t)}})();static \u0275cmp=D({type:t,selectors:[["app-video-analyzer"]],viewQuery:function(e,n){e&1&&(I(n.selectedVideo,Dt,5),I(n.chatContainer,Ft,5)),e&2&&J(2)},standalone:!0,features:[he([{provide:G,useExisting:q}]),O,N],decls:16,vars:9,consts:[["chatBox",""],["selectedVideo",""],[1,"flex","justify-between","items-center"],[1,"w-1/2"],[1,"flex","flex-col","justify-center","items-center","space-y-6","w-1/2","transition-all","ease-out","duration-200",3,"ngClass"],["type","file","accept","video/*","id","video_uploader",1,"hidden",3,"change"],["for","video_uploader",1,"inline-flex","gap-2","justify-center","items-center","text-xl","shadow-lg","border-none","w-2/5","text-center","focus:outline-none","hover:scale-110","hover:border-gray-500","cursor-pointer","bg-gray-300","text-gray-700","rounded-md","p-4","transition-all","ease-in-out","duration-200"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6"],["d","M2 12H4V17H20V12H22V17C22 18.11 21.11 19 20 19H4C2.9 19 2 18.11 2 17V12M12 2L6.46 7.46L7.88 8.88L11 5.75V15H13V5.75L16.13 8.88L17.55 7.45L12 2Z"],[1,"relative","flex","justify-center","items-center","w-2/3","h-60","rounded-md","border","border-gray-300","shadow-sm","bg-black","overflow-hidden"],[1,"h-1","block","w-1/2"],["type","button",1,"inline-flex","gap-2","justify-center","items-center","text-xl","shadow-lg","text-gray-300","bg-transparent","p-4","w-2/5","text-center","border","border-gray-300","focus:outline-none","hover:scale-110","rounded-md","transition-all","ease-in-out","duration-200",3,"click"],["d","M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"],["containerClass","!static !w-full !h-[400px] m-4 text-gray-700",3,"botNameOptions","title","showAvatarBtn","showFullScreenBtn","showHideBtn","clearMessageOnly"],[1,"absolute","w-full","flex","justify-center","items-center","top-0","bg-black/40","p-2"],[1,"truncate",3,"title"],["controls","",1,"h-full","bg-transparent","bg-cover",3,"poster"],[3,"src"],["loading","lazy",3,"src","alt"],[1,"bg-black","opacity-50","fixed","inset-0","z-50"],[1,"fixed","inset-0","z-50","flex","flex-col","items-center","justify-center","text-white"],["width","228px","height","228px","viewBox","0 0 1024.00 1024.00","version","1.1","xmlns","http://www.w3.org/2000/svg","fill","#000000","stroke","#000000","stroke-width","0.01024",1,"icon","opacity-100"],[1,"cloud"],["d","M768 810.7c-23.6 0-42.7-19.1-42.7-42.7s19.1-42.7 42.7-42.7c94.1 0 170.7-76.6 170.7-170.7 0-89.6-70.1-164.3-159.5-170.1L754 383l-10.7-22.7c-42.2-89.3-133-147-231.3-147s-189.1 57.7-231.3 147L270 383l-25.1 1.6c-89.5 5.8-159.5 80.5-159.5 170.1 0 94.1 76.6 170.7 170.7 170.7 23.6 0 42.7 19.1 42.7 42.7s-19.1 42.7-42.7 42.7c-141.2 0-256-114.8-256-256 0-126.1 92.5-232.5 214.7-252.4C274.8 195.7 388.9 128 512 128s237.2 67.7 297.3 174.2C931.5 322.1 1024 428.6 1024 554.7c0 141.1-114.8 256-256 256z",1,"fill-gray-100"],[1,"arrow"],["d","M640 789.3c-10.9 0-21.8-4.2-30.2-12.5L512 679l-97.8 97.8c-16.6 16.7-43.7 16.7-60.3 0-16.7-16.7-16.7-43.7 0-60.3l128-128c16.6-16.7 43.7-16.7 60.3 0l128 128c16.7 16.7 16.7 43.7 0 60.3-8.4 8.4-19.3 12.5-30.2 12.5z",1,"fill-gray-400"],["d","M512 960c-23.6 0-42.7-19.1-42.7-42.7V618.7c0-23.6 19.1-42.7 42.7-42.7s42.7 19.1 42.7 42.7v298.7c0 23.5-19.1 42.6-42.7 42.6z",1,"fill-gray-400"],[1,"mt-4","text-lg","animate-pulse","opacity-100"],["width","228px","height","228px","fill","#000000","viewBox","0 0 24 24","id","analysis-left","data-name","Line Color","xmlns","http://www.w3.org/2000/svg",1,"icon","line-color","magnifier-animation"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["id","secondary","d","M5.83,12.12,3,15M8,7a3,3,0,1,0,3,3A3,3,0,0,0,8,7Zm3,10h6m-2-4h2",1,"stroke-gray-300",2,"fill","none","stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],["id","primary","d","M8,3H20a1,1,0,0,1,1,1V20a1,1,0,0,1-1,1H8a1,1,0,0,1-1-1V17",1,"stroke-gray-400",2,"fill","none","stroke-linecap","round","stroke-linejoin","round","stroke-width","2"]],template:function(e,n){e&1&&(r(0,"div",2),v(1,Pt,3,9,"div",3),r(2,"div",4)(3,"input",5),h("change",function(m){return n.uploadVideo(m)}),l(),r(4,"label",6),f(5),C(),r(6,"svg",7),d(7,"path",8),l()(),v(8,Nt,7,4,"div",9),T(),d(9,"hr",10),r(10,"button",11),h("click",function(){return n.openVideosList()}),f(11),C(),r(12,"svg",7),d(13,"path",12),l()(),v(14,Rt,5,5,"div",9),l()(),v(15,Zt,4,2)),e&2&&(a(),p(n.video()||n.videoData()?1:-1),a(),c("ngClass",A(7,Ot,!n.video()&&!n.videoData())),a(3),S("",n.lang.locals.upload_video," "),a(3),p(n.video()?8:-1),a(3),S(" ",n.lang.locals.choose_video_from_list," "),a(3),p(n.videoData()?14:-1),a(),p(n.isLoading()?15:-1))},dependencies:[ee,oe,j],styles:["@keyframes _ngcontent-%COMP%_cloudMove{0%,to{transform:translateY(0)}50%{transform:translateY(-20px)}}@keyframes _ngcontent-%COMP%_arrowMove{0%{transform:translateY(10px);opacity:.5}50%{transform:translateY(-80px);opacity:1}to{transform:translateY(10px);opacity:.5}}.magnifier-animation[_ngcontent-%COMP%]   #secondary[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_magnifier-bounce 2s infinite;transform-origin:8px 7px}@keyframes _ngcontent-%COMP%_magnifier-bounce{0%,to{transform:scale(1)}50%{transform:scale(1.2)}}.cloud[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_cloudMove 2s infinite ease-in-out}.arrow[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_arrowMove 1.5s infinite ease-in-out}"],data:{animation:[Ye]}})};export{nt as VideoAnalyzerComponent};
