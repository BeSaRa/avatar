import{a as f,e as x,h as g}from"./chunk-COAW4WTH.js";import{H as u,J as s,a as c,ea as m,ka as i,sb as a,t as l,x as p}from"./chunk-HKFUFUH4.js";function w(t=!1){return n=>n.pipe(s(e=>(t&&console.log(e),l("CUSTOM_ERROR")))).pipe(u(e=>e!=="CUSTOM_ERROR"))}function d(){let t=new Date().getTime(),n=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let r=Math.random()*16;return t>0?(r=(t+r)%16|0,t=Math.floor(t/16)):(r=(n+r)%16|0,n=Math.floor(n/16)),(e==="x"?r:r&3|8).toString(16)})}function h(t){return/[\u0600-\u06FF]+/.test(t)}var C=t=>(t.split(" ").map(n=>(h(n)?"\u202A":"\u202C")+n).join(" "),t);function b(t){return class extends t{clone(e){let r=this.constructor;return Object.assign(new r,this,e)}}}var o=class extends b(class{}){constructor(e="",r="user"){super();this.content=e;this.role=r;this.id=d()}context;end_turn;function_call;tool_calls;id;isUser(){return this.role==="user"}isAssistant(){return this.role==="assistant"}isError(){return this.role==="error"}};var T=class t{http=i(f);urlService=i(x);store=i(g);messages=a([]);status=a(!1);sendMessage(n){return this.messages.update(e=>[...e,new o(n,"user")]),this.http.post(this.urlService.URLS.CHAT,c({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null)).pipe(s(e=>{throw new o().clone({content:e.message,role:"error"}),new Error(e)})).pipe(p(e=>(e.message.content=C(this.formatText(e.message.content)),e.message=new o().clone(e.message),this.messages.update(r=>[...r,e.message]),e)))}formatText(n){let e=n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");return e=e.replace(/\[(.*?)\]/g,'<pre class="d-inline"><small class="px-1 text-primary">$1<i class="link-icon"></i></small></pre>'),e.trim()}static \u0275fac=function(e){return new(e||t)};static \u0275prov=m({token:t,factory:t.\u0275fac,providedIn:"root"})};export{w as a,T as b};
