import{r as Ae}from"./chunk-HIIKR5IJ.js";import{a as Ee}from"./chunk-5C4HXBH5.js";import{a as Fe,b as $e,c as Me,d as Ie,e as Be,f as De}from"./chunk-T4VMYS5S.js";import{a as He}from"./chunk-FAMFBZKA.js";import{a as Oe}from"./chunk-IHOFWBF3.js";import"./chunk-KO4IYZJD.js";import{a as Ve}from"./chunk-M33EKD2Z.js";import"./chunk-SRD5X443.js";import"./chunk-Q3WM7GCC.js";import"./chunk-4HQIBS45.js";import{a as Le}from"./chunk-IB75ZEMT.js";import{ja as K,ka as U,la as q,na as Q}from"./chunk-2SSA22JS.js";import{c as ke,h as we,l as Se,n as Te,z as Z}from"./chunk-5O2HWMRO.js";import"./chunk-OK5S6IU3.js";import{g as B}from"./chunk-SKPQZEK7.js";import{Ab as _,B as ne,Bb as de,C as ie,Cc as N,Ea as p,Fa as m,Fb as pe,Ga as v,Gc as I,Ha as O,Ia as se,Ic as ge,Kb as y,Kc as fe,Lc as L,Mc as E,Nc as Ce,Ob as g,Q as re,Qa as le,Ra as W,Tb as k,Ub as R,V as oe,Vb as H,Wb as w,Xb as S,Y as te,Yb as o,Zb as l,_b as f,a as F,ad as G,b as ee,bd as he,cc as T,cd as ve,ea as j,fa as ae,fc as C,ga as A,hc as u,ia as $,ib as ce,od as be,pb as s,q as D,r as z,ra as V,rd as _e,sc as me,tc as ue,td as ye,uc as P,ud as xe,va as M,vc as d,wc as x,xc as h}from"./chunk-QDEZZFGD.js";function We(i,e){if(i&1&&(o(0,"div",1)(1,"h2",2),d(2),l(),N(3),f(4,"canvas",3),l()),i&2){let t=e.$implicit;s(2),x(t.value.title);let n=t.value.chart;s(2),g("data",n.data)("labels",n.data.labels)("type",n.type)("options",n.options)}}var c={sentiment:{negative:{fill:"rgba(244, 67, 54, 0.8)",border:"rgb(244, 67, 54)"},mixed:{fill:"rgba(255, 193, 7, 0.8)",border:"rgb(255, 193, 7)"},positive:{fill:"rgba(76, 175, 80, 0.8)",border:"rgb(76, 175, 80)"},neutral:{fill:"rgba(158, 158, 158, 0.8)",border:"rgb(158, 158, 158)"},undefined:{fill:"rgba(96, 125, 139, 0.8)",border:"rgb(96, 125, 139)"}},feedback:{like:{fill:"rgba(76, 175, 80, 0.8)",border:"rgb(76, 175, 80)"},dislike:{fill:"rgba(244, 67, 54, 0.8)",border:"rgb(244, 67, 54)"},unspecified:{fill:"rgba(158, 158, 158, 0.8)",border:"rgb(158, 158, 158)"}}},X=class i{conversations=W.required();lang=V(B);charts=G(()=>this.conversations()?this.getCharts():this.getCharts());getCharts(){return{feedback_chart:{title:this.lang.locals.feedback_chart,chart:this.getFeedbackChartConfig()},sentiment_chart:{title:this.lang.locals.sentiment_chart,chart:this.getSentimentChartConfig()},performance_chart:{title:this.lang.locals.performance_chart,chart:this.getBotPerformanceChartConfig()}}}getChartOptions(e=!1){return{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{rtl:this.lang.currentLanguage==="ar"}},scales:e?{x:{stacked:!0},y:{beginAtZero:!0,stacked:!0}}:void 0}}calculateSetimentDistribution(){let e={negative:0,mixed:0,positive:0,neutral:0,undefined:0};return this.conversations().forEach(t=>{this.isValidSentiment(t.sentiment)?e[t.sentiment]++:e.undefined++}),{labels:[`\u{1F61F}${this.lang.locals.negative}`,`\u{1F615}${this.lang.locals.mixed}`,`\u{1F60A}${this.lang.locals.positive}`,`\u{1F610}${this.lang.locals.neutral}`,`\u2753${this.lang.locals.unspecified}`],datasets:[{label:this.lang.locals.sentiment,data:Object.values(e),backgroundColor:[c.sentiment.negative.fill,c.sentiment.mixed.fill,c.sentiment.positive.fill,c.sentiment.neutral.fill,c.sentiment.undefined.fill],borderColor:[c.sentiment.negative.border,c.sentiment.mixed.border,c.sentiment.positive.border,c.sentiment.neutral.border,c.sentiment.undefined.border],borderWidth:2}]}}getSentimentChartConfig(){return{data:this.calculateSetimentDistribution(),type:"pie",options:this.getSentimentChartOptions()}}getSentimentChartOptions(){return ee(F({},this.getChartOptions()),{plugins:{legend:{display:!0,labels:{boxWidth:20,padding:10,font:{size:14,family:"Lusail"}},position:"top"},tooltip:ee(F({},this.getChartOptions().plugins.tooltip),{callbacks:{title:()=>this.lang.locals.sentiment,label:e=>{let t=e.label||"",r=e.dataset.data.reduce((b,Y)=>b+Y,0),a=(e.raw/r*100).toFixed(1);return[`${t}:${a}%`,`${this.lang.locals.total}:${e.raw}`]}}}),datalabels:{textAlign:"center",color:"#ffffff",font:{size:14},backgroundColor:e=>e.dataset.backgroundColor[e.dataIndex],borderColor:"#ffffff",borderRadius:8,borderWidth:1,padding:{left:10,right:10},display:e=>{let t=e.dataset.data,n=t[e.dataIndex],r=t.reduce((a,b)=>a+b,0);return n>r*.1},formatter:(e,t)=>{let r=t.dataset.data.reduce((Y,je)=>Y+je,0),a=(e/r*100).toFixed(1);return[t.chart.data.labels[t.dataIndex],`${a}%`,`${this.lang.locals.total}:${e}`]}}}})}calculateFeedbackDistribution(){let e=0,t=0,n=0;return this.conversations().forEach(r=>{this.isValidFeedback(r.feedback)?r.feedback>0?e++:t++:n++}),{labels:[this.lang.locals.feedback],datasets:[{label:this.lang.locals.like,data:[e],backgroundColor:c.feedback.like.fill,borderColor:c.feedback.like.border,borderWidth:2},{label:this.lang.locals.dislike,data:[t],backgroundColor:c.feedback.dislike.fill,borderColor:c.feedback.dislike.border,borderWidth:2},{label:this.lang.locals.unspecified,data:[n],backgroundColor:c.feedback.unspecified.fill,borderColor:c.feedback.unspecified.border,borderWidth:2}]}}getFeedbackChartConfig(){return{data:this.calculateFeedbackDistribution(),type:"bar",options:this.getChartOptions()}}calculateBotPerformance(){let e={};return this.conversations().forEach(t=>{let n=t.bot_name;e[n]||(e[n]={likes:0,dislikes:0,unspecified:0}),this.isValidFeedback(t.feedback)?t.feedback>0?e[n].likes++:e[n].dislikes++:e[n].unspecified++}),{labels:Object.keys(e),datasets:[F({label:this.lang.locals.like,data:Object.values(e).map(t=>t.likes)},this.generateBotColor(0)),F({label:this.lang.locals.dislike,data:Object.values(e).map(t=>t.dislikes)},this.generateBotColor(1)),F({label:this.lang.locals.unspecified,data:Object.values(e).map(t=>t.unspecified)},this.generateBotColor(2))]}}getBotPerformanceChartConfig(){return{data:this.calculateBotPerformance(),type:"bar",options:this.getChartOptions(!0)}}generateBotColor(e){let t=[{background:c.feedback.like.fill,border:c.feedback.like.border},{background:c.feedback.dislike.fill,border:c.feedback.dislike.border},{background:c.feedback.unspecified.fill,border:c.feedback.unspecified.border}];if(e<t.length)return{backgroundColor:t[e].background,borderColor:t[e].border,borderWidth:2};let n=[c.feedback.like.fill,c.feedback.like.border,c.feedback.dislike.fill,c.feedback.dislike.border],r=n[e%n.length],a=r.replace("rgb","rgba").replace(")",", 0.6)"),b=r.replace("rgb","rgba").replace(")",", 1)");return{backgroundColor:a,borderColor:b,borderWidth:2}}isValidFeedback(e){return e!=null&&e!==""}isValidSentiment(e){return["negative","mixed","positive","neutral"].includes(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["app-chat-history-charts"]],inputs:{conversations:[1,"conversations"]},standalone:!0,features:[I],decls:4,vars:2,consts:[[1,"flex","flex-col","gap-4","mb-4","md:flex-row"],[1,"card","bg-white","shadow-md","p-4","rounded-lg","w-full","md:w-1/3","hover:shadow-lg"],[1,"text-lg","font-bold","text-center","mb-4","text-gray-700"],["baseChart","","role","img",1,"max-h-80","w-full",3,"data","labels","type","options"]],template:function(t,n){t&1&&(o(0,"div",0),w(1,We,5,5,"div",1,H),L(3,"keyvalue"),l()),t&2&&(s(),S(E(3,0,n.charts())))},dependencies:[Ae,xe]})};var Ge=["conversationsContainer"],Ze=i=>({"!bg-gray-400/40 !rounded-md !text-gray-700":i}),Ke=(i,e,t)=>({"bg-green-100 text-green-800 border-green-400":i,"bg-red-100 text-red-800 border-red-400":e,"!bg-gray-100 !text-gray-800 !border-gray-400":t});function Ue(i,e){if(i&1){let t=T();o(0,"li",22),C("keyup.enter",function(){let r=p(t).$implicit,a=u(2);return m(a.onFilterTypeSelect(r))})("click",function(){let r=p(t).$implicit,a=u(2);return m(a.onFilterTypeSelect(r))}),d(1),l()}if(i&2){let t=e.$implicit;s(),h(" ",t.label," ")}}function qe(i,e){if(i&1&&(o(0,"div",19)(1,"ul",20),w(2,Ue,2,1,"li",21,H),l()()),i&2){let t=u();s(2),S(t.filterOptions)}}function Qe(i,e){if(i&1){let t=T();o(0,"button",23),C("click",function(){p(t);let r=u();return m(r.resetContorl())}),v(),o(1,"svg",24),f(2,"path",25),l()()}}function Xe(i,e){if(i&1){let t=T();o(0,"p",28),C("keyup",function(){let r=p(t).$implicit,a=u(2);return m(a.onSuggestionSelect(r))})("click",function(){let r=p(t).$implicit,a=u(2);return m(a.onSuggestionSelect(r))}),d(1),l()}if(i&2){let t=e.$implicit;s(),h(" ",t.label," ")}}function Je(i,e){if(i&1&&(o(0,"div",26),w(1,Xe,2,1,"p",27,H),l()),i&2){let t=u();s(),S(t.suggestions())}}function Ye(i,e){if(i&1&&d(0),i&2){let t=u(2);h(" ",t.lang.locals.like," ")}}function et(i,e){if(i&1&&d(0),i&2){let t=u(2);h(" ",t.lang.locals.dislike," ")}}function tt(i,e){if(i&1&&d(0),i&2){let t=u(2);h(" ",t.lang.locals.unspecified," ")}}function nt(i,e){if(i&1){let t=T();o(0,"li",29),C("keyup.enter",function(){let r=p(t).$implicit,a=u();return m(a.OnSelectConversation(r.conversation_id))})("click",function(){let r=p(t).$implicit,a=u();return m(a.OnSelectConversation(r.conversation_id))}),o(1,"p",30),d(2),L(3,"date"),l(),o(4,"div",31)(5,"div",32)(6,"p",33),d(7),l(),o(8,"p",34),y(9,Ye,1,1)(10,et,1,1)(11,tt,1,1),l()(),o(12,"div",35)(13,"div",36)(14,"span",37),d(15),l()()()()()}if(i&2){let t,n=e.$implicit,r=u();g("ngClass",ge(12,Ze,r.selectedConversation()===n.conversation_id)),s(2),x(Ce(3,9,n.timestamp,"short")),s(4),g("matTooltip",r.lang.locals.conversation_title),s(),h(" ",n.title," "),s(),g("matTooltip",r.lang.locals.feedback)("ngClass",fe(14,Ke,n.feedback===r.feedbackOptions.LIKE,n.feedback===r.feedbackOptions.DISLIKE,n.feedback===r.feedbackOptions.UNSPECIFIED)),s(),k((t=n.feedback)===r.feedbackOptions.LIKE?9:t===r.feedbackOptions.DISLIKE?10:11),s(3),g("matTooltip",r.lang.locals.sentiment),s(3),x(n.getEmojiPerSetiment())}}function it(i,e){if(i&1&&(o(0,"div",18),v(),o(1,"svg",38),f(2,"path",39),l(),O(),o(3,"span",40),d(4),l()()),i&2){let t=u();s(4),x(t.lang.locals.no_data_to_preview)}}var J=class i{conversationsContainer=de.required("conversationsContainer");conversations=W.required();onConversationSelect=le();lang=V(B);searchControl=new Se("",{nonNullable:!0});filterOptions=[{label:this.lang.locals.bot_name,value:"bot_name"},{label:this.lang.locals.sentiment,value:"sentiment"},{label:this.lang.locals.feedback,value:"feedback"}];showSuggestions=_(!1);selectedConversation=_(null);selectedFilter=_(this.filterOptions[0]);filterType$=new D;filterValue$=new D;filteredConversations=_([]);dropdownOpen=_(!1);feedbackOptions=He;currentSort="asc";suggestions=G(()=>this.selectedFilter().value==="feedback"?[{label:this.lang.locals.like,value:1},{label:this.lang.locals.dislike,value:-1},{label:this.lang.locals.unspecified,value:0}]:this.selectedFilter().value==="sentiment"?[{label:this.lang.locals.negative,value:"negative"},{label:this.lang.locals.positive,value:"positive"},{label:this.lang.locals.mixed,value:"mixed"},{label:this.lang.locals.neutral,value:"neutral"},{label:this.lang.locals.unspecified,value:"undefined"}]:[]);ngOnInit(){this.listenToFilter()}constructor(){ve(()=>{new Oe(this.conversationsContainer().nativeElement,{suppressScrollX:!0}),this.conversationsContainer().nativeElement.addEventListener("wheel",e=>{e.stopPropagation()}),this.conversations()&&he(()=>{this.filterType$.next("bot_name")})})}loadSuggestions(){["sentiment","feedback"].includes(this.selectedFilter().value)&&this.showSuggestions.set(!0)}onFilterTypeSelect(e){this.resetContorl(),this.selectedFilter.set(e),this.dropdownOpen.set(!1),this.filterValue$.next(""),this.filterType$.next(e.value)}onSuggestionSelect(e){this.filterValue$.next(e.value),this.searchControl.setValue(e.label,{emitEvent:!1}),this.showSuggestions.set(!1)}listenToFilter(){let e=this.searchControl.valueChanges;ie([e.pipe(j(""),re(400),oe()),this.filterType$.pipe(j(this.selectedFilter().value)),this.filterValue$.pipe(j(""))]).pipe(ne(([t,n,r])=>n!=="bot_name"&&r===""?this.conversations():this.conversations().filter(a=>{let b=a.bot_name?.toLowerCase().includes((t||"").toLowerCase());return n==="bot_name"?b:n==="sentiment"&&typeof r=="string"?a.sentiment?.toLowerCase()===r.toLowerCase():n==="feedback"?a.feedback===r:!0})),$(t=>{this.filteredConversations.set(t),this.resetScrollToTop()})).subscribe()}resetScrollToTop(){let e=this.conversationsContainer().nativeElement;e&&(e.scrollTop=0)}OnSelectConversation(e){this.selectedConversation.set(e),this.onConversationSelect.emit(e)}resetContorl(){this.searchControl.reset(""),this.filterValue$.next(""),this.filterType$.next(this.selectedFilter().value)}sort(){this.currentSort=this.currentSort==="asc"?"desc":"asc";let e=this.filteredConversations().sort((t,n)=>{let r=new Date(t.timestamp).getTime(),a=new Date(n.timestamp).getTime();return this.currentSort==="asc"?r-a:a-r});this.filteredConversations.set(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=M({type:i,selectors:[["app-conversation-list"]],viewQuery:function(t,n){t&1&&me(n.conversationsContainer,Ge,5),t&2&&ue()},inputs:{conversations:[1,"conversations"]},outputs:{onConversationSelect:"onConversationSelect"},standalone:!0,features:[I],decls:22,vars:12,consts:[["conversationsContainer",""],["trigger","cdkOverlayOrigin"],["suggestionTrigger","cdkOverlayOrigin"],[1,"w-full","h-full","border-l","border-gray-400","bg-gray-200","text-gray-700","rounded-md","overflow-hidden","relative"],[1,"flex","max-w-lg","mx-auto","items-center","bg-gray-200","sticky","rounded-t-md","top-0","z-10","p-3","rtl:flex-row-reverse","border-b","border-b-gray-300"],["cdkOverlayOrigin","",1,"relative","flex-shrink-0","z-10","inline-flex","items-center","py-2.5","px-8","text-sm","font-medium","text-center","text-white","bg-primary","border","border-gray-300","rtl:rounded-e-lg","ltr:rounded-s-lg","focus:ring-4","focus:outline-none","focus:ring-gray-400",3,"click"],[1,"absolute","left-0","m-1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-current"],["d","M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen"],[1,"relative","w-full"],["cdkOverlayOrigin","","type","text",1,"w-full","block","p-2.5","z-20","text-sm","text-gray-900","bg-gray-50","rtl:rounded-s-lg","ltr:rounded-e-lg","rtl:border-e-gray-50","ltr:border-s-gray-50","rtl:border-e-2","ltr:border-s-2","border","border-gray-300","focus:ring-primary","focus:border-primary","outline-0",3,"focus","readOnly","placeholder","formControl"],[1,"absolute","left-0","top-0","m-3","bg-transparent","outline-none"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayWidth"],["tabindex","2","type","button",1,"bg-transparent","mx-2","outline-none",3,"click","keyup.enter","matTooltip"],["d","M18 21L14 17H17V7H14L18 3L22 7H19V17H22M2 19V17H12V19M2 13V11H9V13M2 7V5H6V7H2Z"],[1,"max-w-md"],["tabindex","1",1,"pb-3","pt-2","sm:pb-4","sm:pt-4","px-4","m-1","cursor-pointer","hover:bg-gray-400/20","hover:rounded-md","hover:text-gray-700",3,"ngClass"],[1,"flex","flex-col","justify-center","items-center","gap-4","mt-4"],[1,"absolute","ltr:left-0","rtl:right-0","z-10","w-40","mt-2","bg-white","border","border-gray-300","rounded-md","shadow-lg"],[1,"py-1"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer",3,"keyup.enter","click"],[1,"absolute","left-0","top-0","m-3","bg-transparent","outline-none",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-4","fill-current"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],[1,"w-full","ltr:left-0","rtl:right-0","z-10","mt-2","bg-white","border","border-gray-300","rounded-md","shadow-lg"],["tabindex","1",1,"cursor-pointer","p-2","hover:bg-gray-200","hover:rounded-sm"],["tabindex","1",1,"cursor-pointer","p-2","hover:bg-gray-200","hover:rounded-sm",3,"keyup","click"],["tabindex","1",1,"pb-3","pt-2","sm:pb-4","sm:pt-4","px-4","m-1","cursor-pointer","hover:bg-gray-400/20","hover:rounded-md","hover:text-gray-700",3,"keyup.enter","click","ngClass"],[1,"text-gray-700/60","text-xs"],[1,"flex","items-center","space-x-4","rtl:space-x-reverse"],[1,"flex-1","min-w-0"],[1,"text-base","font-medium","text-gray-700","truncate","uppercase",3,"matTooltip"],[1,"w-fit","text-xs","font-medium","me-2","px-1","py-[0.0625rem]","rounded","border",3,"matTooltip","ngClass"],[1,"flex-shrink-0",3,"matTooltip"],[1,"flex","justify-center","items-center","border-dashed","border-gray-700","border","size-8","rounded-full","bg-gray-100","p-2","m-1"],[1,"text-xl","leading-[normal]"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-12","fill-current"],["d","M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8M10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5M12,14C13.75,14 15.29,14.72 16.19,15.81L14.77,17.23C14.32,16.5 13.25,16 12,16C10.75,16 9.68,16.5 9.23,17.23L7.81,15.81C8.71,14.72 10.25,14 12,14Z"],[1,"text-center","text-gray-700","text-lg"]],template:function(t,n){if(t&1){let r=T();o(0,"div",3,0)(2,"div",4)(3,"button",5,1),C("click",function(){return p(r),m(n.dropdownOpen.set(!n.dropdownOpen()))}),d(5),o(6,"span",6),v(),o(7,"svg",7),f(8,"path",8),l()()(),y(9,qe,4,0,"ng-template",9),C("overlayOutsideClick",function(){return p(r),m(n.dropdownOpen.set(!1))}),O(),o(10,"div",10)(11,"input",11,2),C("focus",function(){return p(r),m(n.loadSuggestions())}),l(),y(13,Qe,3,0,"button",12)(14,Je,3,0,"ng-template",13),C("overlayOutsideClick",function(){return p(r),m(n.showSuggestions.set(!1))}),l(),o(15,"button",14),C("click",function(){return p(r),m(n.sort())})("keyup.enter",function(){return p(r),m(n.sort())}),v(),o(16,"svg",7),f(17,"path",15),l()()(),O(),o(18,"ul",16),w(19,nt,16,18,"li",17,R,!1,it,5,1,"div",18),l()()}if(t&2){let r=P(4),a=P(12);s(5),h(" ",n.selectedFilter().label||n.lang.locals.select_filter," "),s(4),g("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",n.dropdownOpen()),s(2),g("readOnly",n.selectedFilter().value!=="bot_name")("placeholder",n.lang.locals.search_about+" "+(n.selectedFilter().label||n.lang.locals.bot_name+","+n.lang.locals.feedback+","+n.lang.locals.sentiment)+"...")("formControl",n.searchControl),s(2),k(n.searchControl.value?13:-1),s(),g("cdkConnectedOverlayOrigin",a)("cdkConnectedOverlayOpen",n.showSuggestions())("cdkConnectedOverlayWidth",a.elementRef.nativeElement.offsetWidth),s(),g("matTooltip",n.lang.locals.sort_conversation),s(4),S(n.filteredConversations())}},dependencies:[be,Z,ke,we,Te,q,U,K,Q,ye]})};function rt(i,e){if(i&1){let t=T();o(0,"li",27),C("click",function(){let r=p(t).$implicit,a=u(2);return m(a.onBotSelect(r))})("keyup.enter",function(){let r=p(t).$implicit,a=u(2);return m(a.onBotSelect(r))}),d(1),l()}if(i&2){let t=e.$implicit;s(),h(" ",t," ")}}function ot(i,e){if(i&1&&(o(0,"div",24)(1,"ul",25),w(2,rt,2,1,"li",26,H),l()()),i&2){let t=u();s(2),S(t.botNames())}}function at(i,e){i&1&&(o(0,"div",9)(1,"div",28),v(),o(2,"svg",29),f(3,"path",30)(4,"path",31),l(),O(),o(5,"span",32),d(6,"Loading..."),l()()())}function st(i,e){i&1&&(v(),o(0,"svg",14),f(1,"path",33),l())}function lt(i,e){i&1&&(v(),o(0,"svg",15),f(1,"path",34),l())}function ct(i,e){i&1&&(v(),o(0,"svg",16),f(1,"path",30)(2,"path",31),l())}function dt(i,e){i&1&&(v(),o(0,"svg",15),f(1,"path",35),l())}function pt(i,e){i&1&&(o(0,"div",21)(1,"div",9)(2,"div",28),v(),o(3,"svg",29),f(4,"path",30)(5,"path",31),l(),O(),o(6,"span",32),d(7,"Loading..."),l()()()())}function mt(i,e){if(i&1&&(o(0,"div",36)(1,"p"),d(2),l()()),i&2){let t=u().$implicit;s(2),x(t.content)}}function ut(i,e){if(i&1&&(o(0,"div",37),f(1,"span",39),l()),i&2){let t=u().$implicit;s(),g("innerHTML",t.content,ce)}}function gt(i,e){if(i&1&&(o(0,"div",38)(1,"p"),d(2),l()()),i&2){let t=u().$implicit;s(2),x(t.content)}}function ft(i,e){if(i&1&&y(0,mt,3,1,"div",36)(1,ut,2,1,"div",37)(2,gt,3,1,"div",38),i&2){let t=e.$implicit;k(t.isUser()?0:t.isAssistant()?1:2)}}function Ct(i,e){if(i&1&&(o(0,"div",23)(1,"p",40),d(2),l(),f(3,"img",41),l()),i&2){let t=u();s(2),x(t.lang.locals.choose_conversation)}}var ze=class i extends Le(class{}){chatHistoryService=V(Ve);lang=V(B);conversations=_([]);chats=_([]);loaderChat$=new z(!1);loaderSentiment$=new z(!1);conversationLoader$=new z(!1);loadConversation$=new D;botNames=_([this.lang.locals.all_bots]);showBotDp=_(!1);selectedBot=_(this.botNames()[0]);ngOnInit(){this.loadConversations(),this.loadConversation$.next(void 0),this.getBotNames()}loadChat(e){this.loaderChat$.next(!0),this.chatHistoryService.getChatByConversationId(e).pipe(A(this.destroy$),te(()=>this.loaderChat$.next(!1))).subscribe(t=>{this.chats.set(t)})}loadConversations(){this.loadConversation$.pipe($(()=>{this.conversationLoader$.next(!0)}),ae(e=>this.chatHistoryService.getAllConversations(e)),$(()=>{this.conversationLoader$.next(!1)}),A(this.destroy$)).subscribe(e=>{this.conversations.set(e)})}sentimentAnalyis(){this.loaderSentiment$.next(!0),this.chatHistoryService.applyAnalysis().pipe(A(this.destroy$),$(()=>this.loadConversation$.next(this.selectedBot()===this.lang.locals.all_bots?void 0:this.selectedBot())),te(()=>this.loaderSentiment$.next(!1))).subscribe()}getBotNames(){return this.chatHistoryService.getAllBotNames().pipe(A(this.destroy$)).subscribe(e=>this.botNames.set([...this.botNames(),...e]))}onBotSelect(e){this.selectedBot.set(e),this.showBotDp.set(!1),this.loadConversation$.next(e===this.lang.locals.all_bots?void 0:e)}reloadConversations(){this.loadConversation$.next(this.selectedBot()===this.lang.locals.all_bots?void 0:this.selectedBot())}static \u0275fac=(()=>{let e;return function(n){return(e||(e=se(i)))(n||i)}})();static \u0275cmp=M({type:i,selectors:[["app-chat-history"]],standalone:!0,features:[pe,I],decls:43,vars:25,consts:[["botNameTrigger","cdkOverlayOrigin"],[1,"flex","items-center","gap-4"],[1,"relative","flex","flex-col","w-1/4"],[1,"text-gray-50","text-lg"],["type","button","cdkOverlayOrigin","",1,"relative","bg-gray-50","w-full","text-lg","text-gray-700","rounded-md","p-2.5","mb-4",3,"click"],[1,"absolute","left-0","m-1"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-current"],["d","M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"],["cdkConnectedOverlay","",3,"overlayOutsideClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayWidth"],[1,"loader","flex","items-center","justify-center"],[3,"conversations"],["multi",""],[1,"text-gray-400"],["type","button","tabindex","1",1,"inline-flex","gap-4","items-center","text-white","bg-primary","focus:ring-4","focus:ring-gray-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","me-2","mb-2",3,"click","keyup.enter","matTooltip"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 50",1,"w-16","h-6"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-6","fill-white"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"size-6","text-gray-200","animate-spin","fill-primary"],[1,"flex","flex-col","lg:flex-row","bg-gray-100","rounded-md","shadow-md","h-[calc(100vh_-_18rem)]"],[1,"w-full","lg:w-4/12","p-4","lg:p-0","flex-shrink-0","overflow-auto","h-1/2","lg:h-full"],[3,"onConversationSelect","conversations"],[1,"w-full","lg:w-8/12","overflow-auto","relative","flex-auto","h-1/2","lg:h-full"],[1,"absolute","inset-0","flex","items-center","justify-center","backdrop-blur-sm","bg-white","bg-opacity-50","z-10","h-100vh"],[1,"flex-auto","overflow-hidden","flex","flex-col","relative","min-h-0","p-4"],[1,"flex","justify-center","items-center"],[1,"absolute","w-full","ltr:left-0","rtl:right-0","z-10","mt-2","text-lg","bg-white","border","border-gray-300","rounded-md","shadow-lg"],[1,"py-1"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer"],["tabindex","1",1,"px-4","py-2","text-base","text-gray-700","hover:bg-gray-200","cursor-pointer",3,"click","keyup.enter"],["role","status"],["aria-hidden","true","viewBox","0 0 100 101","fill","none","xmlns","http://www.w3.org/2000/svg",1,"inline","w-8","h-8","text-gray-200","animate-spin","fill-primary"],["d","M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z","fill","currentColor"],["d","M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z","fill","currentFill"],[1,"sr-only"],["fill","none","stroke","currentColor","stroke-width","2","d","M0 25 L20 25 L30 10 L40 40 L50 25 L70 25 L80 5 L90 45 L100 25 L200 25",1,"animate-heartbeat"],["d","M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"],["d","M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16H19.1L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z"],[1,"user-message","chat-message","ltr:self-end","min-w-[min(400px,100%)]","rtl:self-start","rtl:!rounded-tr-none","ltr:!rounded-tr-none"],[1,"assistant-message","chat-message","whitespace-break-spaces","ltr:self-start","min-w-[min(400px,100%)]","rtl:self-end","rtl:!rounded-tl-none","ltr:!rounded-tr-none"],[1,"system-message","chat-message"],["appSecureUrl","",3,"innerHTML"],[1,"text-gray-700","text-xl","mt-10"],["src","assets/images/select.svg","alt","select",1,"w-1/4","h-1/4"]],template:function(t,n){if(t&1){let r=T();o(0,"div",1)(1,"div",2)(2,"span",3),d(3),l(),o(4,"button",4,0),C("click",function(){return p(r),m(n.showBotDp.set(!0))}),d(6),o(7,"span",5),v(),o(8,"svg",6),f(9,"path",7),l()()(),y(10,ot,4,0,"ng-template",8),C("overlayOutsideClick",function(){return p(r),m(n.showBotDp.set(!1))}),l(),y(11,at,7,0,"div",9),L(12,"async"),l(),O(),f(13,"app-chat-history-charts",10),o(14,"mat-accordion",11)(15,"mat-expansion-panel")(16,"mat-expansion-panel-header")(17,"mat-panel-title"),d(18),l(),o(19,"mat-panel-description")(20,"p",12),d(21),l()()(),o(22,"button",13),C("click",function(){return p(r),m(n.sentimentAnalyis())})("keyup.enter",function(){return p(r),m(n.sentimentAnalyis())}),N(23),L(24,"async"),y(25,st,2,0,":svg:svg",14)(26,lt,2,0,":svg:svg",15),d(27),l(),o(28,"button",13),C("click",function(){return p(r),m(n.reloadConversations())})("keyup.enter",function(){return p(r),m(n.reloadConversations())}),N(29),L(30,"async"),y(31,ct,3,0,":svg:svg",16)(32,dt,2,0,":svg:svg",15),l(),o(33,"div",17)(34,"div",18)(35,"app-conversation-list",19),C("onConversationSelect",function(b){return p(r),m(n.loadChat(b))}),l()(),o(36,"div",20),y(37,pt,8,0,"div",21),L(38,"async"),o(39,"div",22),w(40,ft,3,1,null,null,R),y(42,Ct,4,1,"div",23),l()()()()()}if(t&2){let r=P(5);s(3),h("",n.lang.locals.choose_bot,":"),s(3),h(" ",n.selectedBot()," "),s(4),g("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",n.showBotDp())("cdkConnectedOverlayWidth",r.elementRef.nativeElement.offsetWidth),s(),k(E(12,17,n.conversationLoader$)?11:-1),s(2),g("conversations",n.conversations()),s(5),x(n.lang.locals.conversations_and_chats),s(3),h(" ",n.lang.locals.conversation_description," "),s(),g("matTooltip",n.lang.locals.sentiment_analysis_description);let a=E(24,19,n.loaderSentiment$);s(3),k(a?25:26),s(2),h(" ",n.lang.locals.sentiment_chart," "),s(),g("matTooltip",n.lang.locals.reload_conversation);let b=E(30,21,n.conversationLoader$);s(3),k(b?31:32),s(4),g("conversations",n.conversations()),s(2),k(E(38,23,n.loaderChat$)?37:-1),s(3),S(n.chats()),s(2),k(n.chats().length?-1:42)}},dependencies:[De,Be,Fe,$e,Ie,Me,_e,Z,q,U,K,X,J,Q,Ee],styles:["@keyframes _ngcontent-%COMP%_heartbeat{0%{stroke-dasharray:200;stroke-dashoffset:200}50%{stroke-dasharray:200;stroke-dashoffset:0}to{stroke-dasharray:200;stroke-dashoffset:200}}.animate-heartbeat[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_heartbeat 2s infinite ease-in-out;stroke-linecap:round}"]})};export{ze as ChatHistoryComponent};
