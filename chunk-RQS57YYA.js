import{a as De}from"./chunk-KHOFVO4S.js";import{a as Oe,b as Ue,c as je}from"./chunk-HHPITOA4.js";import{a as Ie}from"./chunk-QZPNBOA6.js";import{a as Te}from"./chunk-KQIHERE2.js";import{a as W}from"./chunk-GPJGLLXF.js";import{a as Me}from"./chunk-FTP5OKF7.js";import{c as le}from"./chunk-5BZPFUY4.js";import"./chunk-J2HB2Y4E.js";import{b as we}from"./chunk-YTSP6BWB.js";import{a as pe}from"./chunk-ZX4VXR5W.js";import{a as Fe}from"./chunk-GNG7ILZA.js";import{a as xe,b as be,c as ye}from"./chunk-3NBMALXY.js";import{a as Pe}from"./chunk-SIWWJH65.js";import"./chunk-2IE76L77.js";import{b as Le}from"./chunk-B26V2M5L.js";import{a as Re}from"./chunk-IHHLN3IB.js";import{a as He}from"./chunk-73NYINMC.js";import"./chunk-FWDT53KA.js";import{a as Ve}from"./chunk-XIYR6XWG.js";import"./chunk-QW4DZL5W.js";import"./chunk-2LKYGCHS.js";import"./chunk-X5CIYX27.js";import"./chunk-6IGLDT6K.js";import{a as ze}from"./chunk-2N4EDZNV.js";import"./chunk-ANBYP55K.js";import{b as ke}from"./chunk-EARLHVX5.js";import{b as me,g as ge}from"./chunk-SSNXJZ43.js";import{b as Ae,c as Ee}from"./chunk-WLQKWWON.js";import{$ as ue,F as ce,T as de,ea as he,fa as ve,ia as fe,ma as Se,pa as _e,ua as Ce,xa as R}from"./chunk-MFSWGIIO.js";import"./chunk-OK5S6IU3.js";import{b as E}from"./chunk-DYBLNUKQ.js";import"./chunk-PXW4CVT7.js";import{$b as N,Ac as f,Bc as C,Db as k,Eb as x,Ha as h,Hd as se,Ia as v,Ja as z,Ka as U,Kc as ee,Lc as A,Na as Z,Nc as H,Ob as y,Oc as te,P as F,Pc as $,Qc as ie,Sb as s,Sc as ne,T as O,V as G,Wb as J,Xb as S,Yb as K,Z as Y,_b as q,ac as o,bc as a,cc as d,f as Qe,fd as re,gc as T,hd as oe,jc as u,ka as D,lb as j,lc as g,mb as w,sb as r,ta as m,vd as ae,w as P,wc as b,xa as M,xc as X,y as V,yc as Q,zc as c}from"./chunk-O6QGGAL6.js";var I=class n{lang=m(E);fb=m(Ce);dialogRef=m(xe);data=m(be);form=this.fb.group({bgImgUrl:"",size:"Cropped-Portrait"});ngOnInit(){this.form.setValue(this.data)}save(){this.dialogRef.close(this.form.value)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-ms-avatar-settings-popup"]],standalone:!0,features:[A],decls:23,vars:6,consts:[[1,"flex","flex-col","overflow-hidden","dialog-container","min-w-[400px]"],[1,"bg-primary","text-white","text-xl","p-4"],[1,"p-4","flex","flex-col","flex-auto",3,"formGroup"],[1,"w-full"],["formControlName","bgImgUrl","type","text","matInput",""],["appearance","outline",1,"w-full"],["formControlName","size"],["value","Square"],["value","Portrait"],["value","Cropped-Portrait"],["value","Landscape"],[1,"p-4"],["mat-raised-button","",1,"primary",3,"click","disabled"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1),c(2),a(),o(3,"div",2)(4,"mat-form-field",3)(5,"mat-label"),c(6),a(),d(7,"input",4),a(),o(8,"mat-form-field",5)(9,"mat-label"),c(10),a(),o(11,"mat-select",6)(12,"mat-option",7),c(13,"Square"),a(),o(14,"mat-option",8),c(15,"Portrait"),a(),o(16,"mat-option",9),c(17,"Cropped-Portrait"),a(),o(18,"mat-option",10),c(19,"Landscape"),a()()()(),o(20,"div",11)(21,"button",12),u("click",function(){return t.save()}),c(22),a()()()),e&2&&(r(2),f(t.lang.locals.settings),r(),s("formGroup",t.form),r(3),f(t.lang.locals.background_url),r(4),f(t.lang.locals.shape),r(11),s("disabled",t.form.invalid),r(),C(" ",t.lang.locals.save," "))},dependencies:[pe,me,ge,we,Re,de,R,ue,he,ve,Se,_e]})};var p=Qe(He());var Be=["baseElement"],Ge=["container"],Ye=["video"],Ze=["audio"],Je=["idleVideo"],Ke=["waves"],Xe=(n,i)=>i.id,et=n=>({"-start-10 opacity-100":n}),qe=(n,i,e)=>({"bg-red-600":n,"bg-green-700":i,"bg-orange-500":e}),tt=n=>({hidden:n}),it=(n,i)=>({"mdi-chevron-down":n,"mdi-chevron-up":i});function nt(n,i){if(n&1&&(o(0,"span",9),c(1),a()),n&2){let e=g();r(),f(e.recognizedText())}}function rt(n,i){if(n&1&&d(0,"app-spinner-loader",12),n&2){let e=g();s("color",e.appColors.PRIMARY)("borderWidth",2)("width",20)}}function ot(n,i){if(n&1&&(d(0,"img",22),c(1)),n&2){let e=g();s("src",e.store.isStreamStarted()?"assets/icons/stop.png":"assets/icons/start.png",w),r(),C(" ",e.store.isStreamStarted()?e.lang.locals.stop:e.lang.locals.start," ")}}function at(n,i){if(n&1&&(d(0,"app-spinner-loader",12),o(1,"span"),c(2),a()),n&2){let e=g();s("color",e.appColors.PRIMARY)("borderWidth",2)("width",20),r(2),f(e.lang.locals.loading)}}function st(n,i){if(n&1&&(d(0,"img",22),o(1,"span"),c(2),a()),n&2){let e=g();s("src","assets/icons/speak.png",w),r(2),f(e.lang.locals.click_to_speak)}}function lt(n,i){if(n&1&&(d(0,"img",22),o(1,"span"),c(2),a()),n&2){let e=g();s("src","assets/icons/speak.png",w),r(2),f(e.lang.locals.listening_ongoing)}}function ct(n,i){if(n&1&&(d(0,"div",41),ie(1,"sanitizer"),o(2,"span"),c(3),a()),n&2){let e=g();s("innerHTML",ne(1,2,e.svgIcons.SEND,"html"),j),r(3),f(e.lang.locals.click_to_send)}}function dt(n,i){if(n&1){let e=T();o(0,"div",44),u("animating",function(l){h(e);let _=g(2);return v(_.animationStatus.set(l))}),a()}if(n&2){let e=g().$implicit;s("text",e.content)}}function pt(n,i){if(n&1&&d(0,"div",43),n&2){let e=g().$implicit;s("innerHtml",e.content,j)}}function mt(n,i){if(n&1&&(o(0,"div",49)(1,"div",50)(2,"small",51),c(3),d(4,"i",52),a()(),o(5,"a",53),c(6),a()()),n&2){let e=i.$implicit,t=i.$index;r(3),C(" doc ",t+1," "),r(3),f(e.filepath)}}function gt(n,i){if(n&1){let e=T();o(0,"div")(1,"div",45),u("click",function(){h(e);let l=Q(6);return v(l.hidden=!l.hidden)}),d(2,"i",46),o(3,"span",47),c(4,"References"),a()(),o(5,"div",48,6),q(7,mt,7,2,"div",49,K),a()()}if(n&2){let e=Q(6),t=g().$implicit;r(2),s("ngClass",te(1,it,e.hidden,!e.hidden)),r(5),N(t.context.citations)}}function ut(n,i){if(n&1&&(o(0,"div"),y(1,dt,1,1,"div",42)(2,pt,1,1,"div",43)(3,gt,9,4,"div"),a()),n&2){let e=i.$implicit;J("message ",e.role,""),r(),S(e.role==="assistant"?1:2),r(2),S(e.context&&e.context.citations.length?3:-1)}}function ht(n,i){if(n&1){let e=T();o(0,"div",54),u("click",function(){h(e);let l=g();return v(l.qrCodeOpened=!1)}),o(1,"div",55),u("click",function(l){return h(e),v(l.stopPropagation())}),d(2,"qrcode",56),o(3,"span",57),c(4),a(),o(5,"button",58),u("click",function(){h(e);let l=g();return v(l.qrCodeOpened=!1)}),z(),o(6,"svg",59),d(7,"path",16),a()()()()}if(n&2){let e=g();r(2),s("qrdata",e.getQRData()),r(2),C("streamId: ",e.store.streamId(),"")}}var B=class n{baseElement=x.required("baseElement");chatContainer=x.required("container");video=x.required("video");audio=x.required("audio");idleVideo=x("idleVideo");waves=x.required("waves");store=m(ke);lang=m(E);speechService=m(ze);avatarService=m(Le);chatService=m(W);chatHistoryService=m(Ve);injector=m(Z);dialog=m(ye);router=m(le);videoFormat;avatarConfig;recognizer;avatarSynthesizer;peerConnection;recognizedText=k("");recognizingText=k("");recognizingStatus=k(!1);isSpeaking=!1;spokenTextQueue=[];personalVoiceSpeakerProfileID=new fe("");settingsOpened=!1;onlineStatus=re(()=>{switch(this.lang.localChange(),this.store.streamingStatus()){case"Started":return this.lang.locals.connected;case"InProgress":return this.lang.locals.connecting;case"Disconnecting":return this.lang.locals.disconnecting;default:return this.lang.locals.not_connected}});settings={bgImgUrl:"",size:"Cropped-Portrait"};sizesMap={Square:{width:700,height:700},Portrait:{width:600,height:1e3},"Cropped-Portrait":{width:400,height:700},Landscape:{width:1920,height:1080}};svgIcons=Te;appColors=Oe;animationStatus=k(!1);qrCodeOpened=!1;ngAfterViewInit(){this.chatHistoryService.getAllBotNames().pipe(D(i=>this.chatService.botNameCtrl.patchValue(i[0]))).subscribe(),this.start(),this._initWaveSurfer()}start(){this._prepareRecorder(),this._prepareAvatar(),this._initWebRTC()}stop(){if(this.avatarSynthesizer&&!this.store.isStreamLoading()&&(this.store.updateStreamStatus("Disconnecting"),P(this.avatarSynthesizer.close()).pipe(O(1),Y(()=>{this.store.updateStreamStatus("Stopped"),this.avatarSynthesizer=void 0})).subscribe()),this.recognizer&&!this.store.isRecordingLoading()){this.store.recordingInProgress(),this.recognizer.stopContinuousRecognitionAsync(()=>this.recognizer.close(()=>i(),()=>i()),()=>this.recognizer.close(()=>i(),()=>i()));let i=()=>{this.store.recordingStopped(),this.recognizer=void 0}}}_prepareRecorder(){this.recognizer=p.SpeechRecognizer.FromConfig(p.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region()),p.AutoDetectSourceLanguageConfig.fromLanguages(["ar-QA","en-US"]),p.AudioConfig.fromDefaultMicrophoneInput()),this.recognizer.recognizing=(i,e)=>{e.result.reason===p.ResultReason.RecognizingSpeech&&(this.recognizingText.set(this.recognizedText()+" "+e.result.text),this.recognizingStatus.set(!0))},this.recognizer.recognized=(i,e)=>{e.result.reason===p.ResultReason.RecognizedSpeech&&this.store.isRecordingStarted()&&(this.recognizedText.update(t=>t+" "+e.result.text),this.recognizingStatus.set(!1))},this.recognizer.canceled=()=>{this.store.recordingInProgress(),this.speechService.generateSpeechToken().subscribe(()=>{this._prepareRecorder(),this.startRecording()})}}_prepareAvatar(){this.videoFormat=new p.AvatarVideoFormat;let i=this.sizesMap[this.settings.size].width,e=this.sizesMap[this.settings.size].height,t=(i?Math.ceil((1920-i)/2):0)+20,l=i?Math.min(1920,Math.ceil(1920-(1920-i)/2)+20):1920,_=0,Ne=e?Math.ceil(e):1080;this.videoFormat.setCropRange(new p.Coordinate(t,_),new p.Coordinate(l,Ne)),this.avatarConfig=new p.AvatarConfig("ebla","fb-avatar-01",this.videoFormat),this.avatarConfig.customized=!0,this.settings?.bgImgUrl&&(this.avatarConfig.backgroundImage=this.settings.bgImgUrl);let L=p.SpeechConfig.fromAuthorizationToken(this.store.speechToken.token(),this.store.speechToken.region());L.endpointId="",L.setProperty(p.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous"),this.avatarSynthesizer=new p.AvatarSynthesizer(L,this.avatarConfig),this.avatarSynthesizer.avatarEventReceived=function(){}}_initWebRTC(){this.store.updateStreamStatus("InProgress"),this.avatarService.getMSICEServerInfo().pipe(F(i=>(this.store.updateStreamStatus("Stopped"),V(()=>i)))).subscribe(i=>{this.peerConnection=new RTCPeerConnection({iceServers:[{urls:[i.Urls[0]],username:i.Username,credential:i.Password}]}),this.peerConnection.onicegatheringstatechange=e=>{e.target.iceGatheringState=="complete"&&(this.video().nativeElement.paused&&this.video().nativeElement.play().then(),this.audio().nativeElement.paused&&this.audio().nativeElement.play().then(),this.store.updateStreamStatus("Started"))},this.peerConnection.ontrack=e=>{e.track.kind==="video"&&(this.video().nativeElement.srcObject=e.streams[0]),e.track.kind==="audio"&&(this.audio().nativeElement.srcObject=e.streams[0])},this.peerConnection.oniceconnectionstatechange=e=>{if(!this.store.isStreamLoading()){let t=e.target.iceConnectionState;t==="connected"&&this.store.updateStreamStatus("Started"),t==="disconnected"&&this.store.updateStreamStatus("Stopped")}},this.peerConnection.addTransceiver("video",{direction:"sendrecv"}),this.peerConnection.addTransceiver("audio",{direction:"sendrecv"}),P(this.avatarSynthesizer.startAvatarAsync(this.peerConnection)).pipe(O(1),D(()=>this.store.updateStreamStatus("Started")),F(e=>(this.store.updateStreamStatus("Stopped"),V(()=>e)))).subscribe()})}_initWaveSurfer(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(i=>{new Ue({waveColor:"white",progressColor:"white",container:this.waves().nativeElement,height:"auto"}).registerPlugin(je.create({scrollingWaveform:!1})).renderMicStream(i)})}toggleStream(){this.store.isStreamLoading()||(this.store.isStreamStopped()?this.start():this.stop())}startRecording(){this.store.recordingInProgress(),this.recognizer?.startContinuousRecognitionAsync(()=>{(this.recognizer?.internalData).privConnectionPromise.__zone_symbol__state===!0&&this.store.recordingStarted(),this.recognizingStatus.set(!0)},()=>this.store.recordingStopped())}stopRecording(){this.recognizer?.stopContinuousRecognitionAsync(()=>{this.store.recordingStopped()})}toggleRecording(){this.store.isRecordingLoading()||(this.store.isRecordingStarted()?this.acceptText():this.startRecording())}acceptText(){if(!this.recognizedText())return;let i=this.recognizedText();this.recognizedText.set(""),this.recognizingText.set(""),this.recognizingStatus.set(!1),this.stopRecording(),this._goToEndOfChat(),this.chatService.sendMessage(i,this.chatService.botNameCtrl.value).pipe(G(200)).subscribe(e=>{this.speak(e.message.content);let t=this.chatContainer().nativeElement.querySelectorAll(".assistant"),l=oe(()=>{this.animationStatus()||(t[t.length-1].scrollIntoView({behavior:"smooth"}),l.destroy())},{injector:this.injector})})}rejectText(){this.recognizingText.set(""),this.recognizedText.set(""),this.recognizingStatus.set(!1),this.stopRecording()}clearChat(){this.chatService.messages.set([])}speak(i,e=0){if(this.isSpeaking){this.spokenTextQueue.push(this._cleanText(i));return}this.speakNext(this._cleanText(i),e)}speakNext(i,e=0){let t="ar-SA-HamedNeural",l=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis'
    xmlns:mstts='http://www.w3.org/2001/mstts' xml:lang='en-US'><voice name='${t}'
    ><mstts:ttsembedding speakerProfileId='${this.personalVoiceSpeakerProfileID.value}'>
    <mstts:leadingsilence-exact value='0'/>${this._htmlEncode(i)}</mstts:ttsembedding></voice></speak>`;e>0&&(l=`<speak version='1.0'
      xmlns='http://www.w3.org/2001/10/synthesis'
      xmlns:mstts='http://www.w3.org/2001/mstts' xml:lang='en-US'
      ><voice name='${t}'><mstts:ttsembedding speakerProfileId='${this.personalVoiceSpeakerProfileID.value}'>
      <mstts:leadingsilence-exact value='0'/>${this._htmlEncode(i)}<break time='${e}ms' /></mstts:ttsembedding></voice></speak>`),this.isSpeaking=!0,this.avatarSynthesizer?.speakSsmlAsync(l).then(()=>{this.spokenTextQueue.length>0?this.speakNext(this.spokenTextQueue.shift()):this.isSpeaking=!1}).catch(()=>{this.spokenTextQueue.length>0?this.speakNext(this.spokenTextQueue.shift()):this.isSpeaking=!1})}interruptAvatar(){this.spokenTextQueue=[],this.avatarSynthesizer?.stopSpeakingAsync().then(()=>this.isSpeaking=!1)}toggleSettings(){this.settingsOpened=!this.settingsOpened}openSettingsPopup(){this.dialog.open(I,{data:this.settings}).afterClosed().subscribe(i=>{i&&(this.settings=i,this._prepareAvatar(),this._initWebRTC())})}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen().then():this.baseElement().nativeElement.requestFullscreen().then()}getQRData(){return`${this.getOrigin()}/control?streamId=${this.store.streamId()}`}getOrigin(){let i=location.href.lastIndexOf(this.router.url);return location.href.slice(0,i)}_goToEndOfChat(){setTimeout(()=>{let i=this.chatContainer().nativeElement.querySelectorAll(".user");i[i.length-1].scrollIntoView({behavior:"smooth"})},100)}_htmlEncode(i){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(i).replace(/[&<>"'/]/g,t=>e[t])}_cleanText(i){return i=i.replace(/<[^>]*>|\[doc\d+\]|<pre[^>]*>.*?<\/pre>|doc\d+|###|\*/g,""),i}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-ms-avatar"]],viewQuery:function(e,t){e&1&&(b(t.baseElement,Be,5),b(t.chatContainer,Ge,5),b(t.video,Ye,5),b(t.audio,Ze,5),b(t.idleVideo,Je,5),b(t.waves,Ke,5)),e&2&&X(6)},standalone:!0,features:[ee([W]),A],decls:51,vars:38,consts:[["baseElement",""],["waves",""],["video",""],["idleVideo",""],["audio",""],["container",""],["linkRef",""],[1,"relative","h-full","w-full","flex","items-center","justify-center","bg-secondary-100/80","rounded-xl","shadow"],[1,"flex","flex-col","items-center","h-full","justify-center","absolute"],[1,"absolute","w-[90%]","z-10","bottom-1/2","left-1/2","-translate-x-1/2","bg-black/70","text-white","text-sm","rounded","px-2","py-1"],[1,"absolute","-start-20","top-1/2","-translate-y-1/2","!w-16","flex","flex-col","gap-2"],[1,"!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"pointerdown","disabled"],[3,"color","borderWidth","width"],[1,"relative","w-full"],["matTooltipPosition","before","appButton","","shape","pill",1,"!p-1","!absolute","top-1/2","-translate-y-1/2","opacity-0","transition-all","duration-300",3,"click","matTooltip","ngClass"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"w-5","h-5"],["d","M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"],[1,"relative","w-full","!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"relative","size-6"],["alt","start",1,"w-full","h-full",3,"src"],["alt","start",1,"absolute","top-0","left-0","w-full","h-full","opacity-60",3,"src"],["alt","start",1,"size-6",3,"src"],[1,"!h-16","flex","flex-col","items-center","justify-center","bg-white","rounded-md","shadow","text-primary","text-xs","transition-all","hover:bg-white/70","disabled:opacity-50","disabled:cursor-not-allowed",3,"click"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-8"],["d","M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"],[1,"w-full","absolute","top-2","px-2","flex","justify-between","items-center"],[1,"relative","flex","items-center","gap-2","shadow-2xl","shadow-white","bg-black/20","py-1","px-2","rounded-full"],[1,"text-white","text-sm","font-semibold"],[1,"p-2","rounded-full",3,"ngClass"],[1,"p-2","absolute","end-2","pulse","rounded-full",3,"ngClass"],[1,"w-28","h-6","overflow-hidden","transition-all","rounded-full","border","border-white/30",3,"ngClass"],[1,"w-full","pointer-events-none","h-full","opacity-90"],["autoplay","",1,"h-full",3,"hidden"],[1,"h-full",3,"hidden"],["type","video/webm",3,"src"],["autoplay","","hidden",""],[1,"absolute","bottom-0","w-full","max-h-[45%]","overflow-y-auto","no-scrollbar","overflow-x-hidden"],[1,"min-h-0","flex-auto","flex","flex-col","gap-1","w-full","h-full","relative","overflow-hidden","py-1","px-2","[&>.message.user]:justify-start","[&>.message]:text-white"],[3,"class"],[1,"absolute","w-full","h-full","flex","items-center","justify-center","bg-black/80"],[1,"size-6",3,"innerHTML"],["appTextWriterAnimator","",1,"whitespace-pre-wrap","break-words",3,"text"],[1,"whitespace-pre-wrap","break-words",3,"innerHtml"],["appTextWriterAnimator","",1,"whitespace-pre-wrap","break-words",3,"animating","text"],[1,"icon-with-title",3,"click"],[1,"mdi",3,"ngClass"],[1,"title"],["hidden",""],["dir","auto"],[1,"d-inline"],[1,"px-1","text-primary"],[1,"mdi","mdi-link-variant"],[1,"d-inline","citation-link",2,"cursor","pointer"],[1,"absolute","w-full","h-full","flex","items-center","justify-center","bg-black/80",3,"click"],[1,"relative","flex","flex-col","justify-center","items-center","gap-2",3,"click"],[3,"qrdata"],[1,"p-1","text-white"],[1,"w-10","h-10","p-1","text-white","rounded-full","bg-white/30",3,"click"],["fill","currentColor","viewBox","0 0 24 24"]],template:function(e,t){if(e&1){let l=T();o(0,"div",7,0)(2,"div",8),y(3,nt,2,1,"span",9),o(4,"div",10)(5,"button",11),u("pointerdown",function(){return h(l),v(t.toggleStream())}),y(6,rt,1,3,"app-spinner-loader",12)(7,ot,2,2),a(),o(8,"div",13)(9,"button",14),u("click",function(){return h(l),v(t.rejectText())}),z(),o(10,"svg",15),d(11,"path",16),a()(),U(),o(12,"button",17),u("click",function(){return h(l),v(t.toggleRecording())}),y(13,at,3,4)(14,st,3,2)(15,lt,3,2)(16,ct,4,5),a()(),o(17,"button",18),u("click",function(){return h(l),v(t.interruptAvatar())}),o(18,"span",19),d(19,"img",20)(20,"img",21),a(),c(21),a(),o(22,"button",18),u("click",function(){return h(l),v(t.clearChat())}),d(23,"img",22),c(24),a(),o(25,"button",23),u("click",function(){return h(l),v(t.openSettingsPopup())}),z(),o(26,"svg",24),d(27,"path",25),a(),c(28),a()(),U(),o(29,"div",26)(30,"div",27)(31,"span",28),c(32),a(),d(33,"div",29)(34,"div",30),a(),o(35,"div",31),d(36,"div",32,1),a()(),d(38,"video",33,2),o(40,"video",34,3),d(42,"source",35),a(),d(43,"audio",36,4),o(45,"div",37)(46,"div",38,5),q(48,ut,4,5,"div",39,Xe),a()(),y(50,ht,8,2,"div",40),a()()}e&2&&(r(3),S(t.recognizedText()?3:-1),r(2),s("disabled",t.store.isStreamLoading()),r(),S(t.store.isStreamLoading()?6:7),r(3),s("matTooltip",t.lang.locals.cancel_recording)("ngClass",H(26,et,t.store.isRecordingStarted())),r(3),s("disabled",t.store.isRecordingLoading()||t.recognizingStatus()),r(),S(t.store.isRecordingLoading()?13:-1),r(),S(t.store.isRecordingStopped()?14:-1),r(),S(t.store.isRecordingStarted()&&t.recognizingStatus()?15:-1),r(),S(t.store.isRecordingStarted()&&!t.recognizingStatus()?16:-1),r(),s("disabled",!t.store.isStreamStarted()),r(2),s("src","assets/icons/speak.png",w),r(),s("src","assets/icons/stop.png",w),r(),C(" ",t.lang.locals.stop_talking," "),r(),s("disabled",!t.chatService.messages().length),r(),s("src","assets/icons/clear-chat.png",w),r(),C(" ",t.lang.locals.clear_chat_history," "),r(4),C(" ",t.lang.locals.settings," "),r(4),f(t.onlineStatus()),r(),s("ngClass",$(28,qe,t.store.isStreamStopped(),t.store.isStreamStarted(),t.store.isStreamLoading())),r(),s("ngClass",$(32,qe,t.store.isStreamStopped(),t.store.isStreamStarted(),t.store.isStreamLoading())),r(),s("ngClass",H(36,tt,!t.store.isRecordingStarted())),r(3),s("hidden",t.store.isStreamStopped()||t.store.isStreamLoading()),r(2),s("hidden",t.store.isStreamStarted()),r(2),s("src",t.store.idleAvatarUrl(),w),r(6),N(t.chatService.messages()),r(2),S(t.qrCodeOpened&&t.store.isStreamStarted()?50:-1))},dependencies:[se,ae,Ee,Ae,ce,R,Fe,Me,De,Pe,Ie],styles:['.message[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;font-size:.75rem;line-height:1rem}.message.user[_ngcontent-%COMP%]{align-items:flex-start}.message.user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-radius:.375rem;border-top-right-radius:0;background-color:#00000080;padding:.125rem}.message.user[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{content:"";position:absolute;right:-8px;top:0;width:8px;height:8px;clip-path:polygon(0 0,100% 0,0 100%);background-color:inherit}.message.assistant[_ngcontent-%COMP%]{align-items:flex-end}.message.assistant[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border-radius:.375rem;border-top-left-radius:0;background-color:#0003;padding:.125rem}.message.assistant[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:after{content:"";position:absolute;left:-8px;top:0;background-color:inherit;width:8px;height:8px;clip-path:polygon(0 0,100% 0,100% 100%)}']})};export{B as default};
