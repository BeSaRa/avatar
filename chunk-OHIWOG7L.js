import{c as h}from"./chunk-KNZUA67I.js";import{c as G}from"./chunk-5BZPFUY4.js";import{a as t}from"./chunk-FWDT53KA.js";import{a as u}from"./chunk-2N4EDZNV.js";import{b as l}from"./chunk-EARLHVX5.js";import{a as p,b as U}from"./chunk-DYBLNUKQ.js";import{g as M}from"./chunk-PXW4CVT7.js";import{B as L,D as a,Db as s,K as C,P as n,ka as e,na as c,ta as i,x as N}from"./chunk-O6QGGAL6.js";var O={CHATBOT:"CHATBOT",MEDIA:"MEDIA",INTERACTIVE_CHAT:"INTERACTIVE_CHAT",SEARCH:"SEARCH",AVATAR:"AVATAR",DOCUMENT_INTELLIGENCE:"DOCUMENT_INTELLIGENCE",CHAT_HISTORY:"CHAT_HISTORY",ADMIN_CRAWLER:"ADMIN_CRAWLER",STORAGE_UPLOAD_BLOB:"STORAGE_UPLOAD_BLOB",STORAGE_GET_BLOB:"STORAGE_GET_BLOB",STORAGE_GET_ALL_CONTAINERS:"STORAGE_GET_ALL_CONTAINERS",STORAGE_GET_SUBFOLDER:"STORAGE_GET_SUBFOLDER",ADMIN:"ADMIN",STORAGE_DELETE_SUBFOLDER:"STORAGE_DELETE_SUBFOLDER",STORAGE_DELETE_BLOB_BY_METADATA:"STORAGE_DELETE_BLOB_BY_METADATA",STORAGE_DELETE_BLOB_BY_TITLE:"STORAGE_DELETE_BLOB_BY_TITLE",RESET_INDEX:"RESET_INDEX",RUN_INDEXER:"RUN_INDEXER",INDEX_INFO:"INDEX_INFO",INDEXES_NAMES:"INDEXES_NAMES",MEDIA_GENERATE_REPORT:"MEDIA_GENERATE_REPORT",MEDIA_CRAWL:"MEDIA_CRAWL",MEDIA_SENTIMENT:"MEDIA_SENTIMENT",MEDIA_DETECT_LANGUAGE:"MEDIA_DETECT_LANGUAGE",MEDIA_KEY_PHRASES:"MEDIA_KEY_PHRASES",MEDIA_ENTITY_RECOGNITION:"MEDIA_ENTITY_RECOGNITION",MEDIA_IMAGE_ANALYSIS:"MEDIA_IMAGE_ANALYSIS",MEDIA_IMAGE_EMBEDDING:"MEDIA_IMAGE_EMBEDDING",CHATBOT_WEBSITE:"CHATBOT_WEBSITE",CHATBOT_UPLOAD_DOCUMENT:"CHATBOT_UPLOAD_DOCUMENT",INTERACTIVE_DEPARTMENT_TYPES:"INTERACTIVE_DEPARTMENT_TYPES",INTERACTIVE_VACATION_TYPES:"INTERACTIVE_VACATION_TYPES",INTERACTIVE_SUBMIT_FORM:"INTERACTIVE_SUBMIT_FORM",INTERACTIVE_APPROVE:"INTERACTIVE_APPROVE",INTERACTIVE_REJECT:"INTERACTIVE_REJECT",INTERACTIVE_PENDING:"INTERACTIVE_PENDING",INTERACTIVE_FILTER_FORMS:"INTERACTIVE_FILTER_FORMS",INTERACTIVE_ALL_FORMS:"INTERACTIVE_ALL_FORMS",AVATAR_START_STREAM:"AVATAR_START_STREAM",AVATAR_SEND_CANDIDATE:"AVATAR_SEND_CANDIDATE",AVATAR_SEND_ANSWER:"AVATAR_SEND_ANSWER",AVATAR_RENDER_TEXT:"AVATAR_RENDER_TEXT",AVATAR_STOP_RENDER:"AVATAR_STOP_RENDER",AVATAR_CLOSE_STREAM:"AVATAR_CLOSE_STREAM",SPEECH_TOKEN:"SPEECH_TOKEN",SPEECH_TRANSCRIPT:"SPEECH_TRANSCRIPT",CHAT_HISTORY_CONVERSATION:"CHAT_HISTORY_CONVERSATION",CHAT_HISTORY_ALL_CONVERSATION:"CHAT_HISTORY_ALL_CONVERSATION",CHAT_HISTORY_CHAT:"CHAT_HISTORY_CHAT",CHAT_HISTORY_SENTIMENT:"CHAT_HISTORY_SENTIMENT",CHAT_HISTORY_ADD_FEEDBACK:"CHAT_HISTORY_ADD_FEEDBACK",CHAT_HISTORY_BOT_NAMES:"CHAT_HISTORY_BOT_NAMES",CHAT_HISTORY_ADD_MSG:"CHAT_HISTORY_ADD_MSG",DOCUMENT_INTELLIGENCE_ANALYZE_PDF:"DOCUMENT_INTELLIGENCE_ANALYZE_PDF",SEARCH_BOT_NAME:"SEARCH_BOT_NAME",CHATBOT_LEGAL:"CHATBOT_LEGAL",CHATBOT_MEDIA:"CHATBOT_MEDIA",CHATBOT_INTERACTIVE:"CHATBOT_INTERACTIVE",CHATBOT_QREP:"CHATBOT_QREP",CHATBOT_DOC_INTELLIGENCE:"CHATBOT_DOC_INTELLIGENCE",ADMIN_ADD_USER:"ADMIN_ADD_USER",ADMIN_DELETE_USER:"ADMIN_DELETE_USER",ADMIN_UPDATE_USER:"ADMIN_UPDATE_USER",ADMIN_GET_ALL_USER:"ADMIN_GET_ALL_USER",ADMIN_GET_USER:"ADMIN_GET_USER",ADMIN_GET_PERMISSION:"ADMIN_GET_PERMISSION",ADMIN_GET_ALL_PERMISSION:"ADMIN_GET_ALL_PERMISSION",ADMIN_UPDATE_PERMISSION:"ADMIN_UPDATE_PERMISSION",ADMIN_GET_ALL_SETTINGS:"ADMIN_GET_ALL_SETTINGS",ADMIN_ADD_SETTING:"ADMIN_ADD_SETTING",ADMIN_UPDATE_SETTING:"ADMIN_UPDATE_SETTING",ADMIN_DELETE_SETTING:"ADMIN_DELETE_SETTING",ADMIN_GET_SETTING:"ADMIN_GET_SETTING",SOCIAL_MEDIA:"SOCIAL_MEDIA",SOCIAL_MEDIA_X_SEACRH:"SOCIAL_MEDIA_X_SEACRH",FAQ:"FAQ",VIDEO_INDEXER:"VIDEO_INDEXER",VIDEO_INDEXER_REINDEX:"VIDEO_INDEXER_REINDEX",VIDEO_INDEXER_GET_VIDEOS:"VIDEO_INDEXER_GET_VIDEOS",VIDEO_INDEXER_UPLOAD_VIDEO:"VIDEO_INDEXER_UPLOAD_VIDEO",VIDEO_INDEXER_START_VIDEO_CHAT:"VIDEO_INDEXER_START_VIDEO_CHAT",FAQ_ADD_QUESTION:"FAQ_ADD_QUESTION",FAQ_DELETE_QUESTION:"FAQ_DELETE_QUESTION",FAQ_UPDATE:"FAQ_UPDATE",FAQ_GET_ARCHIVED:"FAQ_GET_ARCHIVED",LOCALIZATION:"LOCALIZATION",LOCALIZATION_CREATE_LABEL:"LOCALIZATION_CREATE_LABEL",LOCALIZATION_GET_LABEL:"LOCALIZATION_GET_LABEL ",LOCALIZATION_UPDATE_LABEL:"LOCALIZATION_UPDATE_LABEL ",LOCALIZATION_DELETE_LABEL:"LOCALIZATION_DELETE_LABEL ",AVATAR_GENERATE_VIDEO:"AVATAR_GENERATE_VIDEO",AVATAR_RETRIEVE_VIDEO:"AVATAR_RETRIEVE_VIDEO",AVATAR_UPDATE_VIDEO:"AVATAR_UPDATE_VIDEO",AVATAR_RETRIEVE_STREAM:"AVATAR_RETRIEVE_STREAM",AVATAR_GREETING:"AVATAR_GREETING",AVATAR_LIST_STREAMS:"AVATAR_LIST_STREAMS",AVATAR_STREAM_STATUS:"AVATAR_STREAM_STATUS",MEDIA_STATISTICS:"MEDIA_STATISTICS",MEDIA_STATISTICS_NEWS_CARDS:"MEDIA_STATISTICS_NEWS_CARDS",MEDIA_STATISTICS_NEWS_PERCENTAGE:"MEDIA_STATISTICS_NEWS_PERCENTAGE",MEDIA_STATISTICS__USED_KEYWORDS:"MEDIA_STATISTICS__USED_KEYWORDS",MEDIA_STATISTICS__INDEXED_URLS:"MEDIA_STATISTICS__INDEXED_URLS",ADMIN_GET_USER_PERMISSIONS:"ADMIN_GET_USER_PERMISSIONS",FAQ_GET_ALL_QUESTIONS:"FAQ_GET_ALL_QUESTIONS",ADMIN_GET_LEGAL_CONTAINER:"ADMIN_GET_LEGAL_CONTAINER",ADMIN_GET_LEGAL_SUBFOLDERS:"ADMIN_GET_LEGAL_SUBFOLDERS",ADMIN_LEGAL_SUBFOLDERS_BOLBS:"ADMIN_LEGAL_SUBFOLDERS_BOLBS",ADMIN_LEGAL_BOLBS:"ADMIN_LEGAL_BOLBS",STORAGE_GET_SAS_TOKEN:"STORAGE_GET_SAS_TOKEN",GET_PERMISSION_GROUPS:"GET_PERMISSION_GROUPS",AGENT_CHAT:"AGENT_CHAT",AGENT_STREAM_CHAT:"AGENT_STREAM_CHAT",TASK_AGENT_UPDATE_STATUS:"TASK_AGENT_UPDATE_STATUS",TASK_AGENT_GET_STATU:"TASK_AGENT_GET_STATU"};function T(S){return P.filter(E=>E.startsWith(S))}function R(S){return P.filter(E=>E.includes(S))}var P=Object.keys(O),V={CHAT_HISTORY_GROUP:T("CHAT_HISTORY_"),SEARCH_GROUP:T("SEARCH"),HR_AGENT_GROUP:T("INTERACTIVE_"),TASK_AGENT_GROUP:T("TASK"),REPORT_GENERATOR_GROUP:T("MEDIA_GENERATE"),STATISTICS_GROUP:T("MEDIA_STATISTICS"),VIDEO_INDEXER_GROUP:T("VIDEO_INDEXER"),DOCUMENT_ANALYSER_GROUP:T("DOCUMENT_INTELLIGENCE"),VIDEO_GENERATOR_GROUP:T("AVATAR_GENERATE"),WEB_CRAWLING_GROUP:T("MEDIA_CRAWL"),FAQ_GROUP:T("FAQ"),SOCIAL_GROUP:T("SOCIAL"),LEGAL_GROUP:R("LEGAL"),INDEXES_GROUP:R("INDEX"),USER_GROUP:R("USER"),STORAGE_GROUP:T("STORAGE"),ADMIN_GROUP:[...T("MEDIA_CRAWL"),...T("FAQ"),...T("SOCIAL"),...R("LEGAL"),...R("INDEX"),...R("USER"),...T("STORAGE")]};var o=class{_permissions=[];_permissionsKeys=[];_refresh_token=s("");_access_token=s("");_user_id=s("");_username=s("");isRefreshing=s(!1);get username(){return this._username()}set username(E){this._username.set(E)}get user_id(){return this._user_id()}set user_id(E){this._user_id.set(E)}set permissions(E){this._permissions=E,this._permissionsKeys=E.map(_=>_.key)}get permissions(){return this._permissions}get permissionsKeys(){return this._permissionsKeys}get access_token(){return this._access_token()}set access_token(E){this._access_token.set(E)}set refresh_token(E){this._refresh_token.set(E)}get refresh_token(){return this._refresh_token()}hasPermission(E){return this._permissionsKeys.includes(O[E])}hasAnyPermission(E){return E.some(_=>this._permissionsKeys.includes(O[_]))}hasAllPermission(E){return E.every(_=>this._permissionsKeys.includes(O[_]))}hasToken(){return!!this.access_token&&!this.isRefreshing()}};var D={TOKEN_HEADER_KEY:"Authorization"};var m=class S{_http=i(M);_urlService=i(p);_router=i(G);messagesService=i(h);lang=i(U);commonService=i(u);store=i(l);$applicationUser=s(new o);$isAuthenticated=s(!1);login(E,_){let I=`${this._urlService.URLS.USER}/login`;return this._http.post(I,{username:E,password:_}).pipe(e(A=>this.$applicationUser.update(r=>(r.access_token=A.access_token,r.refresh_token=A.refresh_token,r.permissions=A.permissions,r.user_id=A.user_id,r.username=A.username,r))),e(A=>localStorage.setItem(t.USER,JSON.stringify(A))),e(A=>localStorage.setItem(t.PERMISSIONS_KEYS,JSON.stringify(A.permissions.map(r=>r.key)))),e(()=>this.$isAuthenticated.set(!0)),e(()=>this._router.navigate(["/home"])),e(()=>this.messagesService.showInfo(`${this.lang.locals.welcome_user}, ${E}! ${this.lang.locals.welcome_back}`)),e(()=>localStorage.setItem(t.USERNAME,E)),e(()=>this.setExpirationSession()),a(A=>this.handleSpeechToken(A)),n(()=>(this.$isAuthenticated.set(!1),this.messagesService.showError(`${this.lang.locals.login_failed}`),N(new o))))}generateRefreshToken(){let E=`${this._urlService.URLS.USER}/refresh-token`;this.$applicationUser().isRefreshing.set(!0);let _={headers:{[D.TOKEN_HEADER_KEY]:this.$applicationUser().refresh_token}};return this._http.get(E,_).pipe(e(I=>this.$applicationUser.update(A=>(A.refresh_token=I.refresh_token,A))),e(()=>this.$applicationUser().isRefreshing.set(!1)),n(()=>(this.$applicationUser().isRefreshing.set(!1),N({refresh_token:""}))))}generateAccessToken(){let E=`${this._urlService.URLS.USER}/access-token`,_={headers:{[D.TOKEN_HEADER_KEY]:this.$applicationUser().access_token}};return this._http.get(E,_).pipe(e(I=>this.$applicationUser.update(A=>(A.access_token=I.access_token,A)),n(()=>(this._router.navigate(["/auth/login"]),N({access_token:""})))))}tryAuthenticate(){let E=localStorage.getItem(t.USER);E&&this.$applicationUser.update(_=>{let I=JSON.parse(E);return _.access_token=I.access_token,_.refresh_token=I.refresh_token,_.permissions=I.permissions,_}),this.$isAuthenticated.set(!!E),!this.$isAuthenticated()&&this._router.navigate(["/auth/login"])}logout(){this.$isAuthenticated.set(!1),this.$applicationUser.set(new o),localStorage.removeItem(t.USER),localStorage.removeItem(t.TOKEN_EXPIRY),this.logoutSubscription?.unsubscribe(),this._router.navigate(["/auth/login"])}startAutoLogout(E){let _=E-Date.now();console.log(_/1e3),this.logoutSubscription?.unsubscribe(),this.logoutSubscription=C(_).subscribe(()=>{this.logout(),this.messagesService.showError(this.lang.locals.session_timeout)})}checkAutoLogoutOnRefresh(){let E=localStorage.getItem(t.TOKEN_EXPIRY);if(!E)return;let _=parseInt(E,10);Date.now()>=_?(this.logout(),this.messagesService.showError(this.lang.locals.session_timeout)):this.startAutoLogout(_)}setExpirationSession(){let E=Date.now()+30*60*1e3;localStorage.setItem(t.TOKEN_EXPIRY,E.toString()),this.startAutoLogout(E)}getUsername(){return localStorage.getItem(t.USERNAME)??""}handleSpeechToken(E){return this.commonService.generateSpeechToken().pipe(e(_=>this.store.updateSpeechToken(_)),n(_=>(console.error("Error generating speech token:",_),N(null))),L(()=>E))}static \u0275fac=function(_){return new(_||S)};static \u0275prov=c({token:S,factory:S.\u0275fac,providedIn:"root"})};export{V as a,D as b,m as c};
