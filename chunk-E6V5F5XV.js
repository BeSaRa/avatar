import{a as x,e as g,h as d}from"./chunk-COAW4WTH.js";import{H as m,J as s,a as l,ea as f,ka as i,sb as c,t as p,x as u}from"./chunk-HKFUFUH4.js";function k(t=!1){return n=>n.pipe(s(e=>(t&&console.log(e),p("CUSTOM_ERROR")))).pipe(m(e=>e!=="CUSTOM_ERROR"))}function b(){let t=new Date().getTime(),n=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let r=Math.random()*16;return t>0?(r=(t+r)%16|0,t=Math.floor(t/16)):(r=(n+r)%16|0,n=Math.floor(n/16)),(e==="x"?r:r&3|8).toString(16)})}function w(t){return/[\u0600-\u06FF]+/.test(t)}var C=t=>(t.split(" ").map(n=>(w(n)?"\u202A":"\u202C")+n).join(" "),t);function T(t){return class extends t{clone(e){let r=this.constructor;return Object.assign(new r,this,e)}}}var o=class extends T(class{}){constructor(e="",r="user"){super();this.content=e;this.role=r;this.id=b()}context;end_turn;function_call;tool_calls;id;isUser(){return this.role==="user"}isAssistant(){return this.role==="assistant"}isError(){return this.role==="error"}};var h=class t{http=i(x);urlService=i(g);store=i(d);messages=c([]);status=c(!1);sendMessage(n){return this.messages.update(e=>[...e,new o(n,"user")]),this.http.post(this.urlService.URLS.CHAT,l({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null)).pipe(s(e=>{throw new o().clone({content:e.message,role:"error"}),new Error(e)})).pipe(u(e=>(e.message.content=C(this.formatText(e.message.content,e.message)),e.message=new o().clone(e.message),this.messages.update(r=>[...r,e.message]),e)))}formatText(n,e){console.log("message",e);let r=n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");return r=r.replace(/\[(.*?)\]/g,(y,O)=>{let a=e.context.citations[Number(O.replace(/[^0-9]/g,""))-1];if(!a)return y;let M=a.title;return`<br /><small class="px-1 text-primary"><a target="_blank" href="${a.url}">${M}</a><i class="link-icon"></i></small>`}),r.trim()}static \u0275fac=function(e){return new(e||t)};static \u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"})};export{k as a,h as b};
