import{c as le}from"./chunk-V7ZCYTZO.js";import"./chunk-3MSRG7IT.js";import{a as ge}from"./chunk-OPN66AIS.js";import{a as ue}from"./chunk-BP77LVID.js";import{b as de}from"./chunk-PMUIQYPP.js";import{b as se}from"./chunk-ZPRGCDHT.js";import{b as y}from"./chunk-L4GXIFO4.js";import{h as te}from"./chunk-OEPHUH2H.js";import{a as pe}from"./chunk-HDLOXU5R.js";import{b as ce,c as me}from"./chunk-B3LQ2IDW.js";import"./chunk-WK44F4QQ.js";import"./chunk-OK5S6IU3.js";import{A as ae,c as ie,h as ne,l as oe,o as re}from"./chunk-SLIRYUJ2.js";import{b as ee}from"./chunk-UR3XF2OI.js";import"./chunk-7UCX2ERW.js";import{Ad as K,B as E,Bc as d,Cc as x,Dc as w,Eb as D,Gd as X,Ha as u,Ia as g,Ja as N,Jb as B,La as j,M as R,N as F,Nc as Q,Ob as S,P,Pc as U,Qc as q,Rc as A,Sc as W,Tc as Y,Ub as l,X as $,Z as L,Zb as C,cc as a,dc as s,ec as c,ha as p,hd as Z,i as G,ia as T,ic as k,ka as b,lc as f,nc as v,s as V,sb as r,ta as h,vd as J,w as _,x as O,xa as z,yc as I,zc as H}from"./chunk-OUJ2UPQI.js";var he=["video"],Se=["idleVideo"],fe=(t,i,n)=>({"bg-red-600":t,"bg-green-700":i,"bg-orange-500":n}),Ce=t=>({"-translate-x-full":t}),we=(t,i)=>({"bg-green-700":t,"bg-red-600":i});function _e(t,i){t&1&&(a(0,"div",8),c(1,"app-avatar-interrupter-btn"),s())}function be(t,i){t&1&&c(0,"app-spinner-loader",18),t&2&&l("width",24)("borderWidth",4)}function xe(t,i){if(t&1&&d(0),t&2){let n=v();w(" ",n.lang.locals.test," ")}}function ye(t,i){if(t&1&&(a(0,"button",24)(1,"div",27)(2,"span"),d(3),s()()()),t&2){let n=v();r(3),x(n.onlineStatus())}}function Ve(t,i){if(t&1){let n=k();a(0,"button",28),f("click",function(){u(n);let o=v();return g(o.toggleStream())}),d(1),s()}if(t&2){let n=v();l("ngClass",q(2,we,n.store.isStreamStarted(),n.store.isStreamStopped())),r(),w(" ",n.onlineStatus()," ")}}function Ee(t,i){if(t&1&&(a(0,"div",26)(1,"span",29),d(2),s(),a(3,"span",30)(4,"span",31),d(5,"."),s(),a(6,"span",32),d(7,"."),s(),a(8,"span",33),d(9,"."),s()()()),t&2){let n=v();r(2),x(n.lang.locals.video_generating_and_downloading_progress)}}var M=class t extends pe(class{}){video=D.required("video");idleVideo=D("idleVideo");lang=h(ee);avatarService=h(de);store=h(se);messageService=h(le);start$=new V(1);stop$=new V(1);text=new oe("");isLoading=!1;isDownloading=!1;settingsOpened=!1;onlineStatus=Z(()=>{switch(this.lang.localChange(),this.store.streamingStatus()){case"Started":return this.lang.locals.connected;case"InProgress":return this.lang.locals.connecting;case"Disconnecting":return this.lang.locals.disconnecting;default:return this.lang.locals.not_connected}});init$=this.start$.asObservable().pipe(b(()=>this.store.updateStreamStatus("InProgress"))).pipe(T(this.destroy$)).pipe($(()=>this.avatarService.startStream().pipe(P(i=>{throw this.store.updateStreamStatus("Stopped"),i})).pipe(y()))).pipe(p(i=>{let{data:{webrtcData:{offer:n,iceServers:e}}}=i;return this.pc=new RTCPeerConnection({iceServers:e,iceTransportPolicy:"relay"}),this.pc.addEventListener("icecandidate",o=>{o.candidate&&this.avatarService.sendCandidate(o.candidate).subscribe()}),this.pc.addEventListener("icegatheringstatechange",o=>{o.target.iceGatheringState=="complete"&&this.video().nativeElement.paused&&(this.video().nativeElement.play().then(),this.store.updateStreamStatus("Started"))}),this.pc.addEventListener("track",o=>{this.video().nativeElement.srcObject=o.streams[0]}),this.pc.addEventListener("connectionstatechange",o=>{let m=o.target.connectionState;m==="connected"&&this.store.updateStreamStatus("Started"),m==="disconnected"&&this.store.updateStreamStatus("Stopped")}),_(this.pc.setRemoteDescription(new RTCSessionDescription(n))).pipe(p(()=>_(this.pc.createAnswer()))).pipe(p(o=>_(this.pc.setLocalDescription(o)).pipe(E(()=>o)))).pipe(p(o=>this.avatarService.sendAnswer(o)))})).pipe(E(()=>""));ngOnInit(){return G(this,null,function*(){R(this.destroy$).pipe(b(()=>this.store.updateStreamStatus("Stopped"))).pipe(p(()=>this.avatarService.closeStream().pipe(y()))).subscribe(()=>{console.log("COMPONENT DESTROYED")}),this.stop$.pipe(F(()=>this.store.hasStream())).pipe(b(()=>this.store.updateStreamStatus("Disconnecting"))).pipe(T(this.destroy$)).pipe(p(()=>this.avatarService.closeStream().pipe(y()))).subscribe(()=>{console.log("MANUAL CLOSE")}),this.start$.next()})}toggleSettings(){this.settingsOpened=!this.settingsOpened}interruptAvatar(){this.avatarService.interruptAvatar().subscribe()}test(){!this.text.value||this.isLoading||!this.store.isStreamStarted()||(this.isLoading=!0,this.avatarService.renderText(this.text.value).pipe(L(()=>this.isLoading=!1)).subscribe())}updateAndDownload(){!this.text.value||this.isLoading||this.isDownloading||(this.isDownloading=!0,this.avatarService.updateVideo(this.text.value).pipe(p(i=>i.status==="SUCCESS"?this.avatarService.retrieveVideo():(i.status==="RENDERING"&&this.messageService.showInfo(this.lang.locals.another_video_is_being_generated_please_try_again_after_a_while),O(null)))).pipe(L(()=>this.isDownloading=!1)).subscribe(i=>{i&&window.open(i)}))}ngAfterViewInit(){this.playIdle()}playIdle(){this.idleVideo()&&this.idleVideo()?.nativeElement&&(this.idleVideo().nativeElement.src="assets/videos/idle-full.webm",this.idleVideo().nativeElement.muted=!0,this.idleVideo().nativeElement.loop=!0,this.idleVideo().nativeElement.play().then())}toggleStream(){this.store.isStreamStopped()?this.start$.next():this.store.isStreamStarted()&&this.stop$.next()}static \u0275fac=(()=>{let i;return function(e){return(i||(i=j(t)))(e||t)}})();static \u0275cmp=z({type:t,selectors:[["app-video-generator"]],viewQuery:function(n,e){n&1&&(I(e.video,he,5),I(e.idleVideo,Se,5)),n&2&&H(2)},standalone:!0,features:[B,Q],decls:35,vars:28,consts:[["video",""],["idleVideo",""],["id","video-wrapper",1,"relative","flex","flex-col","justify-center","items-center","gap-2","h-[100vh]","px-4","py-4","overflow-hidden"],[1,"flex","flex-col","items-end","w-full","md:w-[700px]","h-full","overflow-hidden","justify-center","relative","rounded-md"],[1,"flex","items-center","gap-1","shadow-2xl","shadow-white","bg-black/20","p-1","absolute","z-50","top-2","end-2","rounded-md"],[1,"p-4","rounded-full",3,"ngClass"],[1,"p-4","absolute","pulse","rounded-full",3,"ngClass"],[1,"text-white","font-semibold"],[1,"absolute","z-50","top-2","start-2","w-10"],[1,"relative","w-full","h-[500px]","overflow-hidden"],["autoplay","",1,"absolute","min-w-full","min-h-full",3,"hidden"],[1,"absolute","min-w-full","min-h-full",3,"hidden"],["src","assets/videos/idle-full.webm","type","video/webm"],[1,"w-full","md:w-[700px]"],[1,"w-full"],["type","text","tabindex","1","rows","3",1,"w-full","resize-none","text-lg","p-2","text-gray-700","border","border-gray-300","rounded-lg","bg-gray-100","focus:ring-gray-400","focus:border-gray-400","focus:ring-4","outline-none","ring-2","ring-gray-500",3,"keydown.enter","formControl"],[1,"flex","justify-center","items-center","gap-4"],[1,"bg-gray-300","w-1/2","text-gray-800","font-medium","py-2","px-4","rounded-lg","hover:bg-gray-400","disabled:bg-gray-400","focus:ring-2","focus:ring-gray-200","focus:outline-none",3,"click","disabled"],["color","#374151",3,"width","borderWidth"],["id","settings",1,"bg-black/50","absolute","left-0","top-1/2","rounded","p-4","transition-transform",3,"ngClass"],[1,"relative","flex","flex-col"],["aria-label","Settings",1,"absolute","-top-2","-right-14","z-20","bg-black/50","rounded-r","text-white",3,"click","matTooltip"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24",1,"size-10"],["d","M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"],["aria-label","close stream",1,"text-white","cursor-progress","size-20","bg-orange-500","rounded-full"],["matRipple","","aria-label","close stream",1,"text-white","size-20","rounded-full",3,"ngClass"],[1,"absolute","top-0","left-0","w-full","h-full","bg-black/75","z-50","flex","items-center","justify-center","gap-2","text-gray-200"],[1,"pulse","rounded-full","w-full","h-full","bg-primary","flex","justify-center","items-center"],["matRipple","","aria-label","close stream",1,"text-white","size-20","rounded-full",3,"click","ngClass"],[1,"font-medium","text-2xl"],[1,"flex","text-6xl"],[1,"animate-[bounce_1s_ease-in-out_infinite]"],[1,"animate-[bounce_1s_ease-in-out_infinite_0.2s]"],[1,"animate-[bounce_1s_ease-in-out_infinite_0.4s]"]],template:function(n,e){if(n&1){let o=k();a(0,"div",2)(1,"div",3)(2,"div",4),c(3,"div",5)(4,"div",6),a(5,"span",7),d(6),s()(),S(7,_e,2,0,"div",8),a(8,"div",9),c(9,"video",10,0),a(11,"video",11,1),c(13,"source",12),s()()(),a(14,"div",13)(15,"div",14)(16,"textarea",15),f("keydown.enter",function(ve){return u(o),ve.preventDefault(),g(e.test())}),s()(),a(17,"div",16)(18,"button",17),f("click",function(){return u(o),g(e.test())}),S(19,be,1,2,"app-spinner-loader",18)(20,xe,1,1),s(),a(21,"button",17),f("click",function(){return u(o),g(e.updateAndDownload())}),d(22),s()()(),d(23),W(24,"async"),s(),a(25,"div",19)(26,"div",20)(27,"button",21),f("click",function(){return u(o),g(e.toggleSettings())}),N(),a(28,"svg",22)(29,"title"),d(30,"cog"),s(),c(31,"path",23),s()(),S(32,ye,4,1,"button",24)(33,Ve,2,5,"button",25),s()(),S(34,Ee,10,1,"div",26)}n&2&&(r(3),l("ngClass",A(18,fe,e.store.isStreamStopped(),e.store.isStreamStarted(),e.store.isStreamLoading())),r(),l("ngClass",A(22,fe,e.store.isStreamStopped(),e.store.isStreamStarted(),e.store.isStreamLoading())),r(2),x(e.onlineStatus()),r(),C(e.store.isStreamStarted()?7:-1),r(2),l("hidden",e.store.isStreamStopped()||e.store.isStreamLoading()),r(2),l("hidden",e.store.isStreamStarted()),r(5),l("formControl",e.text),r(2),l("disabled",!e.store.isStreamStarted()||e.isLoading||!e.text.value),r(),C(e.isLoading?19:20),r(2),l("disabled",e.isLoading||e.isDownloading||!e.text.value),r(),w(" ",e.lang.locals.download," "),r(),w(" ",Y(24,16,e.init$),`
`),r(2),l("ngClass",U(26,Ce,!e.settingsOpened)),r(2),l("matTooltip",e.lang.locals.settings),r(5),C(e.store.isStreamLoading()?32:33),r(2),C(e.isDownloading?34:-1))},dependencies:[X,J,K,ae,ie,ne,re,te,ge,ue,me,ce],styles:["[_nghost-%COMP%]{position:relative}"]})};export{M as default};
