import{a as M}from"./chunk-ZK6PON2O.js";import{b as v}from"./chunk-RH46QXHP.js";import{c as T,d as y,e as x}from"./chunk-IGTIOZK6.js";import{b,f as h}from"./chunk-H5VWA6Q6.js";import{B as c,H as C,O as g,a as u,da as d,ja as f,pa as l,x as p}from"./chunk-K4ZX3MMM.js";function I(o){return class extends o{clone(r){let s=this.constructor;return Object.assign(new s,this,r)}}}var m=class{context;conversation_id;content;role;id;constructor(){this.id=T()}isUser(){return this.role==="user"}isAssistant(){return this.role==="assistant"}isError(){return this.role==="error"}};var i=class extends I(m){constructor(r="",s="user"){super();this.content=r;this.role=s}end_turn;function_call;tool_calls};var S=class o{http=l(b);urlService=l(h);adminService=l(M);store=l(v);sendMessage(e,r){let s=`${this.urlService.URLS.CHAT}/${r}`;return this.messages.update(t=>[...t,new i(e,"user")]),this.http.post(s,u(u({messages:this.messages()},this.store.streamId()?{stream_id:this.store.streamId()}:null),this.conversationId()?{conversation_id:this.conversationId()}:null)).pipe(g(t=>{throw new i().clone({content:t.message,role:"error"}),new Error(t)}),c(t=>(t.message.content=x(t.message.content,t.message),t)),d(t=>this.processFormattedText(t.message.content).pipe(c(n=>(t.message.content=y(n),t.message=new i().clone(t.message),this.conversationId.set(t.message.conversation_id),this.messages.update(a=>[...a,t.message]),t)))))}processFormattedText(e){let r=[...e.matchAll(/href="(.*?)"/g)];if(r.length===0)return console.log("No matches found in formatted text."),p(e);let s=r.map(t=>{let n=t[1];return n.includes("blob.core.windows.net")?this.adminService.secureUrl(n).pipe(c(a=>({match:t[0],replacement:t[0].replace(n,a)})),g(()=>p({match:t[0],replacement:t[0]}))):p({match:t[0],replacement:t[0]})});return C(s).pipe(c(t=>(t.forEach(({match:n,replacement:a})=>{e=e.replace(n,a)}),e)))}static \u0275fac=function(r){return new(r||o)};static \u0275prov=f({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,i as b,S as c};
