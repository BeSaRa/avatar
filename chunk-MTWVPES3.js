import{a as S}from"./chunk-XN7MSE24.js";import{b as ie}from"./chunk-VCP5E4SP.js";import{b as g}from"./chunk-6BFTBZPO.js";import{a as ne}from"./chunk-IB75ZEMT.js";import{na as ae}from"./chunk-2SSA22JS.js";import{g as f}from"./chunk-SKPQZEK7.js";import{B as b,Bb as y,Fb as W,Ga as B,Gc as h,Ia as $,Ic as K,Jc as T,Kb as E,Kc as z,L,Lc as X,M as O,Mc as Z,Na as N,Nb as q,O as R,Ob as c,Ra as j,S as k,Sa as H,Tb as A,W as F,Yb as r,Zb as s,_b as o,ad as M,fa as p,fc as G,ga as w,hc as x,i as _,ia as u,od as ee,pb as l,qb as Q,ra as d,rd as te,s as C,sc as I,tc as U,va as v,vc as V,w as m,wc as Y,xa as P,xc as J}from"./chunk-QDEZZFGD.js";var se=class n{constructor(i){this.elementRef=i}text="";speed=2;stop=!1;animating=new N;ngOnInit(){this.animateText()}animateText(){this.animating.emit(!0);let i=0,t="",e=()=>{if(this.stop){this.animating.emit(!1);return}t+=this.text.charAt(i),this.elementRef.nativeElement.innerHTML=t,i++,i<this.text.length?setTimeout(e,this.speed*Math.random()):this.animating.emit(!1)};e()}static \u0275fac=function(t){return new(t||n)(Q(H))};static \u0275dir=P({type:n,selectors:[["","appTextWriterAnimator",""]],inputs:{text:"text",speed:"speed",stop:"stop"},outputs:{animating:"animating"},standalone:!0})};var me=["video"],ue=["idleVideo"],ve=n=>({"scale-50 left-0":n}),oe=(n,i,t)=>({"bg-red-600":n,"bg-green-700":i,"bg-orange-500":t}),ce=(n,i)=>({"h-full":n,"w-full":i});function he(n,i){if(n&1&&(r(0,"span",7),V(1),s()),n&2){let t=x();l(),Y(t.onlineStatus())}}function fe(n,i){if(n&1&&(r(0,"video",9,1),o(2,"source",10),s()),n&2){let t=x();c("ngClass",T(2,ce,t.hasSize(),!t.hasSize()))("hidden",t.store.isStreamStarted())}}var le=class n extends ne(class{}){size=j();hasSize=M(()=>!!this.size());fullWidth="w-full h-full block ";video=y.required("video");idleVideo=y("idleVideo");avatarService=d(S);lang=d(f);start$=new C(1);stop$=new C(1);store=d(ie);init$=this.start$.asObservable().pipe(u(()=>this.store.updateStreamStatus("InProgress"))).pipe(w(this.destroy$)).pipe(F(()=>this.avatarService.startStream(this.size()).pipe(R(i=>{throw this.store.updateStreamStatus("Stopped"),i})).pipe(g()))).pipe(p(i=>{let{data:{webrtcData:{offer:t,iceServers:e}}}=i;return this.pc=new RTCPeerConnection({iceServers:e,iceTransportPolicy:"relay"}),this.pc.addEventListener("icecandidate",a=>{a.candidate&&this.avatarService.sendCandidate(a.candidate).subscribe()}),this.pc.addEventListener("icegatheringstatechange",a=>{a.target.iceGatheringState=="complete"&&this.video().nativeElement.paused&&(this.video().nativeElement.play().then(),this.store.updateStreamStatus("Started"))}),this.pc.addEventListener("track",a=>{this.video().nativeElement.srcObject=a.streams[0]}),this.pc.addEventListener("connectionstatechange",a=>{let D=a.target.connectionState;D==="connected"&&this.store.updateStreamStatus("Started"),D==="disconnected"&&this.store.updateStreamStatus("Stopped")}),m(this.pc.setRemoteDescription(new RTCSessionDescription(t))).pipe(p(()=>m(this.pc.createAnswer()))).pipe(p(a=>m(this.pc.setLocalDescription(a)).pipe(b(()=>a)))).pipe(p(a=>this.avatarService.sendAnswer(a)))})).pipe(b(()=>""));onlineStatus=M(()=>{switch(this.lang.localChange(),this.store.streamingStatus()){case"Started":return this.lang.locals.connected;case"InProgress":return this.lang.locals.connecting;case"Disconnecting":return this.lang.locals.disconnecting;default:return this.lang.locals.not_connected}});ngOnInit(){return _(this,null,function*(){L(this.destroy$).pipe(u(()=>this.store.updateStreamStatus("Stopped"))).pipe(p(()=>this.avatarService.closeStream().pipe(g()))).subscribe(()=>{console.log("COMPONENT DESTROYED")}),this.stop$.pipe(O(()=>this.store.hasStream())).pipe(u(()=>this.store.updateStreamStatus("Disconnecting"))).pipe(w(this.destroy$)).pipe(p(()=>this.avatarService.closeStream().pipe(g()))).subscribe(()=>{console.log("MANUAL CLOSE")}),this.size()||this.start$.next()})}ngAfterViewInit(){this.playIdle()}playIdle(){this.idleVideo()&&this.idleVideo()?.nativeElement&&(this.idleVideo().nativeElement.src="assets/videos/idle-full.webm",this.idleVideo().nativeElement.muted=!0,this.idleVideo().nativeElement.loop=!0,this.idleVideo().nativeElement.play().then())}static \u0275fac=(()=>{let i;return function(e){return(i||(i=$(n)))(e||n)}})();static \u0275cmp=v({type:n,selectors:[["app-avatar-video"]],viewQuery:function(t,e){t&1&&(I(e.video,me,5),I(e.idleVideo,ue,5)),t&2&&U(2)},hostVars:1,hostBindings:function(t,e){t&2&&q("class",e.fullWidth)},inputs:{size:[1,"size"]},standalone:!0,features:[W,h],decls:11,vars:23,consts:[["video",""],["idleVideo",""],["id","video-wrapper",1,"flex","items-center","w-full","h-full","justify-center"],[1,"flex","flex-col","items-center","w-full","h-full","justify-center","absolute"],[1,"flex","gap-1","shadow-2xl","shadow-white","bg-black/20","p-1","mt-2","absolute","z-50","top-0","rounded-md",3,"ngClass"],[1,"p-4","rounded-full",3,"ngClass"],[1,"p-4","absolute","pulse","rounded-full",3,"ngClass"],[1,"text-white","font-semibold"],["autoplay","",3,"hidden","ngClass"],[3,"ngClass","hidden"],["src","assets/videos/idle-full.webm","type","video/webm"]],template:function(t,e){t&1&&(r(0,"div",2)(1,"div",3)(2,"div",4),o(3,"div",5)(4,"div",6),E(5,he,2,1,"span",7),s(),o(6,"video",8,0),E(8,fe,3,5,"video",9),s(),V(9),X(10,"async"),s()),t&2&&(l(2),c("ngClass",K(10,ve,!e.hasSize())),l(),c("ngClass",z(12,oe,e.store.isStreamStopped(),e.store.isStreamStarted(),e.store.isStreamLoading())),l(),c("ngClass",z(16,oe,e.store.isStreamStopped(),e.store.isStreamStarted(),e.store.isStreamLoading())),l(),A(e.hasSize()?5:-1),l(),c("hidden",e.store.isStreamStopped()||e.store.isStreamLoading())("ngClass",T(20,ce,e.hasSize(),!e.hasSize())),l(2),A(e.hasSize()?8:-1),l(),J(" ",Z(10,8,e.init$),`
`))},dependencies:[te,ee]})};var pe=class n{avatarService=d(S);lang=d(f);interruptAvatar(){this.avatarService.interruptAvatar().pipe(k(1)).subscribe()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["app-avatar-interrupter-btn"]],standalone:!0,features:[h],decls:12,vars:1,consts:[[1,"text-white",3,"click","matTooltip"],["fill","currentColor","xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","viewBox","0 0 100 125",1,"w-full"],["d","M26.547,64.063c-0.187,0-0.374-0.071-0.518-0.212c-2.761-2.731-4.221-6.021-4.221-9.516c0-2.814,0.979-5.564,2.833-7.953   c0.25-0.321,0.711-0.381,1.034-0.131c0.321,0.25,0.38,0.713,0.13,1.034c-1.651,2.128-2.523,4.565-2.523,7.049   c0,3.092,1.309,6.02,3.783,8.467c0.289,0.286,0.292,0.753,0.006,1.042C26.928,63.99,26.737,64.063,26.547,64.063z"],["d","M28.144,62.235c-0.188,0-0.375-0.071-0.519-0.213c-2.18-2.156-3.332-4.758-3.332-7.522c0-2.227,0.774-4.402,2.239-6.29   c0.249-0.321,0.712-0.381,1.034-0.13c0.321,0.25,0.38,0.712,0.131,1.034c-1.263,1.627-1.931,3.49-1.931,5.387   c0,2.362,1.001,4.601,2.895,6.475c0.29,0.286,0.292,0.753,0.007,1.042C28.523,62.162,28.333,62.235,28.144,62.235z"],["d","M29.549,59.614c-0.188,0-0.375-0.071-0.519-0.213c-1.329-1.315-2.061-2.971-2.061-4.665c0-1.385,0.479-2.736,1.387-3.905   c0.25-0.321,0.713-0.38,1.034-0.131c0.321,0.25,0.38,0.712,0.131,1.034c-0.705,0.909-1.078,1.947-1.078,3.002   c0,1.315,0.562,2.566,1.624,3.616c0.288,0.287,0.291,0.753,0.005,1.042C29.928,59.542,29.738,59.614,29.549,59.614z"],["d","M64.743,57.484c1.783-3.587,5.967-10.445,6.667-15.297c0.902-6.253-1.999-17.147-11.604-19.727   c-9.604-2.578-18.19,1.069-21.595,3.997c-0.813,0.699-1.447,1.597-1.956,2.564L64.743,57.484z"],["d","M33.92,40.824c-1.134,1.348-3.885,4.769-4.089,6.455c-0.257,2.127,3.242,2.192,3.242,2.192l-0.405,4.19l2.321,1.031   l-1.934,0.387c0,0,0.772,2.192,0.257,3.481s-0.516,6.188,3.353,5.028c3.867-1.16,6.188,14.827,6.188,14.827L61.21,68.09   L33.92,40.824z"],["d","M50.25,9.33c-22.472,0-40.753,18.282-40.753,40.753S27.778,90.835,50.25,90.835s40.753-18.282,40.753-40.753  S72.722,9.33,50.25,9.33z M85.003,50.083c0,8.496-3.068,16.285-8.149,22.329L27.898,23.499c6.048-5.093,13.846-8.169,22.352-8.169  C69.413,15.33,85.003,30.92,85.003,50.083z M15.497,50.083c0-8.501,3.073-16.295,8.16-22.341l48.956,48.914  c-6.049,5.099-13.852,8.18-22.363,8.18C31.087,84.835,15.497,69.245,15.497,50.083z"]],template:function(t,e){t&1&&(r(0,"button",0),G("click",function(){return e.interruptAvatar()}),B(),r(1,"svg",1)(2,"g"),o(3,"path",2),s(),r(4,"g"),o(5,"path",3),s(),r(6,"g"),o(7,"path",4),s(),r(8,"g"),o(9,"path",5)(10,"path",6),s(),o(11,"path",7),s()()),t&2&&c("matTooltip",e.lang.locals.stop_talking)},dependencies:[ae]})};export{se as a,le as b,pe as c};
