import{a as ce}from"./chunk-MGPS5OWL.js";import{a as de}from"./chunk-Y47X37MH.js";import{b as le}from"./chunk-7IEGXP3J.js";import{b as E}from"./chunk-2XYWBLUB.js";import{h as ie}from"./chunk-PYCAYGY2.js";import{a as pe}from"./chunk-HZEW2STR.js";import"./chunk-RU2WGI2D.js";import"./chunk-NX5WH7DH.js";import"./chunk-OK5S6IU3.js";import{c as ne,h as oe,l as re,n as ae,z as se}from"./chunk-572MTIQZ.js";import{b as te}from"./chunk-IQCF37RU.js";import"./chunk-JJHYYBBQ.js";import{Ac as d,B as M,Bc as A,Cc as C,Eb as I,Fd as V,Ha as u,Ia as f,Ib as z,La as q,M as $,Mc as x,N,Nb as b,Oc as B,P as j,Pc as H,Qc as F,Rc as U,Sc as J,Tb as s,Ua as y,X as W,Yb as _,Z as T,bc as a,cc as l,dc as p,gd as K,ha as c,hc as Y,i as R,ia as k,ka as h,kc as g,mc as O,s as L,sb as r,ta as S,ud as X,w as v,xa as w,xc as P,xd as Z,yc as Q,zd as ee}from"./chunk-5LB72LK3.js";var he=(t,i)=>({width:t,border:i}),D=class t{width=y.required();borderWidth=y.required();color=y.required();static \u0275fac=function(n){return new(n||t)};static \u0275cmp=w({type:t,selectors:[["app-spinner-loader"]],inputs:{width:[1,"width"],borderWidth:[1,"borderWidth"],color:[1,"color"]},standalone:!0,features:[x],decls:1,vars:4,consts:[[1,"loader",3,"ngStyle"]],template:function(n,e){n&1&&p(0,"span",0),n&2&&s("ngStyle",H(1,he,e.width()+"px",e.borderWidth()+"px solid "+e.color()))},dependencies:[V,Z],styles:["[_nghost-%COMP%]{display:flex;width:100%;align-items:center;justify-content:center}.loader[_ngcontent-%COMP%]{aspect-ratio:1;border-radius:50%;animation:_ngcontent-%COMP%_l20-1 .8s infinite linear alternate,_ngcontent-%COMP%_l20-2 1.6s infinite linear}@keyframes _ngcontent-%COMP%_l20-1{0%{clip-path:polygon(50% 50%,0 0,50% 0%,50% 0%,50% 0%,50% 0%,50% 0%)}12.5%{clip-path:polygon(50% 50%,0 0,50% 0%,100% 0%,100% 0%,100% 0%,100% 0%)}25%{clip-path:polygon(50% 50%,0 0,50% 0%,100% 0%,100% 100%,100% 100%,100% 100%)}50%{clip-path:polygon(50% 50%,0 0,50% 0%,100% 0%,100% 100%,50% 100%,0% 100%)}62.5%{clip-path:polygon(50% 50%,100% 0,100% 0%,100% 0%,100% 100%,50% 100%,0% 100%)}75%{clip-path:polygon(50% 50%,100% 100%,100% 100%,100% 100%,100% 100%,50% 100%,0% 100%)}to{clip-path:polygon(50% 50%,50% 100%,50% 100%,50% 100%,50% 100%,50% 100%,0% 100%)}}@keyframes _ngcontent-%COMP%_l20-2{0%{transform:scaleY(1) rotate(0)}49.99%{transform:scaleY(1) rotate(135deg)}50%{transform:scaleY(-1) rotate(0)}to{transform:scaleY(-1) rotate(-135deg)}}"]})};var Se=["video"],we=["idleVideo"],ye=t=>({"cursor-pointer":t}),me=(t,i,n)=>({"bg-red-600":t,"bg-green-700":i,"bg-orange-500":n});function be(t,i){t&1&&(a(0,"div",8),p(1,"app-avatar-interrupter-btn"),l())}function _e(t,i){t&1&&p(0,"app-spinner-loader",18),t&2&&s("width",24)("borderWidth",4)}function Ce(t,i){if(t&1&&d(0),t&2){let n=O();C(" ",n.lang.locals.test," ")}}function xe(t,i){if(t&1&&(a(0,"div",19)(1,"span",20),d(2),l(),a(3,"span",21)(4,"span",22),d(5,"."),l(),a(6,"span",23),d(7,"."),l(),a(8,"span",24),d(9,"."),l()()()),t&2){let n=O();r(2),A(n.lang.locals.video_generating_and_downloading_progress)}}var G=class t extends pe(class{}){video=I.required("video");idleVideo=I("idleVideo");lang=S(te);avatarService=S(de);store=S(le);start$=new L(1);stop$=new L(1);text=new re("");isLoading=!1;isDownloading=!1;onlineStatus=K(()=>{switch(this.lang.localChange(),this.store.streamingStatus()){case"Started":return this.lang.locals.connected;case"InProgress":return this.lang.locals.connecting;case"Disconnecting":return this.lang.locals.disconnecting;default:return this.lang.locals.not_connected}});init$=this.start$.asObservable().pipe(h(()=>this.store.updateStreamStatus("InProgress"))).pipe(k(this.destroy$)).pipe(W(()=>this.avatarService.startStream().pipe(j(i=>{throw this.store.updateStreamStatus("Stopped"),i})).pipe(E()))).pipe(c(i=>{let{data:{webrtcData:{offer:n,iceServers:e}}}=i;return this.pc=new RTCPeerConnection({iceServers:e,iceTransportPolicy:"relay"}),this.pc.addEventListener("icecandidate",o=>{o.candidate&&this.avatarService.sendCandidate(o.candidate).subscribe()}),this.pc.addEventListener("icegatheringstatechange",o=>{o.target.iceGatheringState=="complete"&&this.video().nativeElement.paused&&(this.video().nativeElement.play().then(),this.store.updateStreamStatus("Started"))}),this.pc.addEventListener("track",o=>{this.video().nativeElement.srcObject=o.streams[0]}),this.pc.addEventListener("connectionstatechange",o=>{let m=o.target.connectionState;m==="connected"&&this.store.updateStreamStatus("Started"),m==="disconnected"&&this.store.updateStreamStatus("Stopped")}),v(this.pc.setRemoteDescription(new RTCSessionDescription(n))).pipe(c(()=>v(this.pc.createAnswer()))).pipe(c(o=>v(this.pc.setLocalDescription(o)).pipe(M(()=>o)))).pipe(c(o=>this.avatarService.sendAnswer(o)))})).pipe(M(()=>""));ngOnInit(){return R(this,null,function*(){$(this.destroy$).pipe(h(()=>this.store.updateStreamStatus("Stopped"))).pipe(c(()=>this.avatarService.closeStream().pipe(E()))).subscribe(()=>{console.log("COMPONENT DESTROYED")}),this.stop$.pipe(N(()=>this.store.hasStream())).pipe(h(()=>this.store.updateStreamStatus("Disconnecting"))).pipe(k(this.destroy$)).pipe(c(()=>this.avatarService.closeStream().pipe(E()))).subscribe(()=>{console.log("MANUAL CLOSE")}),this.start$.next()})}interruptAvatar(){this.avatarService.interruptAvatar().subscribe()}test(){!this.text.value||this.isLoading||!this.store.isStreamStarted()||(this.isLoading=!0,this.avatarService.renderText(this.text.value).pipe(T(()=>this.isLoading=!1)).subscribe())}updateAndDownload(){!this.text.value||this.isLoading||this.isDownloading||(this.isDownloading=!0,this.avatarService.updateVideo(this.text.value).pipe(T(()=>this.isDownloading=!1)).subscribe(i=>console.log(i)))}ngAfterViewInit(){this.playIdle()}playIdle(){this.idleVideo()&&this.idleVideo()?.nativeElement&&(this.idleVideo().nativeElement.src="assets/videos/idle-full.webm",this.idleVideo().nativeElement.muted=!0,this.idleVideo().nativeElement.loop=!0,this.idleVideo().nativeElement.play().then())}toggleStream(){this.store.isStreamStopped()?this.start$.next():this.store.isStreamStarted()&&this.stop$.next()}static \u0275fac=(()=>{let i;return function(e){return(i||(i=q(t)))(e||t)}})();static \u0275cmp=w({type:t,selectors:[["app-text-avatar"]],viewQuery:function(n,e){n&1&&(P(e.video,Se,5),P(e.idleVideo,we,5)),n&2&&Q(2)},standalone:!0,features:[z,x],decls:26,vars:26,consts:[["video",""],["idleVideo",""],["id","video-wrapper",1,"relative","flex","flex-col","justify-center","items-center","gap-2","h-[100vh]","px-4","py-4","overflow-hidden"],[1,"flex","flex-col","items-end","w-full","md:w-[700px]","h-full","overflow-hidden","justify-center","relative","rounded-md"],[1,"flex","items-center","gap-1","shadow-2xl","shadow-white","bg-black/20","p-1","absolute","z-50","top-2","end-2","rounded-md",3,"click","ngClass"],[1,"p-4","rounded-full",3,"ngClass"],[1,"p-4","absolute","pulse","rounded-full",3,"ngClass"],[1,"text-white","font-semibold"],[1,"absolute","z-50","top-2","start-2","w-10"],[1,"relative","w-full","h-[500px]","overflow-hidden"],["autoplay","",1,"absolute","min-w-full","min-h-full",3,"hidden"],[1,"absolute","min-w-full","min-h-full",3,"hidden"],["src","assets/videos/idle-full.webm","type","video/webm"],[1,"w-full","md:w-[700px]"],[1,"w-full"],["type","text","tabindex","1","rows","3",1,"w-full","resize-none","text-lg","p-2","text-gray-700","border","border-gray-300","rounded-lg","bg-gray-100","focus:ring-gray-400","focus:border-gray-400","focus:ring-4","outline-none","ring-2","ring-gray-500",3,"keydown.enter","formControl"],[1,"flex","justify-center","items-center","gap-4"],[1,"bg-gray-300","w-1/2","text-gray-800","font-medium","py-2","px-4","rounded-lg","hover:bg-gray-400","disabled:bg-gray-400","focus:ring-2","focus:ring-gray-200","focus:outline-none",3,"click","disabled"],["color","#374151",3,"width","borderWidth"],[1,"absolute","top-0","left-0","w-full","h-full","bg-black/75","z-50","flex","items-center","justify-center","gap-2","text-gray-200"],[1,"font-medium","text-2xl"],[1,"flex","text-6xl"],[1,"animate-[bounce_1s_ease-in-out_infinite]"],[1,"animate-[bounce_1s_ease-in-out_infinite_0.2s]"],[1,"animate-[bounce_1s_ease-in-out_infinite_0.4s]"]],template:function(n,e){if(n&1){let o=Y();a(0,"div",2)(1,"div",3)(2,"div",4),g("click",function(){return u(o),f(e.toggleStream())}),p(3,"div",5)(4,"div",6),a(5,"span",7),d(6),l()(),b(7,be,2,0,"div",8),a(8,"div",9),p(9,"video",10,0),a(11,"video",11,1),p(13,"source",12),l()()(),a(14,"div",13)(15,"div",14)(16,"textarea",15),g("keydown.enter",function(ue){return u(o),ue.preventDefault(),f(e.test())}),l()(),a(17,"div",16)(18,"button",17),g("click",function(){return u(o),f(e.test())}),b(19,_e,1,2,"app-spinner-loader",18)(20,Ce,1,1),l(),a(21,"button",17),g("click",function(){return u(o),f(e.updateAndDownload())}),d(22),l()()(),d(23),U(24,"async"),l(),b(25,xe,10,1,"div",19)}n&2&&(r(2),s("ngClass",B(16,ye,e.store.isStreamStopped()||e.store.isStreamStarted())),r(),s("ngClass",F(18,me,e.store.isStreamStopped(),e.store.isStreamStarted(),e.store.isStreamLoading())),r(),s("ngClass",F(22,me,e.store.isStreamStopped(),e.store.isStreamStarted(),e.store.isStreamLoading())),r(2),A(e.onlineStatus()),r(),_(e.store.isStreamStarted()?7:-1),r(2),s("hidden",e.store.isStreamStopped()||e.store.isStreamLoading()),r(2),s("hidden",e.store.isStreamStarted()),r(5),s("formControl",e.text),r(2),s("disabled",!e.store.isStreamStarted()||e.isLoading||!e.text.value),r(),_(e.isLoading?19:20),r(2),s("disabled",e.isLoading||e.isDownloading||!e.text.value),r(),C(" ",e.lang.locals.download," "),r(),C(" ",J(24,14,e.init$),`
`),r(2),_(e.isDownloading?25:-1))},dependencies:[V,X,ee,se,ne,oe,ae,ie,D,ce]})};export{G as default};
